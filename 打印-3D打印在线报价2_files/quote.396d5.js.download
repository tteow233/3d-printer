!function(e){var i={};function t(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,i){if(1&i&&(e=t(e)),8&i)return e;if(4&i&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var o in e)t.d(n,o,function(i){return e[i]}.bind(null,o));return n},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)},t.p="",t(t.s=12)}({12:function(e,i,t){$((function(){t(77),$("#header>.w").load("../../common/header.html"),$("#contact").load("../../common/footer.html");var e=getCookie("token"),i=getCookie("monthlyKnots");function n(i,t,n){var o=t;$(".fileList .fileInfoUl").each((function(){var t={};t.length=$($(this)).find(".length").html(),t.width=$($(this)).find(".width").html(),t.height=$($(this)).find(".height").html(),t.volume=$($(this)).find(".volumes").html(),t.unit=$($(this)).find("#unitSelect option:selected").html(),t.deliveryDays=$($(this)).find("#deliveryTimeSelect option:selected").attr("class"),t.materialId=$(this).find(".materialsSelect option:selected").attr("id"),t.quantity=$($(this)).find(".numberInput").val(),t.listSurface=[{id:$($(this)).find(".surfaceSelect option:selected").attr("id"),surfaceName:$(this).find(".surfaceSelect option:selected").html(),colorValue:$(this).find(".pantoneValue").val()}],t.offerType=$(this).attr("id"),t.minPriceType=i,t.weight=$($(this)).find(".weight").html(),t.colorId=$(this).find(".color option:selected").attr("id"),t.colorName=$(this).find(".color option:selected").html(),t.quotationName=$(this).find(".fileName").html(),t.token=null==e?"":e,t.ossFileStl=$(this).find(".thumbnail").attr("id"),t.image=$(this).find("#imgsrc").attr("src"),o.push(t)})),console.log(o),$.ajax({url:ajaxUrl+"quotation/create",type:"post",headers:{token:null==e?"":e},data:JSON.stringify(o),contentType:"application/json",success:n,error:function(e,i,t){}})}function o(){$(".countBox .indentTotalPrice").html("0");var e=0;$(".deliveryTime .discountPriceNumber").each((function(){e+=1e4*Number($(this).html())})),$(".countBox .indentTotalPrice").html((e/1e4).toFixed(1))}function a(){$(".deliveryTime #deliveryTimeSelect").each((function(){$(".deliveryTime #deliveryTimeSelect").children("option:last-child").attr("selected",!0)}))}null!=e&&"Y"==i&&$(".monthlyBalance").remove(),$.ajax({url:ajaxUrl+"message/promotion",type:"post",success:function(e){if(0==e.code){0==e.obj.length&&$(".swiper-container").hide();for(var i="",t=0;t<e.obj.length;t++){var n=e.obj[t].promotionContent;i+='<div class="swiper-slide"> '+(n=(n=n.replace(/%/g,e.obj[t].weight)).replace(/@/g,e.obj[t].surplusWeight))+" </div>"}$(".swiper-wrapper").html(i);new Swiper(".swiper-container",{direction:"horizontal",loop:!0,autoplay:!0,delay:100,allowTouchMove:!1,speed:2e4,slidesPerView:1,height:60})}}});var s="",l="",r="";function c(){$(".thumbnail img").unbind().on("click",(function(){var e=$(this).attr("class");""!=e&&($(".previewBox").css("opacity",1).css("z-index",9),$(".filePreview ."+e).show().siblings().hide()),I=!0})),$(".partInfo #unitSelect").unbind().change((function(){var e=$(this),i=[];$(this).parent().parent(".partInfo").find(".unit").html($(this).children("option:selected").html());var t=$(this).parent().parent().siblings(".number").find(".numberInput").val();$(this).parent().parent().siblings(".surfaceTreatment").find(".surfaceSelect").each((function(){var e={};e.id=$(this).children("option:selected").attr("id"),i.push(e)}));e.parent().parent().find(".weight").html();n("",[],(function(i){for(var n=0;n<$(".fileList .minPriceHint").length;n++)"1"==$($(".fileList .minPriceHint")[n]).attr("id")&&$($(".fileListUl .fileList")[n]).find(".minPriceHint").show();n=Number(e.parent().parent().siblings(".serialNumber").html());e.parent().parent().siblings(".deliveryTime").find(".unitPriceNumber").html(i.obj.quotations[n-1].promotionPrice),e.parent().parent().find(".weight").html(i.obj.quotations[n-1].weight);var a=10*Number(e.parent().parent().siblings(".deliveryTime").find(".unitPriceNumber").html());e.parent().parent().siblings(".deliveryTime").find(".totalPriceNumber").html(Number(t)*a/10),e.parent().parent().siblings(".deliveryTime").find(".lowestNumber").html(i.obj.quotations[n-1].minimumPrice),e.parent().parent().siblings(".deliveryTime").find(".discountPriceNumber").html(i.obj.quotations[n-1].promotionTotal),o()}))})),$(".materials .materialsSelect").unbind().change((function(){var i=$(this);$(this).parent().siblings(".deliveryTime").find(".oilInjection").hide(),b($(this).find("option:selected").attr("id"),i.parent().siblings(".surfaceTreatment").find(".surfaceSelect")),g($(this).find("option:selected").attr("id"),i.parent().siblings(".deliveryTime").find("#deliveryTimeSelect"));var t=$(this).parent().siblings(".number").find(".numberInput").val();$.ajax({url:ajaxUrl+"color/listColor",type:"post",headers:{token:null==e?"":e},data:JSON.stringify({materialId:i.find("option:selected").attr("id")}),contentType:"application/json",success:function(e){colorTemplateHtml=template("colorTemplate",e),i.siblings(".color").html(colorTemplateHtml),n("",[],(function(e){for(var n=0;n<$(".fileList .minPriceHint").length;n++)"1"==$($(".fileList .minPriceHint")[n]).attr("id")&&$($(".fileListUl .fileList")[n]).find(".minPriceHint").show();n=Number(i.parent().siblings(".serialNumber").html());i.parent().siblings(".deliveryTime").find(".unitPriceNumber").html(e.obj.quotations[n-1].promotionPrice);var a=10*Number(i.parent().siblings(".deliveryTime").find(".unitPriceNumber").html());i.parent().siblings(".deliveryTime").find(".totalPriceNumber").html(Number(t)*a/10),i.parent().siblings(".deliveryTime").find(".discountPriceNumber").html(e.obj.quotations[n-1].promotionTotal),o()}))}})})),$(".materials .color").unbind().change((function(){var e=$(this),i=$(this).parent().siblings(".number").find(".numberInput").val();n("",[],(function(t){for(var n=0;n<$(".fileList .minPriceHint").length;n++)"1"==$($(".fileList .minPriceHint")[n]).attr("id")&&$($(".fileListUl .fileList")[n]).find(".minPriceHint").show();n=Number(e.parent().siblings(".serialNumber").html());e.parent().siblings(".deliveryTime").find(".unitPriceNumber").html(t.obj.quotations[n-1].promotionPrice);var a=10*Number(e.parent().siblings(".deliveryTime").find(".unitPriceNumber").html());e.parent().siblings(".deliveryTime").find(".totalPriceNumber").html(Number(i)*a/10),e.parent().siblings(".deliveryTime").find(".discountPriceNumber").html(t.obj.quotations[n-1].promotionTotal),o()}))})),$(".surfaceTreatment .surfaceSelect").unbind().change((function(){var e=$(this),i=$(this).parent().parent().siblings(".number").find(".numberInput").val(),t=[];$(this).each((function(){var e={};e.id=$(this).find("option:selected").attr("id"),t.push(e)})),"光油"==$(this).find("option:selected").html()||"哑油"==$(this).find("option:selected").html()?($(this).siblings(".pantone").show(),$(this).parent().parent().siblings(".deliveryTime").find(".oilInjection").show()):($(this).siblings(".pantone").hide().find(".pantoneValue").val(""),$(this).siblings(".pantoneHint").hide(),$(this).parent().parent().siblings(".deliveryTime").find(".oilInjection").hide()),n("",[],(function(t){for(var n=0;n<$(".fileList .minPriceHint").length;n++)"1"==$($(".fileList .minPriceHint")[n]).attr("id")&&$($(".fileListUl .fileList")[n]).find(".minPriceHint").show();console.log(t);n=Number(e.parent().parent().siblings(".serialNumber").html());e.parent().parent().siblings(".deliveryTime").find(".unitPriceNumber").html(t.obj.quotations[n-1].promotionPrice);var a=10*Number(e.parent().parent().siblings(".deliveryTime").find(".unitPriceNumber").html());e.parent().parent().siblings(".deliveryTime").find(".totalPriceNumber").html(Number(i)*a/10),e.parent().parent().siblings(".deliveryTime").find(".discountPriceNumber").html(t.obj.quotations[n-1].promotionTotal),o()}))})),$(".deliveryTime #deliveryTimeSelect").unbind().change((function(){var e=$(this),i=e.parent().siblings(".number").find(".numberInput").val();n("",[],(function(t){for(var n=0;n<$(".fileList .minPriceHint").length;n++)"1"==$($(".fileList .minPriceHint")[n]).attr("id")&&$($(".fileListUl .fileList")[n]).find(".minPriceHint").show();n=Number(e.parent().siblings(".serialNumber").html());e.siblings(".unitPrice").find(".unitPriceNumber").html(t.obj.quotations[n-1].promotionPrice);var a=10*Number(e.siblings(".unitPrice").find(".unitPriceNumber").html());e.siblings(".totalPrice").find(".totalPriceNumber").html(Number(i)*a/10),e.siblings(".discountPrice").find(".discountPriceNumber").html(t.obj.quotations[n-1].promotionTotal),o()}))})),$(".operation .allApplicationBtn").unbind().on("click",(function(){var i=$(this).parent().parent().siblings(".partInfo").find("#unitSelect option:selected").val();$(this).parent().parent().parent().parent().siblings(".fileListItem").find("#unitSelect option[value = '"+i+"']").prop("selected",!0);var t=$(this).parent().parent().siblings(".materials").find(".materialsSelect option:selected").attr("id");$(this).parent().parent().parent().parent().siblings(".fileListItem").find(".materialsSelect option[id = '"+t+"']").prop("selected",!0);var n=$(this).parent().parent().siblings(".materials").find(".color option").clone(!0);$(this).parent().parent().parent().parent().siblings(".fileList").find(".color").html(n);var a=$(this).parent().parent().siblings(".materials").find(".color option:selected").attr("id"),s=$(this).parent().parent().siblings(".materials").find(".color option:selected").html();$(this).parent().parent().parent().parent().siblings(".fileListItem").find(".color option[id = '"+a+"']").prop("selected",!0);var l=$(this).parent().parent().siblings(".surfaceTreatment").find(".surfaceBox").clone(!0);console.log(l),$(this).parent().parent().parent().parent().siblings(".fileListItem").find(".surfaceTreatment").html(l);var r=$(this).parent().parent().siblings(".surfaceTreatment").find(".surfaceSelect option:selected").attr("id");$(this).parent().parent().parent().parent().siblings(".fileListItem").find(".surfaceSelect option[id = '"+r+"']").prop("selected",!0);var c=$(this).parent().parent().siblings(".number").find(".numberInput").val();$(".number .numberInput").val(c);var d=$(this).parent().parent().siblings(".deliveryTime").find("#deliveryTimeSelect option").clone(!0);$(this).parent().parent().parent().parent().siblings(".fileList").find("#deliveryTimeSelect").html(d);var p=$(this).parent().parent().siblings(".deliveryTime").find("#deliveryTimeSelect option:selected").val();$(this).parent().parent().parent().parent().siblings(".fileListItem").find("#deliveryTimeSelect option[value = '"+p+"']").prop("selected",!0),$(this).parent().parent().siblings(".deliveryTime").find(".oilInjection").is(":visible")?$(".oilInjection").show():$(".oilInjection").hide();var m=$(this).parent().parent().siblings(".partInfo").find("#unitSelect option:selected").html(),u=$(this).parent().parent().siblings(".deliveryTime").find("#deliveryTimeSelect option:selected").attr("class"),h=$(this).parent().parent().siblings(".number").find(".numberInput").val(),f=[];$(this).parent().parent().siblings(".surfaceTreatment").find(".surfaceSelect").each((function(){var e={};e.id=$(this).find("option:selected").attr("id"),e.surfaceName=$(this).find("option:selected").html(),f.push(e)}));var g=[];$(".fileList .fileInfoUl .partInfo").each((function(){var e={};e.length=$(this)[0].children[1].children[0].innerHTML,e.width=$(this)[0].children[1].children[1].innerHTML,e.height=$(this)[0].children[1].children[2].innerHTML,e.volume=$(this)[0].children[2].children[0].innerHTML,e.fileName=$(this)[0].children[0].children[0].innerHTML,e.weight=$(this).find(".weight").html(),e.offerType=$(this).parent().attr("id"),g.push(e)})),$.ajax({url:ajaxUrl+"quotation/applyall",type:"post",headers:{token:null==e?"":e},data:JSON.stringify({unit:m,materialId:t,deliveryDays:u,quantity:h,listVol:g,listSurface:f,colorId:a,colorName:s}),contentType:"application/json",success:function(e){for(var i=0;i<e.obj.length;i++)$($(".fileList .deliveryTime")[i]).find(".unitPriceNumber").html(e.obj[i].price),$($(".fileList .deliveryTime")[i]).find(".totalPriceNumber").html(e.obj[i].promotionTotal),$($(".fileList .deliveryTime")[i]).find(".discountPriceNumber").html(e.obj[i].promotionTotal),o()}})})),$(".lowParameter .lowParameterBtn").unbind().on("click",(function(){var e=$(this).parent().parent();n("最低价",[],(function(i){for(var t=0;t<$(".fileList .minPriceHint").length;t++)"1"==$($(".fileList .minPriceHint")[t]).attr("id")&&$($(".fileListUl .fileList")[t]).find(".minPriceHint").show();console.log(i),e.siblings(".deliveryTime").find(".oilInjection").hide();t=Number(e.siblings(".serialNumber").html());T(i.obj.quotations[t-1].materialId,e.siblings(".materials").find(".color")),b(i.obj.quotations[t-1].id,e.siblings(".surfaceTreatment").find(".surfaceSelect")),g(i.obj.quotations[t-1].materialId,e.siblings(".deliveryTime").find("#deliveryTimeSelect")),e.siblings(".partInfo").find("#unitSelect option[value="+i.obj.quotations[t-1].unit+"]").prop("selected",!0),e.siblings(".materials").find(".materialsSelect option[id="+i.obj.quotations[t-1].materialId+"]").prop("selected",!0),e.siblings(".materials").find(".color option[id="+i.obj.quotations[t-1].colorId+"]").prop("selected",!0),e.siblings(".surfaceTreatment").find(".surfaceSelect #default").prop("selected",!0),e.siblings(".deliveryTime").find("#deliveryTimeSelect option[class="+i.obj.quotations[t-1].deliveryDays+"]").prop("selected",!0),e.siblings(".number").find(".numberInput").val(i.obj.quotations[t-1].quantity),e.siblings(".deliveryTime").find(".unitPriceNumber").html(i.obj.quotations[t-1].promotionPrice),e.siblings(".deliveryTime").find(".totalPriceNumber").html(i.obj.quotations[t-1].promotionTotal),e.siblings(".deliveryTime").find(".discountPriceNumber").html(i.obj.quotations[t-1].promotionTotal),o()}))})),$(".chechNumberBox .addBtn").unbind().on("click",(function(){var e=$(this),i=$(this).siblings(".numberInput").val();i++,$(this).siblings(".numberInput").val(i),i>=1&&$(this).siblings(".subtractBtn").removeAttr("disabled"),n("",[],(function(i){for(var t=0;t<$(".fileList .minPriceHint").length;t++)"1"==$($(".fileList .minPriceHint")[t]).attr("id")&&$($(".fileListUl .fileList")[t]).find(".minPriceHint").show();t=Number(e.parent().parent().parent().siblings(".serialNumber").html());e.parent().parent().parent().siblings(".deliveryTime").find(".unitPriceNumber").html(i.obj.quotations[t-1].promotionPrice),e.parent().parent().parent().siblings(".deliveryTime").find(".totalPriceNumber").html(i.obj.quotations[t-1].promotionTotal),e.parent().parent().parent().siblings(".deliveryTime").find(".discountPriceNumber").html(i.obj.quotations[t-1].promotionTotal),o()})),o()})),$(".subtractBtn").unbind().on("click",(function(){var e=$(this).siblings(".numberInput").val();if(e<2)return $(this).siblings(".subtractBtn").attr("disabled","true"),!1;e--,$(this).siblings(".numberInput").val(e);var i=$(this);n("",[],(function(e){for(var t=0;t<$(".fileList .minPriceHint").length;t++)"1"==$($(".fileList .minPriceHint")[t]).attr("id")&&$($(".fileListUl .fileList")[t]).find(".minPriceHint").show();t=Number(i.parent().parent().parent().siblings(".serialNumber").html());i.parent().parent().parent().siblings(".deliveryTime").find(".unitPriceNumber").html(e.obj.quotations[t-1].promotionPrice),i.parent().parent().parent().siblings(".deliveryTime").find(".totalPriceNumber").html(e.obj.quotations[t-1].promotionTotal),i.parent().parent().parent().siblings(".deliveryTime").find(".discountPriceNumber").html(e.obj.quotations[t-1].promotionTotal),o()})),o()})),$(".number .numberInput").unbind().blur((function(){/^(\+|-)?\d+$/.test($(this).val())&&$(this).val()>0||$(this).val("1");var e=$(this);n("",[],(function(i){for(var t=0;t<$(".fileList .minPriceHint").length;t++)"1"==$($(".fileList .minPriceHint")[t]).attr("id")&&$($(".fileListUl .fileList")[t]).find(".minPriceHint").show();t=Number(e.parent().parent().parent().siblings(".serialNumber").html());e.parent().parent().parent().siblings(".deliveryTime").find(".unitPriceNumber").html(i.obj.quotations[t-1].promotionPrice),e.parent().parent().parent().siblings(".deliveryTime").find(".totalPriceNumber").html(i.obj.quotations[t-1].promotionTotal),e.parent().parent().parent().siblings(".deliveryTime").find(".discountPriceNumber").html(i.obj.quotations[t-1].promotionTotal),o()})),o()})),$(".operation .contrastMaterial a").unbind().on("click",(function(){var i=$(this).parent().parent(),t=i.siblings(".thumbnail").find("#imgsrc").attr("src");$.ajax({url:ajaxUrl+"quotation/base64ToOss",type:"post",headers:{token:null==e?"":e},data:JSON.stringify({imagePath:t}),contentType:"application/json",success:function(e){var t=e,n=i.siblings(".partInfo").find(".length").html(),o=i.siblings(".partInfo").find(".width").html(),a=i.siblings(".partInfo").find(".height").html(),s=i.siblings(".partInfo").find(".unit").html(),l=i.siblings(".partInfo").find(".volumes").html(),r=i.siblings(".deliveryTime").find("#deliveryTimeSelect option:selected").val(),c=i.siblings(".materials").find(".colorOn").html(),d=i.siblings(".materials").find(".colorOn").attr("id");window.open("../contrastMaterial/contrastMaterial.html?imgurl="+t+"&length="+n+"&width="+o+"&height="+a+"&unit="+s+"&volume="+l+"&deliveryDiscount="+r+"&colorName="+encodeURI(c)+"&colorId="+d)}})})),$(".operation .icon-trash").unbind().on("click",(function(){$(this).parent().parent().parent().parent().remove(),$(document).height()-$(window).height()-$(window).scrollTop()>=270?($(".countBox").addClass("quoteFixed").css("margin-bottom","0px"),$("#contact").css("margin-top","138px")):($(".countBox").removeClass("quoteFixed").css("margin-bottom","40px"),$("#contact").css("margin-top","0px")),o();var e=0;$(".fileList .serialNumber").each((function(){e++,$(this)[0].innerHTML=e})),0==$(".fileListUl .fileList").length&&window.location.reload()}))}$(".materials .materialsSelect").unbind().change((function(){var i=$(this);b($(this).find("option:selected").attr("id"),i.parent().siblings(".surfaceTreatment").find(".surfaceSelect")),g($(this).find("option:selected").attr("id"),i.parent().siblings(".deliveryTime").find("#deliveryTimeSelect")),$.ajax({url:ajaxUrl+"color/listColor",type:"post",headers:{token:null==e?"":e},data:JSON.stringify({materialId:i.find("option:selected").attr("id")}),contentType:"application/json",success:function(e){colorTemplateHtml=template("colorTemplate",e),i.siblings(".color").html(colorTemplateHtml)}})}));var d="",p="",m="",u="",h="";$.ajax({url:ajaxUrl+"materials/listMaterials",type:"post",success:function(i){if(console.log(i),0==i.code){s=template("materialsTemplate",i),$(".materials .materialsSelect").html(s);for(var t="",n=0;n<i.obj.length;n++)t+='<option id="'+i.obj[n].id+'" value="">'+i.obj[n].materialName+"</option>";$(".knowWeight .noImgMaterials").html(t),d=i.obj[0].id,p=i.obj[0].materialName,h=i.obj[0].manufactureId,T(i.obj[0].id,$(".materials .color")),$.ajax({url:ajaxUrl+"delivery/listDelivery",type:"post",headers:{token:null==e?"":e},data:JSON.stringify({materialId:i.obj[0].id}),contentType:"application/json",success:function(e){u=template("deliveryTimeTemplate",e),$(".deliveryTime #deliveryTimeSelect").html(u),a(),f=Number($("#deliveryTimeSelect option:selected").attr("class"))}}),$.ajax({url:ajaxUrl+"surface/listsurface",type:"post",headers:{token:null==e?"":e},data:JSON.stringify({materialId:i.obj[0].id}),contentType:"application/json",success:function(e){0==e.code?(m=template("surfaceTemplate",e),$(".surfaceTreatment .surfaceSelect").html(m)):layer.alert(e.msg,{icon:5})}})}else layer.alert(i.msg,{icon:5})}});var f="";function g(i,t){t=t;$.ajax({url:ajaxUrl+"delivery/listDelivery",type:"post",headers:{token:null==e?"":e},data:JSON.stringify({materialId:i}),contentType:"application/json",success:function(e){l=template("deliveryTimeTemplate",e),t.html(l),a()}})}function b(i,t){t=t;$.ajax({url:ajaxUrl+"surface/listsurface",type:"post",headers:{token:null==e?"":e},data:JSON.stringify({materialId:i}),contentType:"application/json",success:function(e){r=template("surfaceTemplate",e),t.html(r),t.siblings(".pantone").hide().find(".pantoneValue").val(""),t.siblings(".pantoneHint").hide()}})}var v="",y="",w="";function T(i,t){t=t;$.ajax({url:ajaxUrl+"color/listColor",type:"post",headers:{token:null==e?"":e},data:JSON.stringify({materialId:i}),contentType:"application/json",success:function(e){colorTemplateHtml=template("colorTemplate",e),t.html(colorTemplateHtml),v=colorTemplateHtml,y=e.obj[0].colorName,w=e.obj[0].id}})}var x=new Date,j=(x.getFullYear(),x.getMonth(),x.getMonth(),x.getDate(),x.getDate(),0);function P(e,i,t,n,o,s,l,r,c,d,p,m,u,h,f,g,b,v){$(".fileMessageBox .fileListUl").append('<li class="fileListItem"><div id="quotationType" class="fileInfoUl fileImg"><div id="" class="serialNumber"></div><div id="'+o+'" class="thumbnail"><div id="'+e+'"><div class="ossfile"></div></div><img class="" src="" alt=""><p class="parseFailure"><i class="icon-warning-sign"></i> 解析失败，请输入尺寸</p></div><div class="partInfo"><p class="nameText">名称 : <span class="fileName"></span></p><p class="nameText">尺寸 : <span class="length">0</span> × <span class="width">0</span> × <span class="height">0</span> <span class="unit">mm</span></p><p class="nameText">体积 : <span class="volumes">0</span> <span class="unit">mm</span>³</p><p class="nameText">重量 : <span class="weight">0</span> g</p><p class="nameText unitText">单位 : <select name="" id="unitSelect"><option value="mm">mm</option><option value="cm">cm</option><option value="m">m</option><option value="inch">inch</option></select></p></div><div class="materials"><select name="" class="materialsSelect"></select></div><div class="surfaceTreatment"> <select class="surfaceSelect" name="" id=""></select></div><div class="number"><span class="numberBox"><span class="chechNumberBox"><span class="icon subtractBtn"><img class="subtract" src="../image/subtractIcon.png" alt=""></span><input class="numberInput" type="text" value="1"><span class="icon addBtn"><img src="../image/plusIcon.png" alt=""></span></span></span></div><div class="deliveryTime"><p class="lowest">最低价 : <span>¥</span> <span class="lowestNumber">0</span> </p><p class="unitPrice">单&nbsp;&nbsp;&nbsp;价 : <span>¥</span><span class="unitPriceNumber">0</span></p><p class="totalPrice">总&nbsp;&nbsp;&nbsp;价 : <span>¥</span><span class="totalPriceNumber">0</span></p><p class="deliveryTimeHint">交期不包含快递时间</p><select name="" id="deliveryTimeSelect"></select></div><div class="operation"><p class="deleteBtn"><i class="icon-trash"></i></p><p class="contrastMaterial"><a href="#">价格对比</a></p><p class="allApplication"><a class="allApplicationBtn" href="javascript:void(0)">应用全部</a></p><p class="lowParameter"><a class="lowParameterBtn" href="javascript:void(0)">最低价参数</a></p></div></div></li>'),a()}function N(e){$(".fileMessageBox .fileListUl").append('<li class="fileListItem fileList"><div id="'+e.quotationType+'" class="fileInfoUl"><div id="'+e.previewFilePath+'" class="serialNumber">'+e.serialNumber+'</div><div id="'+e.sourceFilePath+'" class="thumbnail"><img id="imgsrc" class="'+e.fileId+'" src="'+e.canvasUrl+'" alt=""><p class="parseFailure"><i class="icon-warning-sign"></i> 解析失败，请输入尺寸</p></div><div class="partInfo"><p class="nameText">名称 : <span class="fileName">'+e.fileName+'</span></p><p class="nameText">尺寸 : <span class="length">'+e.length+'</span> × <span class="width">'+e.width+'</span> × <span class="height">'+e.height+'</span> <span class="unit">mm</span></p><p class="nameText">体积 : <span class="volumes">'+e.volumes+'</span> <span class="unit">mm</span>³</p><p hidden class="nameText">重量 :<span class="weight">'+e.weight+'</span> g</p><p class="nameText unitText">单位 : <select name="" id="unitSelect"><option value="mm">mm</option><option value="cm">cm</option><option value="m">m</option><option value="inch">inch</option></select></p></div>      <div class="materials"><select class="materialsSelect" name="" id="">'+e.materialsHtml+'</select><select class="color" name="" id="">'+e.colorHtml+'</select></div>       <div class="surfaceTreatment"> <div class="surfaceBox"><select class="surfaceSelect" name="" id="">'+e.defaultSurface+'</select><p class="pantone"><span>潘通色号 :</span> <input type="text" class="pantoneValue"></p><p class="pantoneHint">请输入潘通色号</p></div></div><div class="number"><span class="numberBox"><span class="chechNumberBox"><span class="icon subtractBtn"><img class="subtract" src="../image/subtractIcon.png" alt=""></span><input class="numberInput" type="number" value="1"><span class="icon addBtn"><img src="../image/plusIcon.png" alt=""></span></span></span></div><div class="deliveryTime"><p class="lowest">最低价 : <span>¥</span> <span class="lowestNumber">'+e.lowPrice+'</span> </p><p class="unitPrice">单&nbsp;&nbsp;&nbsp;价 : <span>¥</span> <span class="unitPriceNumber">'+e.unitPriceNumber+'</span></p><p class="totalPrice">总&nbsp;&nbsp;&nbsp;价 : <span>¥</span> <span class="totalPriceNumber">'+e.totalPriceNumber+'</span></p><p class="discountPrice">折扣总价 :<span>¥</span> <span class="discountPriceNumber">'+e.discountPriceNumber+'</span></p><p class="deliveryTimeHint">交期不包含快递时间</p><select name="" id="deliveryTimeSelect">'+e.defaultDeliveryList+'</select><p class="oilInjection">喷油增加2天交期</p><div class="lowestPriceBox"><p id="'+e.minimumPriceSign+'" class="minPriceHint"><i class="icon-warning-sign"></i> 最低价提示</p><div class="lowestPricePrompt"><div><div class="sjx"></div><p>模型太小已触发最低单价，如果打印数量较多</p><p>请<span>【联系客服】</span>为您报价</p><p>点击查看<span class="minPricelink">【单件最低价规则】</span></p></div></div></div></div><div class="operation"><p class="deleteBtn"><i class="icon-trash"></i></p><p class="contrastMaterial"><a href="#">价格对比</a></p><p class="allApplication"><a class="allApplicationBtn" href="javascript:void(0)">应用全部</a></p><p class="lowParameter"><a class="lowParameterBtn" href="javascript:void(0)">最低价参数</a></p></div></div></li>'),a(),$(".pantoneValue").blur((function(){""!=$(this).val().trim()&&$(this).parent().siblings(".pantoneHint").hide()})),$(".minPricelink").unbind().click((function(){window.open("./printedInstructions/printedInstructions.html?navPrint="+encodeURI("单件最低价"))}))}function k(i,t,n,a,l,r,g,b){var T=[{quotationName:i,length:t,width:n,height:a,volume:l,image:b,unit:"mm",deliveryDays:f,firstUpload:"第一次上传",ossFileStl:"",materialId:d,colorId:w,colorName:y,quantity:1,listSurface:[],weight:r,offerType:g,token:null==e?"":null==e?"":e}];$(".fileList .fileInfoUl").each((function(){var i={};i.length=$(this).find(".length").html(),i.width=$(this).find(".width").html(),i.height=$(this).find(".height").html(),i.volume=$(this).find(".volumes").html(),i.unit=$(this).find("#unitSelect option:selected").html(),i.deliveryDays=$(this).find("#deliveryTimeSelect option:selected").attr("class"),i.materialId=$(this).find(".materialsSelect option:selected").attr("id"),i.quantity=$(this).find(".numberInput").val(),i.listSurface=[{id:$(this).find(".surfaceSelect option:selected").attr("id"),surfaceName:$(this).find(".surfaceSelect option:selected").html(),colorValue:$(this).find(".pantoneValue").val()}],i.offerType=$(this).attr("id"),i.minPriceType="",i.weight=$(this).find(".weight").html(),i.ossFileStl=$(this).find(".thumbnail").attr("id"),i.image=$(this).find("#imgsrc").attr("src"),i.firstUpload="",i.quotationName=$(this).find(".fileName").html(),i.token=null==e?"":e,i.colorId=$(this).find(".color option:selected").attr("id"),i.colorName=$(this).find(".color option:selected").html(),T.push(i)})),console.log(T),$.ajax({url:ajaxUrl+"quotation/create",type:"post",headers:{token:null==e?"":e},data:JSON.stringify(T),contentType:"application/json",success:function(e){(console.log(e),0==e.code)?($(".dialogMask,.dialog").hide(),j++,$(".fileListUl .defaultList").remove(),N({quotationType:"无图纸报价",previewFilePath:"",serialNumber:j,sourceFilePath:"",fileId:"",canvasUrl:b,fileName:i,length:t,width:n,height:a,volumes:l,weight:e.obj.quotations[0].weight,defaultMaterialId:d,manufactureId:h,defaultMaterial:p,defaultColorId:w,defaultColor:y,materialsHtml:s,colorHtml:v,defaultSurface:m,lowPrice:e.obj.quotations[0].minimumPrice,unitPriceNumber:e.obj.quotations[0].price,totalPriceNumber:e.obj.quotations[0].promotionTotal,discountPriceNumber:e.obj.quotations[0].promotionTotal,defaultDeliveryList:u}),c(),o()):layer.alert(e.msg,{icon:5})}})}function B(){$.ajax({url:ajaxUrl+"quotation/getVolumeByWeight",type:"post",headers:{token:null==e?"":e},data:JSON.stringify({weight:$(".knowWeight .weight").val(),materialId:$(".noImgMaterials option:selected").attr("id")}),contentType:"application/json",success:function(e){console.log(e),0==e.code?$(".knowWeightright .countVolume").val(e.obj):layer.alert(e.msg,{icon:5})}})}$(".upBox .noDrawingBtn").unbind().on("click",(function(){$("#upImgBox img").attr("src","../image/manualQuote.jpg"),$(".dialog_head").html("无图纸报价").css("color","#fff"),$(".dialog").show().find("input").val(""),$("#dialog,#dialogMask").show(),autoCenter($("#dialog")),dialog($(".upBox .noDrawingBtn"),(function(){})),$(".knowVolume .confirm").unbind().on("click",(function(){var e=$(".knowVolume .name").val(),i=$(".knowVolume .len").val(),t=$(".knowVolume .width").val(),n=$(".knowVolume .height").val(),o=$(".knowVolume .volume").val();if(""==e||""==o)return alert("请输入名称或体积"),!1;k(e,""==i?0:i,""==t?0:t,""==n?0:n,o,0,"无图纸报价",$("#upImgBox img").attr("src"))})),$(".knowWeight .confirm").unbind().on("click",(function(){var e=$(".knowWeight .name").val(),i=$(".knowWeight .len").val(),t=$(".knowWeight .width").val(),n=$(".knowWeight .height").val(),o=$(".knowWeight .countVolume").val(),a=$(".knowWeight .weight").val();if(""==e||""==a)return alert("请输入名称或体积"),!1;k(e,""==i?0:i,""==t?0:t,""==n?0:n,o,a,"无图纸报价",$("#upImgBox img").attr("src"))}))})),$(".knowWeight .weight").blur((function(){B()})),$(".noImgMaterials").change((function(){B()})),$(".switchoverType .knowVolumeBtn").on("click",(function(){$(this).css("color","red").siblings(".knowWeightBtn").css("color","#333"),$(".knowVolume").show(),$(".knowWeight").hide()})),$(".switchoverType .knowWeightBtn").on("click",(function(){$(this).css("color","red").siblings(".knowVolumeBtn").css("color","#333"),$(".knowVolume").hide(),$(".knowWeight").show()})),$(".knowWeightImg .upImg").mousedown((function(){$.ajax({url:ajaxUrl+"quotation/upload",type:"post",headers:{token:null==e?"":e},data:JSON.stringify({token:e}),contentType:"application/json",success:function(e){function i(i,n,o){0==o&&(x=timestamp=Date.parse(new Date)/1e3,o=expire<x+3&&(t=e.obj.host,policyBase64=e.obj.policy,accessid=e.obj.accessid,signature=e.obj.signature,expire=e.obj.expire,key=e.obj.dir,!0)),""!=n&&(suffix=get_suffix(n),calculate_object_name(n)),new_multipart_params={key:key+g_object_name,policy:policyBase64,OSSAccessKeyId:accessid,success_action_status:"200",callback:callbackbody,signature:signature},i.setOption({url:t,multipart_params:new_multipart_params}),i.start()}console.log(e),accessid="",accesskey="",t="",policyBase64="",signature="",callbackbody="",filename="",key="",expire=0,g_object_name="",g_object_name_type="",x=timestamp=Date.parse(new Date)/1e3;var t=e.obj.host,n=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:"upImg",drop_element:"upImg",container:document.getElementById("upImgBox"),flash_swf_url:"lib/plupload-2.1.2/js/Moxie.swf",silverlight_xap_url:"lib/plupload-2.1.2/js/Moxie.xap",url:"http://oss.aliyuncs.com",unique_names:!0,max_retries:3,filters:{mime_types:[{title:"image",extensions:"png,jpg"}],max_file_size:"100mb",prevent_duplicates:!1},init:{PostInit:function(){document.getElementById("ossImg").innerHTML=""},FilesAdded:function(e,t){i(n,"",!1),plupload.each(t,(function(e){document.getElementById("ossImg").innerHTML+='<div id="'+e.id+'"> <b></b><div class="progress"><div class="progress-bar" style="width: 0%"></div></div></div>'}))},BeforeUpload:function(e,t){!function(){for(var e=document.getElementsByName("myradio"),i=0;i<e.length;i++)if(e[i].checked){g_object_name_type=e[i].value;break}}(),i(e,t.name,!0)},UploadProgress:function(e,i){var t=document.getElementById(i.id);t.getElementsByTagName("b")[0].innerHTML='<span calss="progressText">已上传'+i.percent+"%</span>";var n=t.getElementsByTagName("div")[0].getElementsByTagName("div")[0];n.style.width=6*i.percent+"px",n.setAttribute("aria-valuenow",i.percent)},FileUploaded:function(e,i,n){if(console.log(i),200==n.status){var o=t+"/"+key+get_uploaded_object_name(i.name);console.log(o),$("#upImgBox img").attr("src",o)}else document.getElementById(i.id).getElementsByTagName("b")[0].innerHTML=n.response},Error:function(e,i){-600==i.code?document.getElementById("console").appendChild(document.createTextNode("\n文件大小不能大于50M")):-601==i.code?document.getElementById("console").appendChild(document.createTextNode("\n选择的文件后缀不对,可以根据应用情况，在upload.js进行设置可允许的上传文件类型")):-602==i.code?document.getElementById("console").appendChild(document.createTextNode("\n这个文件已经上传过一遍了")):document.getElementById("console").appendChild(document.createTextNode("\nError xml:"+i.response))}}});n.init()}})})),$("#dialog .topClose,#dialog .close_button").on("click",(function(){$("#dialog,#dialogMask").hide()}));var I=!1;function S(i,t,a,l,r,g){function b(e,n,o){0==o&&(x=timestamp=Date.parse(new Date)/1e3,o=expire<x+3&&(T=i,policyBase64=t,accessid=a,signature=l,expire=r,key=g,!0)),""!=n&&(suffix=get_suffix(n),calculate_object_name(n)),new_multipart_params={key:key+g_object_name,policy:policyBase64,OSSAccessKeyId:accessid,success_action_status:"200",callback:callbackbody,signature:signature},e.setOption({url:T,multipart_params:new_multipart_params}),e.start()}$(".moxie-shim").remove(),accessid="",accesskey="",T="",policyBase64="",signature="",callbackbody="",filename="",key="",expire=0,g_object_name="",g_object_name_type="",x=timestamp=Date.parse(new Date)/1e3;var T=T,k=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:"upFileBtn",drop_element:"upFileBtn",container:document.getElementById("upFileBox"),flash_swf_url:"lib/plupload-2.1.2/js/Moxie.swf",silverlight_xap_url:"lib/plupload-2.1.2/js/Moxie.xap",url:"http://oss.aliyuncs.com",unique_names:!0,max_retries:3,filters:{mime_types:[{title:"files",extensions:"stl,igs,iges,stp,step,obj,3ds"}],max_file_size:"100mb"},init:{PostInit:function(){},FilesAdded:function(e,i){if(console.log(i.length),i.length>10)return alert("一次最多只能上传10个文件"),!1;for(var t,n,o,a="",s=0;s<i.length;s++)t=i[s].id,n=i[s].name,o=i[s].size,P(t),$(".fileListUl .defaultList").remove(),a='<div id="'+t+'">'+n+" ("+Math.floor(o/1024)+'k)<b></b><div class="progress"><div class="progress-bar" style="width: 0%"></div></div></div>',b(k,"",!1),plupload.each(i,(function(e){return $("#"+t).find(".ossfile").append(a),!1}))},BeforeUpload:function(e,i){!function(){for(var e=document.getElementsByName("myradio"),i=0;i<e.length;i++)if(e[i].checked){g_object_name_type=e[i].value;break}}(),b(e,i.name,!0)},UploadProgress:function(e,i){var t=document.getElementById(i.id);t.getElementsByTagName("b")[0].innerHTML='<span calss="progressText">已上传'+i.percent+"%</span>";var n=t.getElementsByTagName("div")[0].getElementsByTagName("div")[0].getElementsByTagName("div")[0].getElementsByTagName("div")[0];n.style.width=1.2*i.percent+"px",n.setAttribute("aria-valuenow",i.percent),100==i.percent&&($(".ossfile #"+i.id)[0].children[0].children[0].innerHTML='<i class="icon-spinner icon-spin"></i> 模型解析中...')},FileUploaded:function(i,t,a){if(200==a.status){t.id;var l=T+"/"+key+get_uploaded_object_name(t.name);console.log(l);ajaxUrl,t.id;$(".previewBox .loadBox").show();var r=t.name,g=t.name.lastIndexOf("."),b=r.length,x=r.substring(g+1,b).toLowerCase();if(console.log(x),"stl"==x||"obj"==x||"3ds"==x){var P=new XMLHttpRequest;P.open("POST",ajaxUrl+"quotation/changeNew",!0),P.setRequestHeader("Content-type","application/json"),P.responseType="blob",P.onload=function(i){var a=P.response,r=new Blob([a],{type:"application/json"});console.log(r);var g,b,T,k,B,S,L,E,H,C,q,M,U,_,F=window.navigator.userLanguage||window.navigator.language,R=parseFloat("1.05"),O=parseFloat("200"),D=parseFloat("1.75"),z=parseFloat("150");function V(){g.updateProjectionMatrix(),T.setSize(550,455)}I=!0,setTimeout((function(){I=!1}),5e3),function(i){(g=new THREE.PerspectiveCamera(37.8,550/455,1,1e5)).position.z=300,g.position.y=-500,g.position.x=-500,g.up=new THREE.Vector3(0,0,1),(b=new THREE.Scene).background=new THREE.Color("#f5f5f5");var a=new FileReader;"stl"==x?a.readAsArrayBuffer(i):"3ds"==x?a.readAsArrayBuffer(i):"obj"==x?a.readAsText(i):"json"==x?a.readAsText(i):(F.substring(0,2),alert("不支持的文件")),a.addEventListener("load",(function(e){console.log(e);var i,t=e.target.result;if("obj"==x){var n=(new THREE.OBJLoader).parse(t);console.log(n),(o=new THREE.Scene).add(n),t=(new THREE.STLExporter).parse(o)}else if("3ds"==x){var o;n=(new THREE.TDSLoader).parse(t);console.log(n),(o=new THREE.Scene).add(n),t=(new THREE.STLExporter).parse(o)}(i=(new THREE.STLLoader).parse(t)).computeFaceNormals(),i.computeVertexNormals(),i.center(),console.log(i);var a=new THREE.MeshPhongMaterial({color:"#b1b1b1"});L=new THREE.Mesh(i,a),S=0,L.traverse((function(e){if(console.log(e),e instanceof THREE.Mesh)for(var i=e.geometry.getAttribute("position").array,t=0;t<i.length;t+=9){var n={};n.x=i[t+0],n.y=i[t+1],n.z=i[t+2];var o={};o.x=i[t+3],o.y=i[t+4],o.z=i[t+5];var a={};a.x=i[t+6],a.y=i[t+7],a.z=i[t+8],S+=signedVolumeOfTriangle(n,o,a)}}));var s=(new THREE.Box3).setFromObject(L);E=s.max.z-s.min.z,C=s.max.x-s.min.x,M=s.max.y-s.min.y,H=H=E/10,q=q=C/10,U=U=M/10;var l=(_=_=S/1e3)*R;l=l;var r=parseFloat(2*(S/(D/2)^2/Math.PI)/10);r=parseFloat(r).toFixed(0);var c=Math.floor(r/z/60);c=parseFloat(c).toFixed(0);var d=r/z%60;0==(d=parseFloat(d).toFixed(0))&&(d=1);var p,m=l*O/1e3;m=parseFloat(m),console.log(1e3*_),console.log(10*q),console.log(10*U),console.log(10*H),p=E>C&&E>M?2*E:C>E&&C>M?2*C:M>E&&M>C?2*M:4*M,g.position.set(0,-p,0);var u=p+200,h=p+200,f=Math.floor(u/10),v=Math.floor(h/10),$=new THREE.Mesh(new THREE.PlaneGeometry(u,h,f,v),new THREE.MeshPhongMaterial({emissive:"green",color:"green",wireframe:!0,wireframeLinewidth:1}));$.receiveShadow=!0,$.position.z=s.min.z-.1,(k=new THREE.OrbitControls(g,T.domElement)).update(),b.add(L),k.addEventListener("change",(function(){var e=new THREE.Vector3;g.getWorldPosition(e),B.position.copy(e),T.render(b,g)}));var y=new THREE.Vector3;g.getWorldPosition(y),B.position.copy(y),T.render(b,g)}),!1),(B=new THREE.HemisphereLight(15263976,0,1)).position.set(0,0,0),b.add(B),(T=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0})).setSize(550,455),$(".fullscreen .icon-resize-full").click((function(){T.setSize($(window).width(),$(window).height())})),$(".previewBox .close,.editImg").on("click",(function(){T.setSize(550,455)})),$(T.domElement).css({position:"absolute",display:"none"}),$(".previewBox .filePreview").append($(T.domElement).addClass(t.id)),window.addEventListener("resize",V,!1),setTimeout((function(){var i=T.domElement.toDataURL("image/png");n("",[{length:Math.abs(10*U),width:Math.abs(10*q),height:Math.abs(10*H),volume:Math.abs(1e3*_),unit:"mm",deliveryDays:f,materialId:d,quantity:1,listSurface:[],colorId:w,colorName:y,ossFileStl:l,image:i,firstUpload:"第一次上传",quotationName:t.name,token:null==e?"":null==e?"":e}],(function(e){if(console.log(e),0==e.code){$(".ossfile #"+t.id)[0].children[0].children[0].innerHTML='<i class="icon-ok"></i> 模型解析完成',$("#"+t.id).parent().parent().parent().hide(),j++;var i=$(".previewBox .filePreview").find("."+t.id)[0].toDataURL("image/png");N({quotationType:"",previewFilePath:l,serialNumber:j,sourceFilePath:l,fileId:t.id,canvasUrl:i,fileName:t.name,length:Math.abs(10*U).toFixed(1),width:Math.abs(10*q).toFixed(1),height:Math.abs(10*H).toFixed(1),volumes:Math.abs(1e3*_).toFixed(1),weight:e.obj.quotations[0].weight,defaultMaterialId:d,manufactureId:h,defaultMaterial:p,defaultColorId:w,defaultColor:y,materialsHtml:s,colorHtml:v,defaultSurface:m,lowPrice:e.obj.quotations[0].minimumPrice,unitPriceNumber:e.obj.quotations[0].promotionPrice,totalPriceNumber:e.obj.quotations[0].promotionTotal,discountPriceNumber:e.obj.quotations[0].promotionTotal,defaultDeliveryList:u,minimumPriceSign:e.obj.quotations[0].minimumPriceSign});for(var n=0;n<e.obj.quotations.length;n++)$($(".fileList .serialNumber")[n]).html(n+1);for(n=e.obj.quotations.length;n<0;n--)$($(".discountPrice .discountPriceNumber")[n]).html(e.obj.quotations[n].promotionPrice);c(),o();for(n=0;n<$(".fileList .minPriceHint").length;n++)"1"==$($(".fileList .minPriceHint")[n]).attr("id")&&$($(".fileListUl .fileList")[n]).find(".minPriceHint").show()}else layer.alert(e.msg,{icon:5})}))}),500)}(r)},P.ontimeout=function(e){console.log(e)},P.onerror=function(e){alert(e)},P.send(JSON.stringify({filePath:l,ext:x}))}else{ajax({url:"quotation/changeNew",data:{filePath:l,ext:".drc"}},(function(i){console.log(i);var a=i,r="";var g,b,T,x,P=new Image;P.setAttribute("crossOrigin","Anonymous"),P.src=ajaxUrl+i.obj.CoordinateBean.imageFile,P.onload=function(){r=function(e){var i=document.createElement("canvas");i.width=e.width,i.height=e.height,i.getContext("2d").drawImage(e,0,0,e.width,e.height);var t=e.src.substring(e.src.lastIndexOf(".")+1).toLowerCase();return i.toDataURL("image/"+t)}(P),n("",[{length:Math.abs(i.obj.CoordinateBean.x),width:Math.abs(i.obj.CoordinateBean.y),height:Math.abs(i.obj.CoordinateBean.z),volume:Math.abs(i.obj.CoordinateBean.actualVolume),unit:"mm",deliveryDays:f,materialId:d,quantity:1,listSurface:[],colorId:w,colorName:y,ossFileStl:l,image:r,firstUpload:"第一次上传",quotationName:t.name,token:null==e?"":null==e?"":e}],(function(e){if(console.log(e),0==e.code){$(".ossfile #"+t.id)[0].children[0].children[0].innerHTML='<i class="icon-ok"></i> 模型解析完成',$("#"+t.id).parent().parent().parent().hide(),j++,N({quotationType:"",previewFilePath:a.obj.CoordinateBean.ossDrc,serialNumber:j,sourceFilePath:l,fileId:t.id,canvasUrl:r,fileName:t.name,length:Math.abs(Number(a.obj.CoordinateBean.x)).toFixed(1),width:Math.abs(Number(a.obj.CoordinateBean.y)).toFixed(1),height:Math.abs(Number(a.obj.CoordinateBean.z)).toFixed(1),volumes:Math.abs(Number(a.obj.CoordinateBean.actualVolume)).toFixed(1),weight:e.obj.quotations[0].weight,defaultMaterialId:d,manufactureId:h,defaultMaterial:p,defaultColorId:w,defaultColor:y,materialsHtml:s,colorHtml:v,defaultSurface:m,lowPrice:e.obj.quotations[0].minimumPrice,unitPriceNumber:e.obj.quotations[0].promotionPrice,totalPriceNumber:e.obj.quotations[0].promotionTotal,discountPriceNumber:e.obj.quotations[0].promotionTotal,defaultDeliveryList:u,minimumPriceSign:e.obj.quotations[0].minimumPriceSign});for(var i=0;i<e.obj.quotations.length;i++)$($(".fileList .serialNumber")[i]).html(i+1);for(i=e.obj.quotations.length;i<0;i--)$($(".discountPrice .discountPriceNumber")[i]).html(e.obj.quotations[i].promotionPrice);c(),o();for(i=0;i<$(".fileList .minPriceHint").length;i++)"1"==$($(".fileList .minPriceHint")[i]).attr("id")&&$($(".fileListUl .fileList")[i]).find(".minPriceHint").show()}else layer.alert(e.msg,{icon:5})}))};document.querySelector("#abc");var k=new THREE.DRACOLoader;function B(){g.aspect=window.innerWidth/window.innerHeight,g.updateProjectionMatrix(),T.setSize(550,455),x&&x.update()}console.log(k),THREE.DRACOLoader.setDecoderPath("../../libs/objectViewer/draco/"),function(){(g=new THREE.PerspectiveCamera(35,550/455,.1,1500)).position.set(3,.25,3),(b=new THREE.Scene).background=new THREE.Color("#f5f5f5");var e=new THREE.AmbientLight(10066329,.5);b.add(e);var i,n=new THREE.PointLight(16777215);n.position.set(1,-1,1),b.add(n),(i=new THREE.PointLight(16777215)).position.set(-1,-1,1),b.add(i),(i=new THREE.PointLight(16777215)).position.set(1,-1,-1),b.add(i),k.load(ajaxUrl+a.obj.CoordinateBean.fileName,(function(e){console.log("geometry-------------",e),e.computeVertexNormals(),e.computeBoundingBox();var i=e.boundingBox,t=(new THREE.MeshStandardMaterial({color:"#51e242"}),new THREE.MeshLambertMaterial({ambient:"#444",color:"#444",specular:"#444",shininess:-2e3})),n=new THREE.Mesh(e,t);n.castShadow=!0,n.receiveShadow=!0;var o=0,a=i.getSize();o=Math.max(o,a.x),o=Math.max(o,a.y);var s=2/(o=Math.max(o,a.z)),l=new THREE.Vector3;i.getCenter(l);var r=new THREE.Matrix4;r.scale(new THREE.Vector3(s,s,s)),console.log("center",l,i,r),n.position.set(-l.x,-l.y,-l.z),n.updateMatrix(),n.applyMatrix(r),window.mesh=n,b.add(n)}),(function(e){console.log(e)}),(function(e){console.log(e)})),(T=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0})).setPixelRatio(window.devicePixelRatio),T.setSize(550,455),T.gammaInput=!0,T.gammaOutput=!0,T.shadowMap.enabled=!0,$(".fullscreen .icon-resize-full").click((function(){T.setSize($(window).width(),$(window).height())})),$(".previewBox .close,.editImg").on("click",(function(){T.setSize(550,455)})),$(".previewBox .filePreview").append($(T.domElement).addClass(t.id)),window.addEventListener("resize",B,!1),x=new THREE.OrbitControls(g,T.domElement)}(),function e(){I&&(x.update(),T.render(b,g));requestAnimationFrame(e)}()}))}}else document.getElementById(t.id).getElementsByTagName("b")[0].innerHTML=a.response},UploadComplete:function(e,i){},Error:function(e,i){-600==i.code?(layer.alert("文件大小不能大于100M",{icon:5}),setTimeout((function(){$("#console").html("")}),3e3)):-601==i.code?layer.alert("仅支持stl，obj，3ds，stp，step，igs，iges格式",{icon:5}):-602==i.code?layer.alert("这个文件已经上传过一遍了",{icon:5}):layer.alert("\nError xml:"+i.response,{icon:5})}}});k.init()}$.ajax({url:ajaxUrl+"quotation/upload",type:"post",headers:{token:null==e?"":e},data:JSON.stringify({token:e}),contentType:"application/json",success:function(e){$(".moxie-shim").remove(),S(e.obj.host,e.obj.policy,e.obj.accessid,e.obj.signature,e.obj.expire,e.obj.dir)}}),$(".upFileBox .upFileBtn").mousedown((function(){$.ajax({url:ajaxUrl+"quotation/upload",type:"post",headers:{token:null==e?"":e},data:JSON.stringify({token:e}),contentType:"application/json",success:function(e){0==e.code?S(e.obj.host,e.obj.policy,e.obj.accessid,e.obj.signature,e.obj.expire,e.obj.dir):layer.alert(e.msg,{icon:5})}})})),$("#ossfile,.progressShow").click((function(e){$("#ossfile").show(),e.stopPropagation()})),$(document).click((function(e){$("#ossfile").hide()})),$(".colorListUl .colorListItem").on("click",(function(){$(".selectColorBox input").val($(this).children("span").html())}));var L=[];function E(e,i,t,n){isPrevent="NO",i=[],$(".fileList .fileInfoUl").each((function(){var t=[];$(this).find(".surfaceSelect").each((function(){var e={};e.id=$(this).children("option:selected").attr("id"),e.surfaceName=$(this).children("option:selected").html(),e.colorValue=$(this).siblings(".pantone").find(".pantoneValue").val(),t.push(e)}));var n={};n.token=e,n.length=$(this)[0].children[2].children[1].children[0].innerHTML,n.width=$(this)[0].children[2].children[1].children[1].innerHTML,n.height=$(this)[0].children[2].children[1].children[2].innerHTML,n.volume=$(this)[0].children[2].children[2].children[0].innerHTML,n.weight=$(this).children(".partInfo").find(".weight").html(),n.deliveryDays=$(this).children(".deliveryTime").find("#deliveryTimeSelect").children("option:selected").attr("class"),n.deliveryDiscount=$(this).children(".deliveryTime").find("#deliveryTimeSelect").children("option:selected").val(),n.unit=$(this).children(".partInfo").find("#unitSelect").children("option:selected").val(),n.manufactureId=$(this).children().children().children("option:selected").val(),n.manufactureName=$(this).children().children().children("option:selected").attr("class"),n.materialId=$(this).find(".materialsSelect option:selected").attr("id"),n.materialName=$(this).find(".materialsSelect option:selected").html(),n.quantity=$(this).children(".number").find(".numberInput").val(),n.fileName=$(this).children(".partInfo").find(".fileName").html(),n.filePath=$(this).children(".thumbnail").attr("id"),n.ossFileStl=$(this).children(".thumbnail").attr("id"),n.image=$(this).children(".thumbnail").find("img").attr("src"),n.listSurface=t,n.offerType=$(this).attr("id"),n.colorId=$(this).find(".color option:selected").attr("id"),n.colorName=$(this).find(".color option:selected").html(),n.ossDrc=$(this).children(".serialNumber").attr("id"),i.push(n)})),$.ajax({url:ajaxUrl+t,type:"post",headers:{token:null==e?"":e},data:JSON.stringify(i),contentType:"application/json",success:function(e){if(console.log(e),0==e.code)window.location.href=n;else{if(60!=e.code)return layer.alert(e.msg,{icon:5}),!1;layer.alert(e.msg,{icon:5,closeBtn:0},(function(){delCookie(),layer.closeAll(),$(".formBox").show()}))}}})}var H="";$(".countBox .settleAccountsBtn").unbind().on("click",(function(){if(e=getCookie("token"),H="buy",0==$(".fileList").children().length)return alert("请上传文件"),!1;for(var i=0;i<$(".totalPriceNumber").length;i++)if("undefined"==$($(".totalPriceNumber")[i]).html())return alert("解析失败文件请手动输入参数报价"),!1;for(i=0;i<$(".pantoneValue").length;i++)if(0==$($(".pantoneValue")[i]).is(":hidden")&&""==$($(".pantoneValue")[i]).val().trim())return $($(".pantoneValue")[i]).focus().parent().siblings(".pantoneHint").show(),!1;null==e?$(".formBox").show():E(e,L,"quotation/toBuy","../addOrderForm/addOrderForm.html?cartType=cartdirect&deliveryTime=deliveryTime")})),$(".countBox .addCart").unbind().on("click",(function(){if(e=getCookie("token"),H="addCart",0==$(".fileList").children().length)return alert("请上传文件"),!1;for(var i=0;i<$(".totalPriceNumber").length;i++)if("undefined"==$($(".totalPriceNumber")[i]).html())return alert("解析失败文件请手动输入参数报价"),!1;for(i=0;i<$(".pantoneValue").length;i++)if(0==$($(".pantoneValue")[i]).is(":hidden")&&""==$($(".pantoneValue")[i]).val().trim())return $($(".pantoneValue")[i]).focus().parent().siblings(".pantoneHint").show(),!1;null==e?$(".formBox").show():E(e,L,"quotation/toCart","../shoppingCart/shoppingCart.html?from=07")})),$(".phoneBox .codeBtn").on("click",(function(){verificationCode($(".phoneBox .userName").val())}));var C=function(e){return document.getElementById(e)},q={_key:"F9387E75D65343CA87103DE403D7CDBFB7F0163776164FEC956406DB2DBD401D",_type:1,encrypt:function(e){var i=this._key,t=CryptoJS.enc.Utf8.parse(i),n=CryptoJS.DES.encrypt(e,t,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7}),o="";switch(this._type.toString()){case"1":o=n.ciphertext.toString(CryptoJS.enc.Hex)}return o}};$(".loginBtn").on("click",(function(){Date.parse(new Date);if("block"==$(".accountNumberBox").css("display")){if(""==$.trim($(".accountNumberBox .userName").val())||""==$.trim($(".accountNumberBox .passWord").val()))return alert("请输入用户名或密码"),!1;C("Ciphertext").value=q.encrypt(C("OriginalText").value),numberLogin((function(e){if(0==e.code){encodeURI(e.obj.userName);setCookie("token",e.obj.token,12,setCookieUrl),setCookie("designShopName",e.obj.designShopName,12,setCookieUrl),setCookie("designApply",e.obj.designApply,12,setCookieUrl),setCookie("designerApply",e.obj.designerApply,12,setCookieUrl),setCookie("monthlyKnots",e.obj.monthlyKnots,12,setCookieUrl),setCookie("userName",encodeURI(e.obj.userName),12,setCookieUrl),setCookie("iconImg",e.obj.imagePath,12,setCookieUrl),$(".formBox .title").css("opacity",0),$(".msg").html(e.msg).fadeIn(500).fadeOut(2e3),setTimeout((function(){$(".formBox").hide(),"buy"==H&&E(e.obj.token,L,"quotation/toBuy","../addOrderForm/addOrderForm.html?cartType=cartdirect&deliveryTime=deliveryTime"),"addCart"==H&&E(e.obj.token,L,"quotation/toCart","../shoppingCart/shoppingCart.html?from=07")}),1500)}else $(".formBox .title").css("opacity",0),$(".msg").html(e.msg).fadeIn(500).fadeOut(2500),setTimeout((function(){$(".formBox .title").css("opacity",1)}),3e3)}))}else{if(""==$.trim($(".phoneBox .userName").val())||""==$.trim($(".phoneBox .passWord").val()))return alert("请输入手机号或验证码"),!1;$.ajax({url:ajaxUrl+"message/verificationCodeByCode",type:"post",headers:{token:null==e?"":e},data:JSON.stringify({phone:$(".phoneBox .userName").val(),verificationCode:$(".phoneBox .passWord").val()}),contentType:"application/json",success:function(e){0==e.code?phoneLogin(getCookie("inviteCode"),(function(e){var i=encodeURI(e.obj.userName);0==e.code?(setCookie("token",e.obj.token,12,setCookieUrl),setCookie("designShopName",e.obj.designShopName,12,setCookieUrl),setCookie("designApply",e.obj.designApply,12,setCookieUrl),setCookie("designerApply",e.obj.designerApply,12,setCookieUrl),setCookie("monthlyKnots",e.obj.monthlyKnots,12,setCookieUrl),setCookie("userName",i,12,setCookieUrl),setCookie("iconImg",e.obj.imagePath,12,setCookieUrl),$(".formBox .title").css("opacity",0),$(".msg").html(e.msg).fadeIn(500).fadeOut(2e3),setTimeout((function(){$(".formBox").hide(),"buy"==H&&E(e.obj.token,L,"quotation/toBuy","../addOrderForm/addOrderForm.html?cartType=cartdirect&deliveryTime=deliveryTime"),"addCart"==H&&E(e.obj.token,L,"quotation/toCart","../shoppingCart/shoppingCart.html?from=07")}),1500)):($(".title").css("opacity",0),$(".msg").html(e.msg).fadeIn(500).fadeOut(2500),setTimeout((function(){$(".formBox .title").css("opacity",1)}),3e3))})):layer.alert(e.msg,{icon:5})}})}})),$(window).scroll((function(){$(document).height()-$(window).height()-$(window).scrollTop()>=380?($(".countBox").addClass("quoteFixed").css("margin-bottom","0px"),$("#contact").css("margin-top","138px"),$(".goBottom").show()):($(".countBox").removeClass("quoteFixed").css("margin-bottom","40px"),$("#contact").css("margin-top","0px"),$(".goBottom").hide())})),$(window).resize((function(){$(".countBox").removeClass("quoteFixed"),$("#contact").css("margin-top","0px")})),window.onbeforeunload=function(){if(0!=$(".fileListUl .fileList").length)return"确定要离开吗？"},$(".addCart,.settleAccountsBtn").mousedown((function(){window.onbeforeunload=function(e){}})),$(".previewBox .editImg").on("click",(function(){$(".thumbnail ."+$(".filePreview canvas:visible").attr("class")).attr("src",$(".filePreview canvas:visible").get(0).toDataURL("image/png")),$(".fullscreen .icon-resize-small").is(":visible")&&($(".previewBox").css("opacity",0).css("z-index",-1).css("width","550px").css("height","455px"),$(".icon-resize-full").show(),$(".icon-resize-small").hide(),I=!1)})),$(".priceRestrict .close,.priceRestrict .btn").on("click",(function(){$(".priceRestrict").hide()})),$(".formHeaderUl .inquiry").mouseover((function(){$(this).attr("src","../image/inquiry1.png")})).mouseout((function(){$(this).attr("src","../image/inquiry2.png")})),$(".formHeaderUl .inquiry,.upBox .character").click((function(){window.open("../printedInstructions/printedInstructions.html?navPrint="+encodeURI("材料介绍"))})),"hide"!=localStorage.getItem("isFormat")&&($(".addFormatBox").show(),$(".tipsDialog").show()),$(".tipsDialog .close,.gifBox img").on("click",(function(){localStorage.setItem("isFormat","hide"),$(".addFormatBox").hide(),$(".tipsDialog").hide()})),$(".fullscreen .icon-resize-full").click((function(){$(".previewBox,.filePreview, .filePreview canvas").css("width","100%").css("height","100%"),$(".icon-resize-full").hide(),$(".icon-resize-small").show()})),$(".fullscreen .icon-resize-small").click((function(){$(".previewBox,.filePreview, .filePreview canvas").css("width","550px").css("height","455px"),$(".icon-resize-full").show(),$(".icon-resize-small").hide()})),$(".previewBox .close").on("click",(function(){$(".previewBox").css("opacity",0).css("z-index",-1).css("width","550px").css("height","455px"),$(".icon-resize-full").show(),$(".icon-resize-small").hide(),I=!1}))}))},77:function(e,i){}});