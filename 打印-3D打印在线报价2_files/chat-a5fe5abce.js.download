!function(){"use strict";function e(){this.create=function(e,t){return this.ioLink=io.connect(e,t),this},this.close=function(){this.ioLink.disconnect()},this.emitMsg=function(e,t,i,n){return this.ioLink&&this.ioLink.compress(!1).emit(e,t),i&&i.call(n),this},this.receiveMsg=function(e,t,i,n,a){var i=i||this;return a?this.ioLink.once(e,function(e){n&&$.extend(e,n),t&&t.call(i,e)}):this.ioLink.on(e,function(e){n&&$.extend(e,n),t&&t.call(i,e)}),this}}function t(){pt.chatListWrap[0].scrollTop=pt.chatListWrap[0].scrollHeight}function i(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)}function n(e){var t=100,i=e,n=i-t+1;return Math.floor(Math.random()*n+t)}function a(e){var i,n=!0,a=e.msgType,o={seq:e.seq};switch(a){case"tmpl":i=$.tmpl(dt.CHAT_MSG_TPL[e.type],e.data);break;case"serverResp":i=e.data;break;case"feedBack":i=e.replyContent;break;case"sessionEnd":i=e.data||$.i18n(dt.SYS_MSG[e.type]);break;default:i=$.i18n(dt.SYS_MSG[e.type])}$.extend(o,{msg:i}),"sessionEnd"==e.type&&(ft.isChangeKF?n=!1:ft.ioLinkStatus="sessionOver"),e.empty&&pt.chatBody.hasClass("regsuccess")&&(e.empty=!1),n&&!e.notip&&(e.empty?(pt.chatListWrap.empty().append(St(dt.CHAT_MSG_TPL.sys,o)),pt.chatListWrap.append($(dt.CHAT_MSG_TPL.tencentCert))):(pt.chatBody.hasClass("regsuccess")||pt.chatBody.hasClass("reconnect"))&&"new"==e.act?pt.chatListWrap.find(".tencent-certification").before(St(dt.CHAT_MSG_TPL.sys,o)):"update"==e.act?pt.chatBody.hasClass("regsuccess")||pt.chatBody.hasClass("reconnect")?$('[data-guid="'+e.seq+'"]').find(".text").html(o.msg):pt.chatListWrap.find(".msg-sys").last().find(".text").html(o.msg):"remove"==e.act&&$('[data-guid="'+e.seq+'"]').remove(),t())}function o(e,t,i,n,a){a&&(a=new Date(+new Date+a));var o=e+"="+escape(t)+(a?"; expires="+a.toGMTString():"")+(n?"; path="+n:"")+(i?"; domain="+i:"");return o.length<4096&&(Tt.cookie=o),this}function s(e){var t=Tt.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=t?unescape(t[2]):null}function r(){var e=s("uin");return e?Math.floor(e.substring(1)):""}function c(e){for(var t,i=Ct.get(ft.seqs.key),n=kt.getType(e),a=kt.getBody(e),o=new RegExp(a,"gm"),s=!0;null!=(t=o.exec(i));)if(n==i.substr(t.index+13,1))return BJ_REPORT.report("Duplicate Msg SingleSeqs "+e),xt(JSON.stringify(ft.seqs.data)),!1;return s}function l(e,t,i){var n,a="kf"+e,o=JSON.parse(Ct.get(a))||[];return o.forEach(function(e){e.visitorId==t&&(n=e.total,"set"==i&&(n++,e.total=n))}),"get"==i?n:void Ct.set("kf"+e,JSON.stringify(o))}function d(){var e="zh-cn",t=ft.isInIframe;return e=t?ft.lang||"":Ft(window.location.href,"qidian_lang")||"",ft.lang=e.toLowerCase()||"zh-cn",$.i18n({locale:ft.lang}),$.i18n().load({"zh-cn":jt,"en-us":Jt})}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/\${2,3}(.*?)\${2,3}/g,function(e,t){return $.i18n(t)})}function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"add",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"qq",i=pt.header.find("span.title"),n=ft.isMobile?"H5":"PC";"add"==e?"qq"==t&&0==pt.callGroup.find(".btn-callqq").length?pt.callGroup.append(f(dt.HEADER_TPL[n].BTN_CALL_QQ)):"tel"==t&&0==pt.callGroup.find(".btn-calltel").length&&pt.callGroup.append(f(dt.HEADER_TPL[n].BTN_CALL_TEL)):"remove"==e&&("qq"==t?pt.callGroup.find(".btn-callqq").remove():"tel"==t&&pt.callGroup.find(".btn-calltel").remove()),2==pt.callGroup.children().length?i.addClass("title-mini"):i.removeClass("title-mini")}function p(e,t,i){var n=this,a=$($.tmpl(dt.CHAT_MSG_TPL.blackTip,e));pt.chatList.append(a),setTimeout(function(){a.remove(),i&&i.apply(n)},t)}function g(e){var t=$.extend(!0,{},ft.getSigTData),i=ft.receptionist.extUin,n=e.type;window.bindCallQQEvent=function(e){var t,i=1e3;return ft.inRegProcess=0,e&&0==e.r&&"undefined"!=typeof e.data.sign?(t=e.data.sign,void Wt(t)):void p({text:"点击失败："+e.data.message},i)},("qq"==n||"qqCorpUin"==n)&&($.extend(t,{roleValue:0,reqPos:e.reqPos,reqSrc:"routeChange",isCorpUin:"qqCorpUin"==n?1:0}),e.data?$.extend(t,e.data):$.extend(t,{roleData:i,clickid:ct()}),de(t,dt.CGI_URL.GET_TENCENT_SCHEME,"bindCallQQEvent"))}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"qq"};$.extend(t,{reqPos:e.attr("reqpos")}),e.off(ft.clickName).on(ft.clickName,$.proxy(g,null,t))}function _(e){window.open(e,"_blank")}function h(e){for(var t,i=ft.seqs.data,n=(kt.getType(e),kt.getBody(e)),a=i.length,o=0;a>o;o++)if(t=i[o],n<kt.getBody(t))return{act:"insert",insertSeqs:t,singleSeqs:e,index:o};return{act:"append",singleSeqs:e}}function v(e){Xt="init",e&&e.removeClass("msg-voice--playing")}function q(e,t){var i=void 0;switch(e){case"fail":i=$($.tmpl(dt.CHAT_MSG_TPL.translateTip,{icon:e,tip:"转文字失败"}))}pt.chatList.append(i),t&&setTimeout(function(){i.remove()},1500)}function y(e,t){return"c2b"==e?-1!=t.indexOf("f_")?t:t.replace(/\[(.*?)\]/g,function(e,t){for(var i=0;i<Ht.locale.length;i++)if($.i18n(Ht.locale[i])==t)return"[f_"+Ht.index[i]+"]";return e}):"b2c"==e?t:void 0}function b(e){for(var t=e.seq,i=ft.c2bSeqGroup,n=0;n<i.length;n++)i[n].seq==t&&(i.splice(n,1),ft.c2bSeqGroup=i,Ai.normal.sendFail(e),Qt.handleC2bReceiveSeq(1,t),Zt.handleAck(e,"fail"))}function S(e,t,i,n,a,o){var s,r,c=ft.chatSocket,l=ft.wpaDetail,d=ft.ioLinkStatus;if(c.ioLink&&c.ioLink.disconnected&&"sessionOver"!=d&&(d="over",ft.ioLinkStatus="over",Kt.remove(),ft.registerActionType=6),1==t.type&&("undefined"!=typeof t.originMsgContent&&(t.data=t.originMsgContent,delete t.originMsgContent),t.data=y(e,t.data)),"welcome"!=i)if("c2b"==e){switch(r=t.date,$.extend(t,{clickid:l.clickid,date:r}),ft.thirdAppConfig.enable&&$.extend(t,{thirdAppInfo:$.extend({},ft.thirdAppConfig)}),2===ft.registerType&&(1==ft.menuDetail.defaultConfig.active?($.extend(ft.getSigTData,{roleValue:ft.menuDetail.defaultConfig.roleValue,roleData:ft.menuDetail.defaultConfig.roleData}),ft.menuDetail.defaultConfig.active=0,ft.ioLinkStatus=d="over",ft.registerActionType=5):pt.chatBody.hasClass("regsuccess")&&$.extend(t,{queueKey:ft.queueKey})),pt.chatBody.hasClass("regsuccess")||(d="none"),d){case"over":s=t,BJ_REPORT.info("IoLink Over ReConnect"),Hi().reConnect(!1);break;case"sessionOver":s=t,BJ_REPORT.info("Session Over ReConnect"),ft.registerActionType=7,Hi().reConnect();break;case"normal":-1!=t.type&&(ft.isChangeKF&&(c.emitMsg(dt.SOCKET_CMD.KF_CHANGE.EMIT,{kf:""}),pt.chatListWrap.find(".btn-newkf").addClass("disabled"),1==ft.routePermit.isNeedQQ&&(u(),m(pt.callGroup.find(".btn-callqq"),{type:ft.routePermit.isCorpUin?"qqCorpUin":"qq"}))),s=null,Kt.update(),c.emitMsg(dt.SOCKET_CMD.C2B.EMIT,t))}-1!=t.type&&(setTimeout(function(){b(t)},dt.SOCKET_OPTS.C2B_TIMEOUT),Nt.saveMsgToDB(t)),pt.chatBody.hasClass("regsuccess")&&(ft.reSendC2bMsg=s),4739345==t.data&&(Ct.clear(),ft.win.location.reload())}else if("b2c"==e&&("msg"===i&&Kt.update(),a&&ft.chatSocket.emitMsg(dt.SOCKET_CMD.B2C.EMIT,{date:t.date,seq:t.seq,sortseq:t.sortseq-ft.serverClientTimeDiff,csrf:t.csrf}),a&&("undefined"==typeof t.csrf||!t.csrf)&&BJ_REPORT.report("B2C Ack Csrf Error "+JSON.stringify(t)),o&&Nt.saveMsg(e,t,n),6==t.type)){var f=Ct.get("offlineSeq")||"[]",p=-1;f=JSON.parse(f);for(var g=0;g<f.length;g++)t.seq==f[g]&&(p=g);-1!=p&&(f.splice(p,1),Ct.set("offlineSeq",JSON.stringify(f)))}}function T(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"prepend",n=e.toString().length;t>n;)e="prepend"==i?"0"+e:e+"0",n++;return e}function w(e){var e=new Date(e),t=T(e.getMonth()+1,2),i=T(e.getDate(),2),n=T(e.getHours(),2),a=T(e.getMinutes(),2);return t+"-"+i+"&nbsp;"+n+":"+a}function C(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"append";vt?e-vt>dt.VIEW_OPTS.TIME_INTERVAL&&(vt=e,"append"==t?pt.chatListWrap.find(".tencent-certification").before(St(dt.CHAT_MSG_TPL.time,w(vt))):pt.chatListWrap[t](St(dt.CHAT_MSG_TPL.time,w(vt)))):(vt=e,"append"==t?pt.chatListWrap.find(".tencent-certification").before(St(dt.CHAT_MSG_TPL.time,w(vt))):pt.chatListWrap[t](St(dt.CHAT_MSG_TPL.time,w(vt))))}function k(e){var t;pt.chatBody.append('<div class="mod-fullscreen"><div class="overlay"></div></div>'),t=$(".mod-fullscreen"),ft.isMobile&&t.on("touchmove",function(e){return e.preventDefault(),!1}),e&&e(t)}function x(){var e={kfuin:ft.receptionist.kfUin,kfext:ft.receptionist.extUin,wpaId:ft.wpaDetail.wpaId,key:ft.wpaDetail.wpaKey};E(e)}function E(e){$.ajax({url:dt.CGI_URL.GET_RECEPTION_DETAIL+"?kfuin="+e.kfuin,data:e,type:"POST",timeout:2e3,dataType:"json",success:function(e){R(e)},fail:function(e){BJ_REPORT.report("get reception detail error"),BJ_REPORT.report(JSON.stringify(e))}})}function R(e){e.avatar||(e.avatar=dt.CGI_URL.COMP_SOURCE_URL+"img/default-logo.png"),$(".sidebar").html($.tmpl(dt.CHAT_MSG_TPL.receptionInfo,e)),ft.isShowQidianSign&&$(".sidebar").append($.tmpl('<div class="tencent-cert">'+dt.CHAT_MSG_TPL.tencentCert+"</div>",{}))}function I(e,t,i){var n=document.getElementsByTagName("script"),a=n[n.length-1],o=document.createElement("script"),s=!1;o.src=e,o.async=!0,a.parentNode.insertBefore(o,a),o.onload=o.onreadystatechange=function(){s||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(s=!0,t&&t.apply(i,arguments),o.onload=o.onreadystatechange=null)}}function O(e){I(dt.CGI_URL.GET_WX_MP_JSSDK_SOURCE,function(){e&&e()})}function P(e){var t=$.Deferred(),i=Ft(e.url,"appid"),n=Ft(e.url,"kfuin"),a=parseInt(+new Date/1e3),o="qidianwebim2019",s=location.href.split("#")[0];return $.ajax({url:dt.CGI_URL.GET_WX_MP_JSSDK_SIGNATURE+"?kfuin="+n,type:"GET",data:{appid:i,timestamp:a,nonceStr:o,url:s},success:function(e){if(0==e.code||0==e.r){var n={appId:i,timestamp:a,nonceStr:o,signature:e.data.signature};t.resolve(n)}else t.reject(e)},error:function(e,i){var n={code:e.status,msg:i};t.reject(n)}}),t.promise()}function M(e,t){var i=$.Deferred();return wx&&wx.ready(function(){t&&t(),i.resolve()}),wx&&wx.error(function(e){i.reject({code:-1,msg:e.errMsg})}),wx&&wx.config(e),i.promise()}function L(e){var t=$.Deferred();return O(function(){P(e).then(function(i){var n=$.extend({},i,{debug:pi,jsApiList:gi});M(n,e.callback).then(function(){ft.wxConfig.appid=n.appId,t.resolve()},function(e){t.reject(e)})},function(e){t.reject(e)})}),t.promise()}function D(e,t){var i=new Image,n=$(window),a=0,o={width:1,height:1},s={width:0,height:0},r={width:n.innerWidth()-160,height:n.innerHeight()},c={width:0,height:0};i.onload=function(){return s={width:i.width,height:i.height},a=Math.max(s.width,s.height),o={width:s.width/s.height,height:s.height/s.width},s.width<=r.width&&s.height<=r.height?c={width:s.width,height:s.height}:s.width==a?(c.width=r.width,c.height=Math.floor(c.width*o.height)):(c.height=r.height,c.width=Math.floor(c.height*o.width)),e.find("img").attr({width:c.width,height:c.height,src:t}).css({"margin-top":0-c.height/2,"margin-left":0-c.width/2}),c},i.src=t}function A(){function e(){i=!1,s?document.dispatchEvent(n):document.documentElement.visibilitychange=1}function t(){i=!0,s?document.dispatchEvent(n):document.documentElement.visibilitychange=0}var i=void 0,n=null,a=function(e){var t=document.createElement("b");return t.innerHTML="<!--[if IE "+e+"]><i></i><![endif]-->",1===t.getElementsByTagName("i").length},o=a(),s=a(9),r=s?"":null,c=function(e,t){return""!==e?e+t.slice(0,1).toUpperCase()+t.slice(1):t},l=function(){var e=!1;return"number"==typeof window.screenX&&["webkit","moz","ms","o",""].forEach(function(t){0==e&&void 0!=document[c(t,"hidden")]&&(r=t,e=!0)}),e}();o&&!l&&(document.addEventListener?(window.addEventListener("focus",e,!0),window.addEventListener("blur",t,!0)):(document.attachEvent("onfocusin",e),document.attachEvent("onfocusout",t)),"undefined"==typeof document.createEvent||n?document.documentElement.visibilitychange=0:(n=document.createEvent("HTMLEvents"),n.initEvent("visibilitychange",!0,!0)));var d=function(){return l?document[c(r,"hidden")]:"undefined"!=typeof i?i:void 0},f=function(){return l?document[c(r,"visibilityState")]:"undefined"!=typeof i?i?"hidden":"visible":void 0};return{hidden:d(),isHidden:d,isPageVisibilitySupport:l,visibilityState:f(),visibilitychange:function(e,t){if(t=!1,"function"==typeof e){if(l||s)return document.addEventListener(r+"visibilitychange",function(t){e.call(this,t,d(),f())},t);document.documentElement.attachEvent("onpropertychange",function(t){"visibilitychange"==event.propertyName&&e.call(this,t,d(),f())})}}}}function N(e,t){var i=new Image,n=$(window),a=0,o={width:1,height:1},s={width:0,height:0},r={width:n.innerWidth()-160,height:n.innerHeight()},c={width:0,height:0};i.onload=function(){return s={width:i.width,height:i.height},a=Math.max(s.width,s.height),o={width:s.width/s.height,height:s.height/s.width},s.width<=r.width&&s.height<=r.height?c={width:s.width,height:s.height}:s.width==a?(c.width=r.width,c.height=Math.floor(c.width*o.height)):(c.height=r.height,c.width=Math.floor(c.height*o.width)),e.find("img").attr({width:c.width,height:c.height,src:t}).css({"margin-top":0-c.height/2,"margin-left":0-c.width/2}),c},i.src=t}function G(e,t){var i=t.code;switch(0!==i&&BJ_REPORT.report("Image Upload Error "+JSON.stringify(t)),i){case 0:S("c2b",{data:t.fileId,seq:e.seq,wordMsgSeq:n(dt.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC),date:e.date,type:2,imgSrc:t.uri},"msg"),t._raw&&(e.blobUrl=t.uri,replacePlaceholder(e)),Di(2,t.fileId),$('[data-guid="'+e.seq+'"]').find("i").removeClass();break;case 1:K().sendFail(e,"overSumLimit");break;case 2:K().sendFail(e,"notSupport");break;default:K().sendFail(e,"uploadError")}}function B(e){return e.replace(ni,function(e){return'<a href="'+ai(e)+'" target="_blank" class="text-link">'+e+"</a>"})}function U(e,t,i){function n(e){yt.send({act:"OPEN_IMG",data:{url:e}})}var a,o,s=e.is("img")?e:e.find("p.image");ft.isMobile?s.off("tap").on("tap",function(){k(function(e){e.append('<img class="big-image" src="'+t+'"/>'),e.on("touchend",function(t){e.remove()})})}):($("body").delegate(s,"click",function(e){"INPUT"!=e.target.nodeName&&e.preventDefault()}),s.off("click").on("click",function(e){ft.isInIframe?i?(a=new FileReader,a.onload=function(e){n(e.target.result)},a.readAsDataURL(i.content)):n(t):(o=t?t:i.blobUrl,k(function(e){e.append('<div class="img-wrap"><img class="" src=""/><a href="javascript:;" class="btn-close"></a></div>'),N(e,o),e.on("click","a.btn-close",function(t){t.preventDefault(),e.remove()})}))}))}function H(e,i,n){var a=e.getAttribute("src"),o=a.replace(/\/720$/g,"/0"),s=$(e).parent(),r=0;e.onload=function(){$(this).parent().css("background-image","none"),e.getAttribute("src")===ft.imageLoadFail?BJ_REPORT.report("B2C Image Load Error to Success Src: "+a):(U($(this),o),i&&t()),s.find("i").removeClass(),s.find("i").remove()},"session"==n&&(e.onerror=function(n){this.setAttribute("src",ft.imageLoadFail),s.find("i").removeClass(),s.on(ft.clickName,function(){e.setAttribute("src",a),s.append('<i class="loading loading-s"></i>')}),0===r&&i&&t(),BJ_REPORT.report("B2C Image Load Error By "+ ++r+" Src: "+a)})}function F(e,t){var e="undefined"!=typeof ft.win.emoji?ft.win.emoji.replace_unified(e):e,i=ft.isMobile?dt.CGI_URL.QQ_FACE:dt.CGI_URL.COMP_SOURCE_URL+"img/qq/";return e.replace(/\[(.*?)\]/g,function(e,n){var a;if(0==n.indexOf("f")){n=n.match(/\d+/g);for(var o=0;o<Ht.index.length;o++)if(Ht.index[o]==n){a=o;break}}else if("b2c"!=t)for(var o=0;o<Ht.locale.length;o++)if($.i18n(Ht.locale[o])==n){a=o;break}return a||0===a?'<img src="'+i+a+'.png" class="face"/>':e})}function J(e){var t;ft.win.FormData&&(t=new FormData,t.append("media",e.content),t.append("visitId",ft.receptionist.visitorId),t.append("receptionUin",ft.receptionist[2==ft.registerType?"kfUin":"extUin"]),$.ajax({url:dt.CGI_URL.UPLOAD_IMG+"?kfuin="+ft.receptionist.kfUin,data:t,processData:!1,contentType:!1,type:"POST",timeout:5e4,error:function(){K().sendFail(e,"uploadError")},success:function(t){G(e,t)}}))}function j(){function e(e){var i="kf"+ft.receptionist.kfUin,o=JSON.parse(Ct.get(i));0==a.isLoad&&(a.isLoad=1,o&&o.forEach(function(e){e.visitorId==ft.receptionist.visitorId&&(a.sum=e.total)}),a.sum>0&&(n(e),1!=a.pageNum||e?"":t()))}function i(e,t){var i,n=e.dir,a=parseInt($.trim(e.type)),t=t||"down",o=Dt.hasSeqInMsgCache(e.seq);switch(a){case 1:e.data=B(bt(e.data)),e.data=F(e.data,n),i=$(St(dt.CHAT_MSG_TPL[n],e),n);break;case 2:n="c2b"==n?"c2bImage":"b2cImage",i=$(St(dt.CHAT_MSG_TPL[n],e)),H(i.find("p.image img")[0]);break;case 3:$.extend(e.data,{currentVersion:ft.menuDetail.currentVersion}),e.data.config||$.extend(!0,e.data,{config:{menu:0,button:0}}),i=$($.tmpl(dt.CHAT_MSG_TPL.menuMsgNormal,e.data)),ii().bindEvents(i);break;case 4:li.render(e,e.dir,{isNeedStore:!1,isNeedWrap:!0,isFromHistory:!0});break;case 5:var a=e.data.type?e.data.type:1;switch(a){case 1:i=fi.render(e,{isFromHistory:!0});break;case 2:i=Qt.render(e,{isFromHistory:!0});break;case 3:i=wi.render(e,{isFromHistory:!0});break;case 4:i=Ri.render(e,{isGoBot:!1});break;case 5:i=bi.render(e,{isFromHistory:!0})}break;case 7:var s=e.data.channel?e.data.channel:1;switch(s){case s:i=Zt.render(e,{isFromHistory:!0,cacheStatus:o})}break;default:BJ_REPORT.report("History Msg Render Error Type "+a)}switch(i&&("down"==t?pt.chatListWrap.find(".tencent-certification").before(i).trigger("graphicMsgLoad",e):pt.chatListWrap.prepend(i).trigger("graphicMsgLoad",e)),Si.init({$el:i,msgData:e,type:"robotSatisfaction"}),/Image/g.test(n)&&U(i,e.data.replace(/\/720$/g,"/0")),o){case"ack":W().sendFail(e);break;case"unconnect":$('[data-guid="'+e.seq+'"]').find("i").addClass("loading loading-s")}}function n(e){var t,s,r,c,l=ft.receptionist.kfUin,d=ft.receptionist.visitorId,f=dt.VIEW_OPTS.HISTORY_MSG.PER_NUM,u=ft.seqs.data;r=a.sum-f,0>r&&(r=0);for(var p=a.sum;p>r;p--)t="kf"+l+"vId"+d+"index"+u[p-1],s=JSON.parse(Ct.get(t)),s?(i(s,"up"),s.time&&4!=s.type&&pt.chatListWrap.prepend(St(dt.CHAT_MSG_TPL.time,w(s.time)))):BJ_REPORT.report("History RenderAll Msg Error"),a.sum--;0==a.pageNum?o=pt.chatListWrap[0].scrollHeight+60:setTimeout(function(){o=pt.chatListWrap[0].scrollHeight-o,pt.chatListWrap[0].scrollTop=o,o=pt.chatListWrap[0].scrollHeight},20),a.pageNum++,a.sum<=0?a.pageNum=1:(c=$(St(dt.CHAT_MSG_TPL.msgLoad.getMsg,$.i18n(dt.VIEW_OPTS.HISTORY_MSG.GET_MSG))),pt.chatListWrap.prepend(c),c.find("a").one(ft.clickName,function(){o=e?pt.chatListWrap[0].scrollHeight:o,c.html(St(dt.CHAT_MSG_TPL.msgLoad.loading,$.i18n(dt.VIEW_OPTS.HISTORY_MSG.LOADING))),setTimeout(function(){c.remove(),n()},200)}))}var a={sum:0,pageNum:0,isLoad:0},o=0;return{start:e,renderSingle:i}}function W(){function e(e,n){var a,o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"msg",r=arguments[3],c=arguments[4],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"true",d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"true",f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"true",u=pt.chatListWrap[0],p=r,g=c||{act:"append"},m=ft.isRealSendMsg;if(~e.indexOf("b2c")&&Math.abs(u.scrollHeight-u.scrollTop-u.offsetHeight)<=5&&(p=!0),6==n.type){var _=ft.receptionist&&ft.receptionist.corpName;a=$(St(dt.CHAT_MSG_TPL.sys,_+$.i18n(dt.SYS_MSG.revoke)))}else a=i(e,n,p);a&&(Si.init({$el:a,msgData:n,type:"robotSatisfaction"}),f&&("insert"==g.act?(o=$('[data-guid="'+JSON.parse(Ct.get("kf"+ft.receptionist.kfUin+"vId"+ft.receptionist.visitorId+"index"+g.insertSeqs)).seq+'"]'),a.insertBefore(o)):"prepend"==g.act?(pt.chatListWrap[g.act](a),C(n.date,g.act)):(C(n.date,g.act),pt.chatListWrap.find(".tencent-certification").before(a))),"b2c"===e&&Mi.main(a[0],n),"c2b"!=e&&"c2bImage"!=e||"msg"!=s||!m||$('[data-guid="'+n.seq+'"]').find("i").addClass("loading loading-s"),"c2b"==e&&Di(1,n.data),("open"==ft.imStatus&&"c2b"==e||p)&&t(),"c2bImage"!=s&&m&&S(e,n,s,g,l,d))}function i(e,t,i){var n="c2b"==e?new RegExp(/\n/g):new RegExp(/\r/g),a=t.data;if(("undefined"==typeof t.avatar||0==t.avatar.length)&&(t.avatar=ft.defaultAvatar),1==t.type&&(t.originMsgContent=a,t.data=B(bt(a))),"b2c"==e&&2==t.type){3==t.img_type&&(t.data=t.data.replace(/\/720$/g,"/0"));var o=$(St(dt.CHAT_MSG_TPL.b2cImage,t));return H(o.find("p.image img")[0],i,"session"),o}if(4==t.type)return $.tmpl(t.data.tpl,t.data);if(5==t.type){var s=t.data.type?t.data.type:1;switch(s){case 1:return fi.render(t,{isFromHistory:!1});case 2:return Qt.render(t,{isFromHistory:!1});case 3:return wi.render(t,{isFromHistory:!1});case 4:return Ri.render(t,{isGoBot:!0});case 5:return bi.render(t,{isGoBot:!0});case 101:return Oi.renderMsg(t);default:BJ_REPORT&&BJ_REPORT.report("Unknown b2c data.type: "+s)}}else{if(7!=t.type)return t.data=t.data&&"string"==typeof t.data?F(t.data,e):t.data,$(St(dt.CHAT_MSG_TPL[e],t).replace(n,"<br/>"));var r=t.data.channel?t.data.channel:1;switch(r){case 1:return Zt.render(t,{isFromHistory:!1})}}}function n(e){var t=ft.c2bSeqGroup,i=e.seq,n=e.errcode,a=$('[data-guid="'+i+'"]').find("i");a.removeAttr("class").addClass("icon-fail");for(var o=0;o<t.length;o++)if(t[o].seq===i){$.extend(e,t[o]);break}a.data("reSendData",e),BJ_REPORT.report("C2B Msg Fail Seqs "+e.date+e.type),a.off(ft.clickName),a.one(ft.clickName,function(){var e=$(this).data("reSendData");ft.reSendC2bMsg=e,50011===n&&(ft.ioLinkStatus="over",ft.registerType="default",delete e.errcode),$(this).removeClass("icon-fail").addClass("loading loading-s"),S("c2b",e,"msg")})}function a(e){var t=e.body&&e.body.seq,i=$('[data-guid="'+t+'"]').find(".loading"),a=ft.c2bSeqGroup;if("success"==e.result&&t){i.removeClass("loading loading-s"),ft.isChangeKF=0,Dt.removeMsgCache(t);for(var o=0;o<a.length;o++)if(a[o].seq==t){a.splice(o,1),ft.c2bSeqGroup=a;break}Qt.handleC2bReceiveSeq(0,t),Zt.handleAck(e.body,"success")}else n({data:e.body.data,seq:e.body.seq,wordMsgSeq:e.body.wordMsgSeq,errcode:"undefined"!=typeof e.errcode?parseInt(e.errcode):1}),Qt.handleC2bReceiveSeq(1,t),Zt.handleAck(e.body,"fail")}function o(t){var i=t.body,n=Ct.get("offlineSeq")||"[]";if(n=JSON.parse(n),n.length)for(var a=0;a<n.length;a++)n[a]==i.sortseq&&6!=i.type&&(i.type=6,i.data="该条消息已经撤回");if(6==i.type&&"该条消息已经撤回"!=i.data){for(var o=i.sortseq,r=0,a=1;5>=a;a++){var l="kf"+ft.receptionist.kfUin+"vId"+ft.receptionist.visitorId+"index"+o+a;if(Ct.get(l)){r=l;break}}if(0!==r){var d=$('[data-guid="'+JSON.parse(Ct.get(r)).seq+'"]'),f=ft.receptionist&&ft.receptionist.corpName,u={type:6,data:"该条消息已经撤回"};d.after(St(dt.CHAT_MSG_TPL.sys,f+$.i18n(dt.SYS_MSG.revoke))).remove(),Ct.set(r,JSON.stringify(u))}else{for(var p=!0,a=0;a<n.length;a++)i.sortseq==n[a]&&(p=!1);p&&(n.push(i.sortseq),Ct.set("offlineSeq",JSON.stringify(n)))}return void ft.chatSocket.emitMsg(dt.SOCKET_CMD.B2C.EMIT,{date:i.date,seq:i.seq,sortseq:i.sortseq-ft.serverClientTimeDiff,csrf:i.csrf})}var g=kt.setType(i.sortseq,i.type),m={face:ft.receptionist.avatar,name:ft.receptionist.name},_=c(g),v={};i.u_info.face&&$.extend(m,i.u_info),i.u_info.name&&$.extend(m,i.u_info),!_&&ft.chatSocket.emitMsg(dt.SOCKET_CMD.B2C.EMIT,{date:i.date,seq:i.seq,sortseq:i.sortseq,csrf:i.csrf}),i.sortseq&&c(g)?(v=h(g),e("b2c",{avatar:m.face,name:m.name,data:i.data,img_type:i.img_type,date:i.date,seq:i.seq,type:i.type,csrf:i.csrf,sortseq:i.sortseq,vote:i.vote},"msg",null,v),Li.isHidden()&&s.twinkling(),Li.visibilitychange(function(e,t,i){0==t&&"visible"==i&&s.clearTimer()}),"close"==ft.imStatus&&oi.set(ft.receptionist,ft.wpaDetail.wpaId,function(e){yt.send({act:"UNREAD",data:{number:e,onlyOpen:!0}})})):i.sortseq||BJ_REPORT.report("B2C Sortseq Null "+JSON.stringify(t))}var s=new $i({dynamicTitle:!0,interval:1e3});return{render:e,conventSigle:i,sendFail:n,sendRet:a,renderB2C:o}}function K(){function e(e,t){var i=e;$.extend(i,{date:+new Date}),W().render("c2bImage",{seq:e.seq,date:e.date},"msg"),t&&n(e,t)}function i(e){var t=e.seq,i=$('[data-guid="'+t+'"]').find("img");e.blobUrl?(i.attr("src",e.blobUrl),U(i,e.blobUrl),H(i[0],!0),e.size>dt.IMG_UPLOAD_OPTS.MAX_SIZE?n(e,"overSumLimit"):J(e)):e.DataURL&&(i.attr("src",e.DataURL),H(i[0],!0),e.size>dt.IMG_UPLOAD_OPTS.MAX_SIZE&&n(e,"overSumLimit"))}function n(e,i){var n=e.seq,a=$('[data-guid="'+n+'"]'),o=a.find("i");BJ_REPORT.report("Image Msg Send Error Reason "+i),o.removeClass("loading loading-s").addClass("icon-fail").data("reason",i),"uploadError"==i?o.off(ft.clickName).on(ft.clickName,function(){$(this).removeClass("icon-fail").addClass("loading loading-s"),J(e)}):a.find("p.image").addClass(i),t()}return{render:e,replacePlaceholder:i,sendFail:n}}function V(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1,i=e.body||{},n=i.u_info?i.u_info:i.data,a=i.c_info||{};ft.menuDetail.active=0,ft.registerType=n.type||2,ft.queueKey=n.queueKey,ft.isRealSendMsg=1,ft.reSendC2bMsg&&ft.queueKey&&$.extend(ft.reSendC2bMsg,{queueKey:ft.queueKey}),t&&ft.chatSocket.emitMsg(dt.SOCKET_CMD.SESSION_MSG.EMIT,{csrf:i.csrf,seq:i.seq,type:i.type,time:i.time}),Ai.normal.render("b2c",{avatar:a.face||ft.defaultAvatar,name:a.name,data:n.queueMsg,date:e.body.date,seq:e.body.seq,type:1},"welcome")}function Q(e){var t={welcome:!1,offline:!1};return e.body.o_u_info||!e.body.u_info.welcome||e.body.nowelcome||(t.welcome=!0,Ai.normal.render("b2c",{avatar:ft.receptionist.avatar,name:e.body.u_info.name,data:e.body.u_info.welcome,date:e.body.date,seq:e.body.seq,type:1},"welcome")),t}function z(e){var t=e.body||{},i=t.u_info||{},n="undefined"==typeof i.type?"default":i.type;i.robotNav=i.robotNav&&i.robotNav.content&&i.robotNav.content.menu,"default"===n&&i.robotNav&&Ai.normal.render("b2c",{data:{type:101,robotNav:i.robotNav},date:t.date,type:5},"welcome",!0)}function Y(e){var t=e.body.c_info.name,i={},n=ft.isMobile?pt.header.find("span.title"):pt.header.find("span.name"),o="undefined"==typeof e.body.u_info.type?"default":e.body.u_info.type;switch(ft.registerType=o,a({type:"regSuccess",act:"update",seq:ft.inRegProcess}),ft.inRegProcess=0,!pt.chatBtnSend.hasClass("enabled")&&pt.chatBtnSend.addClass("enabled"),pt.chatBody.hasClass("regsuccess")||(document.title=ft.isMobile?t:$.i18n("common_chatting_with_text",t),pt.chatBody.hasClass("reconnect")||1==o||(pt.chatListWrap.empty(),pt.chatListWrap.append($(dt.CHAT_MSG_TPL.tencentCert))),pt.chatBody.removeClass("reconnect").addClass("regsuccess"),n.text(t),pt.chatListWrap.removeClass("chat-initial"),pt.chatBtnSend.addClass("enabled"),pt.btnUpload.addClass("enabled"),ft.wxConfig.enableVoice&&pt.btnVoice.addClass("enabled")),i=Q(e),Ai.getMsgCacheList.start(i.offline),z(e),o){case"default":ft.menuDetail.active=0,ft.isRealSendMsg=1,ft.routePermit.isNeedQQ="undefined"==typeof e.body.isNeedQQ?1:e.body.isNeedQQ,ft.routePermit.isCorpUin="undefined"==typeof e.body.isCorpUin?1:e.body.isCorpUin,1==ft.routePermit.isNeedQQ&&(u(),m(pt.callGroup.find(".btn-callqq"),{type:ft.routePermit.isCorpUin?"qqCorpUin":"qq"}));break;case 1:ft.menuDetail.active=1,ft.registerType=o,u("remove","qq"),ii().render.start(e.body.u_info);break;case 2:V(e);break;default:BJ_REPORT.report("UNKNOWN registerType: "+o)}}function X(e){var i=e.body.data,n=e.body.offline||0,a=ft.receptionist,o=ft.wpaDetail,s=ft.chatSocket,r=ft.imStatus;return 1==i&&ft.isMobile?void(i="tel"):(2==i?i="qq":5==i&&(i="qqCorpUin"),n&&pt.chatListWrap.find(".tencent-certification").before(St(dt.CHAT_MSG_TPL.sys,$.i18n(dt.SYS_MSG["call"+i]))),pt.chatListWrap.find(".tencent-certification").before(St(dt.CHAT_MSG_TPL["call"+i],a,f)),m(pt.chatListWrap.find(".btn-act"),{type:i}),t(),s.emitMsg(dt.SOCKET_CMD.ROUTE.EMIT,{csrf:e.body.csrf,seq:e.body.seq}),void("close"==r&&oi.set(a,o.wpaId,function(e){yt.send({act:"UNREAD",data:{number:e}})},!1)))}function Z(e){var t=e.data,i=(ft.receptionist,ft.chatSocket);if(i.emitMsg(dt.SOCKET_CMD.SESSION_MSG.EMIT,{csrf:e.csrf,seq:e.seq,type:e.type,time:e.time}),$.extend(ft.receptionist,{extUin:t.uin,name:t.name,avatar:t.face||ft.defaultAvatar,resign:t.position}),2!=ft.externalType||ft.isMobile||ft.isInIframe||x(),a({type:"b2cKfChange",msgType:"serverResp",act:"new",data:$.i18n(dt.SYS_MSG.b2cKfChange,ft.receptionist.name)}),"undefined"!=typeof t.welcome&&t.welcome){var o=+new Date+ft.serverClientTimeDiff;Ai.normal.render("b2c",{avatar:ft.receptionist.avatar,name:ft.receptionist.name,data:t.welcome,seq:n(dt.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),type:1,wordMsgSeq:n(dt.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC),date:o,sortseq:o},"welcome",!0,{act:"append",singleSeqs:o+"1"},!1,!1)}}function ee(e){var t=e.body,i=t.type||"unknown";switch(i){case 1000010:var n=t.data||{},a=n.type||"default";switch(a){case"default":Z(t);break;case 2:V(e,!0)}break;case 1000011:Ni().initialize(t);break;case 1000012:li.render(t,"b2c",{isNeedStore:!1,isNeedAck:!0,isNeedWrap:!1});break;case 1000013:$.extend(t.data,{name:ft.receptionist.name,face:ft.receptionist.avatar,extUin:ft.receptionist.extUin}),li.render(t,"b2c",{msgName:"addfriend",isNeedStore:!0,isNeedAck:!0,isNeedWrap:!0});break;case 1000014:ci.renderRet({ret:"success",kfAccount:t.data.kfAccount,originData:t});break;case 1000100:Gi.render(t);break;default:BJ_REPORT.report("Unknown S_msg Type"+i)}}function te(e){var t=e.body||{};a({type:"sessionEnd",msgType:"sessionEnd",data:t.prompt_message,act:"new"}),ft.kfChangeTip||(Kt.remove(),ft.ioLinkStatus="sessionOver",ft.wpaDetail.extUin=ft.receptionist.extUin,ft.isChangeKF=0)}function ie(){Bi.receiveMsg(dt.SOCKET_CMD.B2C.RECEIVE,Ai.normal.renderB2C),Bi.receiveMsg(dt.SOCKET_CMD.C2B.RECEIVE,Ai.normal.sendRet),Bi.receiveMsg(dt.SOCKET_CMD.SESSION_MSG.RECEIVE,ee),Bi.receiveMsg(dt.SOCKET_CMD.OVER.RECEIVE,te),Bi.receiveMsg(dt.SOCKET_CMD.ROUTE.RECEIVE,X)}function ne(e,t){var e=e.body,i=$(t.target),n=ft.getSigTData,a=ft.receptionist,o=parseInt(ft.originRoleValue);if(!i.hasClass("disabled")){switch(BJ_REPORT.info("KF Change"),i.addClass("disabled"),ft.chatSocket.emitMsg(dt.SOCKET_CMD.KF_CHANGE.EMIT,{kf:""}),4==n.invitationType&&(1==ft.wpaDetail.reception.type?o=0:2==ft.wpaDetail.reception.type&&(o=1)),o){case 0:ft.wpaDetail.extUin=n.roleData;break;case 1:ft.wpaDetail.extUin="group";break;case 2:ft.wpaDetail.extUin=a.kfUin;break;default:BJ_REPORT.report("Unknown RoleValue"+o)}BJ_REPORT.info("KF Change ReConnect"),Hi().reConnect()}}function ae(e){var t=Dt.getMsgCacheList(),i=ft.receptionist,n="kf"+i.kfUin+"vId"+i.visitorId+"index",a=e.body.u_info?e.body.u_info:e.body.data;if(t){for(var o=JSON.parse(Ct.get(ft.seqs.key)),s=0;s<t.length;s++)if("unconnect"==t[s].cacheType){var r=JSON.parse(Ct.get(n+t[s].singleSeqs));2==e.body.u_info.type&&(r.queueKey=a.queueKey),o.push(t[s].singleSeqs),re(i.kfUin,i.visitorId,"set"),oe(r)}Ct.set(ft.seqs.key,JSON.stringify(o)),ft.seqs.data=o}}function oe(e){setTimeout(function(){if(delete e.time,delete e.singleSeqs,delete e.dir,2==e.type){var t=e.imgSrc;e.imgSrc=e.data,e.data=t}ft.chatSocket.emitMsg(dt.SOCKET_CMD.C2B.EMIT,e)},2)}function se(){var e=Dt.getMsgCacheList();if(e){for(var t=0;t<e.length;t++)"unconnect"==e[t].cacheType&&(e[t].cacheType="ack");Dt.setMsgCacheList(e)}}function re(e,t,i){var n,a="kf"+e,o=JSON.parse(Ct.get(a));return o&&o.forEach(function(e){e.visitorId==t&&(n=e.total,"set"==i&&(n++,e.total=n))}),"get"==i?n:void Ct.set(a,JSON.stringify(o))}function ce(e){var t,i,n,a,o=+new Date;$.ajax({type:"HEAD",url:dt.CGI_URL.GET_SERVER_TIME+"?kfuin="+e,timeout:1e3,success:function(e,s,r){t=+new Date,i=+new Date(r.getResponseHeader("Date")),n=parseInt((t-o)/2),a=i+n-t,ft.serverClientTimeDiff=a,BJ_REPORT.report("Time Diff "+a)}})}function le(){var e=ft.win.location.href,t="0"==Ft(e,"linkType")?2:3,i=ft.wpaDetail,n=ft.receptionist,a=i.clickid,o={mid:"",id:i.wpaId,kfuin:n.kfUin,kfext:Ft(e,"kfext"),cate:Ft(e,"cate"),type:Ft(e,"type"),eventtp:t,tpForm:t,refurl:"undefined"!=typeof document.referrer?document.referrer:"",ua:ft.userAgent,eptype:ft.isMobile?2:1,pid:Ft(e,"_pid")||a,clickid:a,clickType:6,visitorid:n.visitorId,tptype:9};Ft(e,"sm")&&(o.sm=Ft(e,"sm")),$.ajax({url:dt.CGI_URL.ACT_RPT,data:o,type:"POST",timeout:3e3,dataType:"json"})}function de(e,t,i,o){var s,r=i||"chatStart",c=t||dt.CGI_URL.GET_SIGT,l=n(dt.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),d="wpaShowItemId",f=0;return"undefined"==typeof e.visitorId?(a({type:"noVisitorId",empty:!0}),void BJ_REPORT.report("noVisitorId")):("undefined"==typeof e.reqSrc&&(e.kfuin&&ce(e.kfuin),le()),$.extend(e,{ftype:ft.isMobile,rolekey:"roleQQ",
cb:r}),"undefined"!=typeof e[d]&&(Fi.get(d)?delete e[d]:Fi.set(d,"true")),ft.win.chatStart=function(t){var i=t.data.sigT,n={sigT:i,roleValue:e.roleValue,roleData:e.roleData,callImType:e.callImType,wpaShowItemId:e.wpaShowItemId,qidian_track_id:e.qidian_track_id,qidian_src_desc:e.qidian_src_desc,qidian_ex1:e.qidian_ex1,qidian_ex2:e.qidian_ex2,qidian_ex3:e.qidian_ex3,qidian_ex4:e.qidian_ex4,qidian_ex5:e.qidian_ex5,guestId:e.guestId,qidian_lang:e.qidian_lang};"undefined"!=typeof e.NavClick&&$.extend(n,{NavClick:e.NavClick}),ft.isGetSignT=1,clearInterval(s),0==t.r?Hi().prepareRegData(n):a({type:"sigTfail",empty:!0})},s=Ui({isGet:ft.isGetSignT,timeout:dt.SOCKET_OPTS.SIGT_TIMEOUT,text:"Get SigT Timeout ",callback:function(e){a({type:"sigTtimeOut",empty:!0}),BJ_REPORT.report(this.text)}}),$.ajax({type:"get",url:c,data:e,dataType:"jsonp",timeout:dt.SOCKET_OPTS.SIGT_TIMEOUT,beforeSend:function(){f=+new Date},complete:function(){ti({type:3,requestConsumTime:+new Date-f,clickid:e.clickid})},error:function(e){}}),void((pt.chatBody.hasClass("regsuccess")||pt.chatBody.hasClass("reconnect"))&&o&&(a({type:"startGetSigT",seq:l,act:"new"}),ft.inRegProcess=l)))}function fe(){var e=pt.sidebar,t=e.find(".desc");if(t.height()>ji){var i=t.find(".desc__content"),n=t.find(".desc__arrow");t.addClass("collapse"),n.on("click",function(){t.hasClass("collapse")?t.removeClass("collapse").addClass("expand"):(t.removeClass("expand").addClass("collapse"),i.scrollTop(0))})}}function ue(e,t){pt.sidebar.html($.tmpl(e,t)),setTimeout(function(){fe()},0)}function pe(){var e=0;return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e+=t}}function ge(e){var t=e.act,i={},n={},a=ft.wpaDetail,o=ft.chatSocket,s=Wi();switch(t){case"INIT":var r={kfUin:e.kfuin,visitorId:e.visitorid,wpaId:e.wpaId};e.kfuin||(e.kfuin=0),$.extend(ft.htReportOpts,{uin:e.kfuin+"-"+e.visitorid}),BJ_REPORT&&BJ_REPORT.init({uin:ft.htReportOpts.uin}),Ki(ft.htReportOpts),ft.imStatus="close",i=oi.get(r);var c=function(){"undefined"!=typeof i.number&&i.number>0&&($.extend(n,e,{type:"unReadMsg"}),gt.statusBar.data("virtualWPAData",n),Qi(i.number),oi.render("update",i.number,{name:i.name,status:$.i18n("common_leave_message_text")}),yt.send({act:"SHOW"}),$.extend(!0,e,{act:"UNREAD",data:{number:i.number,onlyOpen:!1}}),yt.send(e))};ft.lang=e.qidian_lang||"zh-cn",Vi.isInit?c():Vi.init(c),$.extend(ft.receptionist,{visitorId:e.visitorid,kfUin:e.kfuin});break;case"OPEN":var l={};if($.extend(ft.receptionist,{visitorId:e.visitorid,kfUin:e.kfuin}),BJ_REPORT&&BJ_REPORT.init({uin:e.visitorid}),!ft.isGetSkin&&s.getData({kfuin:e.kfuin,wpaId:e.wpaId,key:e.wpaKey}),gt.page.removeClass("page-minify").addClass("page-inframe"),oi.reset(ft.receptionist),oi.render("reset"),ft.imStatus="open",e.onlyOpen)return;1==e.invitationType||2==e.invitationType?$.extend(e,{roleData:e.receptionUin,roleValue:0}):4==e.invitationType?$.extend(e,{roleData:e.reception.cuin,roleValue:e.reception.type-1}):3==e.invitationType&&$.extend(e,{roleData:e.receptionUin,roleValue:0,extUin:e.receptionUin}),l={kfuin:e.kfuin,visitorId:e.visitorid,roleValue:e.roleValue,roleData:e.roleData,invitationType:e.invitationType,wpaShowItemId:e.wpaShowItemId,qidian_track_id:e.qidian_track_id,qidian_src_desc:e.qidian_src_desc,qidian_ex1:e.qidian_ex1,qidian_ex2:e.qidian_ex2,qidian_ex3:e.qidian_ex3,qidian_ex4:e.qidian_ex4,qidian_ex5:e.qidian_ex5,guestId:e.guestId},ft.originRoleValue=e.roleValue,e.isClickWpa&&$.extend(l,{cate:e.cate,type:e.type,clickid:e.clickid,fid:e.wpaId,pid:e.pid,qid:e.qid,clickType:e.clickType,tptype:e.tptype,eptype:e.eptype,tpForm:e.tpForm});var d=function(){a.wpaKey||a.wpaId||gt.chatBody.hasClass("regsuccess")?a.wpaKey!=e.wpaKey&&a.wpaId!=e.wpaId&&(ft.wpaDetail=e,ft.getSigTData=l,de(l)):(ft.wpaDetail=e,ft.getSigTData=l,de(l))};ft.lang=e.qidian_lang||"zh-cn",Vi.isInit?d():Vi.init(d);break;case"UPDATE_UNREAD":var f=parseInt(e.number),u="undefined"!=typeof e.theme?e.theme:null;null!==u&&s.skinColor(u),f>0&&(n=a={type:"offlineMsg",roleData:e.receptionUin,roleValue:e.roleValue,extUin:e.receptionUin,kfuin:e.kfuin,visitorid:ft.receptionist.visitorId,invitationType:3},gt.statusBar.data("virtualWPAData",n),oi.render("update",Qi()+parseInt(e.number),{name:e.receptionName,status:$.i18n("common_chatting_text")}),yt.send({act:"SHOW"}));break;case"DISCONNECT":"undefined"!=typeof o.ioLink&&o.ioLink.disconnect();break;case"SM_MANUAL_INVITE":5==e.data.type&&($.extend(ft.getSigTData,{roleData:e.receptionUin||e.data.receptionUin,roleValue:0}),ft.wpaDetail.extUin=e.receptionUin||e.data.receptionUin,ft.wpaDetail.invitationType=e.data.type,ft.registerType=0,Hi().reConnect());break;case"SM_READY":break;case"SM_INIT":break;case"SM_UNREAD":break;default:BJ_REPORT.report("Unknown Message["+JSON.stringify(e)+"]")}}function me(e){$("body").delegate('a[href^="javascript:"]',"click",function(e){e.preventDefault()}),$(window).bind("beforeunload",function(){return e.apply(this,arguments)})}function _e(){me(function(){return"您正在与客服会话，是否离开"})}function he(e){var t=0;if(document.selection){e.focus();var i=document.selection.createRange();i.moveStart("character",-e.value.length-1),t=i.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t}function ve(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var i=e.createTextRange();i.collapse(!0),i.moveEnd("character",t),i.moveStart("character",t),i.select()}}function qe(){gt.faceList.on("show",function(){gt.faceList.addClass("slideup"),Yi.render()}),gt.faceList.on("hide",function(){gt.faceList.removeClass("slideup")}),$("body").on("click",function(e){var t=$(e.target);0==t.parents(".chat-face").length&&0==t.parents(".btn-face").length&&gt.faceList.trigger("hide")})}function ye(){var e=(window.emoji=!1,~ft.userAgent.indexOf("mac os"));qe(),!ft.isInIframe&&_e(),e&&gt.chatPostArea.prop("placeholder",$.i18n("common_postarea_pc_placeholder")),gt.chatPostArea.on("init",function(){gt.chatPostArea.val(""),gt.chatPostArea.trigger("input")}),gt.btnFace.on("click",function(){gt.faceList.trigger(gt.faceList.hasClass("slideup")?"hide":"show")}),"undefined"!=typeof ft.win.EmojiConvertor&&(ft.win.emoji=new EmojiConvertor,ft.win.emoji.img_sets.apple.path=Ji.CGI_URL.COMP_SOURCE_URL+"img/emoji/")}function be(e,t,i,n,a){k(function(o){o.append('<div class="confirm"><p class="text">'+e+'</p><p class="btn-wrap"><a href="javascript:;">'+$.i18n("common_confirm_text")+'</a><a href="javascript:;">'+$.i18n("common_cancel_text")+"</a></p></div>"),o.find(".btn-wrap a").eq(0).on("tap",function(){o.remove(),t&&t.call(i)}),o.find(".btn-wrap a").eq(1).on("tap",function(){o.remove(),n&&n.call(a)})})}function Se(){var e=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(e)?"Windows Phone":/android/i.test(e)?"Android":/iPad|iPhone|iPod/.test(e)&&!window.MSStream?"iOS":"unknown"}function Te(){if("iOS"===Xi)return!0;var e=window.navigator.connection||window.navigator.webkitConnection||null,t=window.navigator.userAgent.toLocaleLowerCase();return e&&e.type&&"wifi"==e.type||-1!==t.indexOf("wifi")?!0:!1}function we(e){this.options={},$.extend(this.options,e),this.initialize()}function Ce(){var e=WebUploader.create({auto:!0,swf:Ji.CGI_URL.COMP_SOURCE_URL+"swf/Uploader.swf",server:Ji.CGI_URL.UPLOAD_IMG+"?kfuin="+ft.receptionist.kfUin,formData:{visitId:ft.receptionist.visitorId,receptionUin:ft.receptionist.extUin},fileVal:"media",pick:"#btn-swfupload",fileNumLimit:Ji.IMG_UPLOAD_OPTS.MAX_SUM,fileSingleSizeLimit:Ji.IMG_UPLOAD_OPTS.MAX_SIZE,accept:{title:"图片文件",extensions:Ji.IMG_UPLOAD_OPTS.ACCEPT_TYPE_SWFUPLOAD,mimeTypes:"image/*"},thumb:{width:200,height:200,quality:90,allowMagnify:!1,crop:!1,type:""},compress:!1});$(".upload-placeholder").hover(function(){gt.btnUpload.addClass("hover")},function(){gt.btnUpload.removeClass("hover")}),e.on("fileQueued",function(t){var i={seq:n(Ji.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),date:+new Date};Ai.normal.render("c2bImage",{seq:i.seq,date:i.date},"msg"),$.extend(t,i),e.makeThumb(t,function(e,t){i.DataURL=t,$.extend(i,{DataURL:t}),Ai.image.replacePlaceholder(i)},200,200)}),e.on("uploadSuccess",function(e,t){var i={seq:e.seq,date:e.data};Ai.renderUploadImgRet(i,t)}),e.on("uploadError",function(e,t){Ai.image.sendFail(e,"notSupport")}),e.on("error",function(e){"Q_EXCEED_NUM_LIMIT"==e&&Ai.image.sendFail(file,"overSumLimit")})}function ke(){var e,t,n,a=0,o=~ft.userAgent.indexOf("mac os"),s=o?16:17,r=11.4,c={};gt.chatBtnSend.on("click",function(e){xe(c),c={}}),gt.chatPostArea.on("keydown",function(e){e.which==s&&(a=1),13!=e.which||1!=a||o?13==e.which&&0==a&&(e.preventDefault(),xe(c),c={}):gt.chatPostArea.val(gt.chatPostArea.val()+"\r\n").scrollTop(gt.chatPostArea.prop("scrollHeight")-gt.chatPostArea.outerHeight())}).on("keyup",function(e){e.which==s&&(a=0)}),gt.chatPostArea.msgAutoComplete({$container:$(".msg-autocomplete"),$inputArea:gt.chatPostArea,tpl:Ji.MSG_AUTO_COMPLETE_TPL,cgi:Ji.CGI_URL.GET_RELATED_MESSAGE,events:{mouseover:function(e,t){c=null!==t?$.extend(c,{data:t.msg,robot:{queryid:t.queryid,reply_docid:t.reply_docid,order:t.order}}):{}},click:function(e,t){xe({data:t.msg,robot:{queryid:t.queryid,reply_docid:t.reply_docid,order:t.order}}),c={}},enter:function(){c={}}}}),window.FormData?e=new we({$trigger:gt.btnUpload,$inputTrigger:gt.uploadInput,isNeedWifiTip:!1,platform:"pc",initializeCallBack:function(){gt.chatPostArea.trigger("slideDown")},events:{preview:function(e,t){Ai.image.render(e,t)},replacePlaceholder:function(e){Ai.image.replacePlaceholder(e)}}}):(t=sn(),1!=t.hasFlash?n=Ji.FLASH_TIP.NO_FLASH:t.flashVersion<=r&&(n=Ji.FLASH_TIP.LOW_VERSION),n?gt.btnUpload.on("click",function(){p({text:n},1e3)}):window.WebUploader&&Ce()),i(gt.chatPostArea[0],"paste",function(t){var i,n,a;try{i=t.clipboardData||t.originalEvent.clipboardData,n=i.items,a=n.length;for(var o=0;a>o;o++)"file"==n[o].kind&&n[o].type.match("^image/")&&e.checkImgTypeLocal([n[o].getAsFile()])}catch(t){}})}function xe(e){var t,i=$.trim(gt.chatPostArea.val());gt.chatBtnSend.hasClass("enabled")&&on(i)&&ft.receptionist.kfUin&&ft.receptionist.visitorId&&(t={data:i,seq:n(Ji.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),type:1,wordMsgSeq:n(Ji.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC),date:+new Date+ft.serverClientTimeDiff},!$.isEmptyObject(e)&&$.extend(t,e),Ai.normal.render("c2b",t),gt.chatPostArea.trigger("init"))}function Ee(){var e={};gt.page.removeClass("page-popup").addClass("page-minify"),$(".btn-back").on("click",function(e){yt.send({act:"CLOSE",kfuin:ft.receptionist.kfUin}),ft.imStatus="close",gt.page.removeClass("page-inframe").addClass("page-minify"),gt.statusBar.find(".name").text(ft.receptionist.name).end().find(".status").text($.i18n("common_chatting_text"))}),$(document).delegate("div.title-minify","click",function(){e=$(this).data("virtualWPAData"),gt.page.hasClass("page-minify")&&(yt.send({act:"OPEN",isPost2Parent:!1}),e&&($.extend(e,{act:"OPEN",isPost2Parent:!0}),window.postMessage(e,"*")),gt.page.removeClass("page-minify").addClass("page-inframe"))})}function Re(e){I(dt.CGI_URL.STATUS_MANAGER,function(){"undefined"!=typeof e&&yt.receive(ft.win,e)})}function Ie(e){function t(){var e=c.active,t=c.url,i=e?Ft(t,"visitorId"):s(a);return!e&&r&&(i?Ct.set(a,i):i=Ct.get(a)),i}function i(){var e=(Math.floor(10*Math.random())||1)+$e(3,10)+(new Date).getTime().toString().slice(2,13);return r?Ct.set(a,e):o(a,e,null,"/",31536e6),e}var n,a="tencentSig",r="undefined"==typeof Ct.type||"memory"===Ct.type?!0:!1,c={active:!1,url:""};return $.extend(c,e),n=t(),n||(n=i()),n}function Oe(e){var t="tencentSig",i="undefined"==typeof Ct.type||"memory"===Ct.type?!0:!1;i?Ct.set(t,e):o(t,e,null,"/",31536e6)}function $e(e,t){var i,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[];if(t=t||n.length,e)for(i=0;e>i;i++)a[i]=n[0|Math.random()*t];else{var o;for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",i=0;36>i;i++)a[i]||(o=0|16*Math.random(),a[i]=n[19==i?3&o|8:o])}return a.join("")}function Pe(e){var t=$.Deferred();if(!e.kfuin||!e.code||!e.appid)return t.reject({code:-1,msg:"参数错误"});var i,n="WXMP_OPENID_"+e.appid;return(i=Ct.get(n))?t.resolve({code:0,msg:"",data:{openid:i}}):($.ajax({url:dt.CGI_URL.GET_WX_MP_OPENID+"?kfuin="+e.kfuin,type:"GET",dataType:"json",data:e,success:function(e){e=e||{},0==e.code?(e&&e.data&&e.data.openid&&Ct.set(n,e.data.openid),t.resolve(e)):t.reject(e)},error:function(e,i){var n={code:e.status,msg:i};t.reject(n)}}),t)}function Me(e){var t=$.Deferred();if(!e.kfuin||!e.openid||!e.appid)return t.reject({code:-1,msg:"参数错误"});var i,n="WXMP_VISITORID_"+e.appid+"_"+e.openid;return(i=Ct.get(n))?t.resolve({code:0,msg:"",data:{visitorId:i}}):(i=Ie(),$.ajax({url:dt.CGI_URL.CHECK_WX_MP_VISITORID+"?kfuin="+e.kfuin,type:"GET",data:{visitorId:i,appid:e.appid,openid:e.openid},success:function(e){e=e||{},0==e.code?(e&&e.data&&e.data.visitorId&&Ct.set(n,e.data.visitorId),t.resolve(e)):t.reject(e)},error:function(e,i){var n={code:e.status,msg:i};t.reject(n)}}),t.promise())}function Le(e){var t,i,n=$.Deferred(),a=Ft(e.url,"kfuin")||0,o=Ft(e.url,"code"),s=Ft(e.url,"appid");return Pe({kfuin:a,code:o,appid:s}).then(function(e){0==e.code&&(t=e.data.openid,ft.wxConfig.appid=s,ft.wxConfig.openid=t,ft.thirdAppConfig.enable=!0,ft.thirdAppConfig.type="wx_mp",ft.thirdAppConfig.appId=s,ft.thirdAppConfig.openId=t,Me({kfuin:a,appid:s,openid:t}).then(function(e){i=e.data.visitorId,Oe(i),n.resolve()},function(e){n.reject(e)}))},function(e){n.reject(e)}),n.promise()}function De(e){var t=$.Deferred();return L(e).then(function(){t.resolve()},function(e){t.reject(e)}),t.promise()}function Ae(e){switch(Sn&&Sn.length&&Sn.remove(),e){case"recording":Sn=$($.tmpl(dt.CHAT_MSG_TPL.voiceTip,{icon:e,tip:"手指上滑，取消发送"}))}return pt.chatList.append(Sn),Sn}function Ne(e,t){var i=void 0,n=void 0;switch(e){case"countdown":"undefined"!=typeof t.text&&(i=Sn.find(".voice-icon"),i.length&&i.removeClass().addClass("voice-icon").text(t.text));break;case"recording":case"cancel":i=Sn.find(".voice-icon"),i.length&&(i.text(""),i.removeClass().addClass("voice-icon").addClass(e))}"undefined"!=typeof t.tip&&(n=Sn.find(".voice-tip"),"cancel"===e?n.addClass("voice-tip--cancel"):n.removeClass("voice-tip--cancel"),n.find("span").text(t.tip))}function Ge(){Sn&&Sn.length&&Sn.remove()}function Be(e){switch(Tn&&Tn.length&&Tn.remove(),e){case"recording":Tn=$($.tmpl(dt.CHAT_MSG_TPL.c2bVoiceRecording,{}))}return pt.chatListWrap.find(".tencent-certification").before(Tn),pt.chatListWrap[0].scrollTop=pt.chatListWrap[0].scrollHeight-pt.chatListWrap.height(),Tn}function Ue(e){switch(e){case"uploading":Tn.find("i").addClass("loading loading-s")}}function He(){Tn&&Tn.length&&Tn.remove()}function Fe(){vn="init",un=0,pn=0,gn={},mn=0,_n=0,bn=!1,clearTimeout(hn),clearTimeout(qn),clearInterval(yn),Ge(),He(),pt.btnRecord.text($.i18n("common_voicebtn_hold_text"))}function Je(e){var t=+new Date+ft.serverClientTimeDiff,i={seq:e.seq,date:t,type:7,data:{date:t,channel:1,appId:ft.wxConfig.appid,mediaId:e.serverId,duration:e.duration,recordTime:+new Date,fileType:"amr",isTranslate:e.isTranslate,content:e.translateResult}};Ai.normal.render("c2b",i,"msg",!0,null,!0,!0,!1)}function je(e){var t=$.Deferred();return wx&&wx.uploadVoice({localId:e,isShowProgressTips:0,success:function(e){t.resolve(e.serverId)},fail:function(e){t.reject(e)}}),t.promise()}function We(e){var t=$.Deferred();return wx&&wx.translateVoice({localId:e,isShowProgressTips:0,success:function(e){t.resolve(e.translateResult)},fail:function(){t.resolve("")}}),t.promise()}function Ke(){Ge(),Ue(vn);var e=n(dt.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),t=parseInt((_n-mn)/1e3),i=Tn;Tn&&Tn.length&&(Tn.attr("data-guid",e),Tn.attr("data-duration",t),Tn=null);var a=ft.receptionist.isRobot;a?$.when(je(wn.localId),We(wn.localId)).then(function(n,a){return a?void Je({seq:e,serverId:n,duration:t,isTranslate:1,translateResult:a}):(i.remove(),void p({text:"没有检测到语音内容，请重试"},1500))},function(e){i.remove(),p({text:e.errMsg},1500)}):$.when(je(wn.localId)).then(function(i){Je({seq:e,serverId:i,duration:t,isTranslate:0,translateResult:""})},function(e){i.remove(),p({text:e.errMsg},1500)}),Fe()}function Ve(){var e=$.Deferred(),t="WXMP_JSSDK_ENABLE_RECORD_VOICE_"+ft.wxConfig.appid,i=Ct.get(t);return!i||+i<+new Date-fn?wx&&wx.startRecord({success:function(){setTimeout(function(){wx&&wx.stopRecord({success:function(){Ct.set(t,Date.now()),e.resolve()},fail:function(t){p({text:t.errMsg},1500),e.reject()}})},1500)},fail:function(){e.reject()},cancel:function(){e.reject()}}):e.resolve(),e.promise()}function Qe(){pt.btnVoice.on("tap",function(e){e.preventDefault(),Ve().then(function(){pt.chatPost.removeClass("off-voice").addClass("on-voice"),pt.chatPost.find("textarea").trigger("slideDown")})}),pt.btnVoice.on("contextmenu",function(e){e.preventDefault()}),pt.btnKeyboard.on("tap",function(e){e.preventDefault(),pt.chatPost.removeClass("on-voice").addClass("off-voice"),pt.chatPost.find("textarea").trigger("slideDown")}),pt.btnKeyboard.on("contextmenu",function(e){e.preventDefault()})}function ze(){wx&&wx.onVoiceRecordEnd({complete:function(e){vn="uploading",_n=+new Date,wn.localId=e.localId,Ke(),pt.btnRecord.text($.i18n("common_voicebtn_hold_text"))}}),pt.btnRecord.on("touchstart",function(e){e.preventDefault();var t=e.touches[0];gn.x1=t.pageX,gn.y1=t.pageY,pt.btnRecord.text($.i18n("common_voicebtn_release_text")),un=+new Date,"init"===vn&&(vn="starting",hn=setTimeout(function(){vn="invoking",wx&&wx.startRecord({success:function(){mn=+new Date,vn="recording",Ae(vn),Be(vn);var e=10;qn=setTimeout(function(){if(bn=!0,Sn&&Sn.length){if(Math.abs(gn.y1-gn.y2)>ln)return;Ne("countdown",{text:e,tip:"即将发送语音"})}yn=setInterval(function(){if(e--,0>e)return void clearInterval(yn);if(Sn&&Sn.length){if(Math.abs(gn.y1-gn.y2)>ln)return;Ne("countdown",{text:e})}},1e3)},dn)},fail:function(e){Fe(),p({text:e.errMsg},1500)},cancel:function(e){Fe(),p({text:e.errMsg},1500)}})},rn))}),pt.btnRecord.on("touchend",function(e){if(e.preventDefault(),pt.btnRecord.text($.i18n("common_voicebtn_hold_text")),pn=+new Date,"starting"===vn||"invoking"===vn||"recording"===vn){if("starting"===vn&&Fe(),"invoking"===vn)var t=setInterval(function(){"recording"==vn?wx&&wx.stopRecord({success:function(){clearInterval(t),Fe()},fail:function(e){Fe(),p({text:e.errMsg},1500)}}):Fe()},500);if("recording"===vn){if(Math.abs(gn.y1-gn.y2)>ln)return void(wx&&wx.stopRecord({success:function(){Fe()},fail:function(){Fe()}}));cn>pn-mn?wx&&wx.stopRecord({success:function(){p({text:"说话时间太短"},1500),Fe()},fail:function(){p({text:"说话时间太短"},1500),Fe()}}):wx&&wx.stopRecord({success:function(e){vn="uploading",_n=+new Date,wn.localId=e.localId,Ke()},fail:function(e){p({text:e.errMsg},1500),Fe()}})}}}),pt.btnRecord.on("touchmove",function(e){e.preventDefault();var t=e.touches[0];if(gn.x2=t.pageX,gn.y2=t.pageY,"recording"===vn){var i=Math.abs(gn.y1-gn.y2);i>ln?(pt.btnRecord.text($.i18n("common_voicebtn_cancel_text")),Sn&&Sn.length&&Ne("cancel",{tip:"松开手指，取消发送"})):(pt.btnRecord.text($.i18n("common_voicebtn_release_text")),Sn&&Sn.length&&(bn?Ne("countdown",{tip:"即将发送语音"}):Ne("recording",{tip:"手指上滑，取消发送"})))}}),pt.btnRecord.on("touchcancel",function(){"recording"===vn&&wx&&wx.stopRecord({success:function(){Fe()},fail:function(){Fe()}}),Fe()}),pt.btnRecord.on("contextmenu",function(e){e.preventDefault()}),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&"recording"===vn&&wx&&wx.stopRecord({success:function(){Fe()},fail:function(){Fe()}})})}function Ye(){pt.chatPost.addClass("enable-voice off-voice"),pt.btnRecord=$(".voice-area .btn-record"),pt.btnRecord.text($.i18n("common_voicebtn_hold_text")),Qe(),ze()}function Xe(e){var t=ft.win.location.href,i=en(ft.userAgent),n=Ft(t,"auth"),a=Ft(t,"code");return"wechat"!==i||"wx_mp"!==n?Ze(e):("wx_mp"===n&&(ft.wxConfig.enableVoice=!0,De({url:t,callback:function(){ft.wxConfig.enableVoice&&Ye()}}).then(function(){},function(e){p({text:e&&e.msg||"未知错误，请重试"},1e3)})),void("wx_mp"===n&&a?Le({url:t}).then(function(){Ze(e)},function(e){p({text:e&&e.msg||"未知错误，请重试"},1e3)}):Ze(e)))}function Ze(e){var t,i=["kfuin","roleValue","roleData","fid","clickid","waitTime","callImType","wpaShowItemId","qidian_track_id","qidian_src_desc","qidian_ex1","qidian_ex2","qidian_ex3","qidian_ex4","qidian_ex5","guestId","qidian_lang"],n=ft.win.location.href,a=!!Ft(n,"visitorId"),o=Ie({active:a,url:ft.win.location.href}),s={visitorId:o,cate:7,type:10,pid:Cn,qid:Cn,clickType:6,tptype:9,eptype:ft.isMobile?2:1,tpForm:2},r={},c={};i.forEach(function(e){s[e]=Ft(n,e)}),s.kfuin||(s.kfuin=0),t=s.kfuin+"-"+o,$.extend(ft.htReportOpts,{uin:t}),BJ_REPORT&&BJ_REPORT.init({uin:ft.htReportOpts.uin}),Ki(ft.htReportOpts),"undefined"!=typeof s.clickid&&s.clickid?ft.wpaDetail.clickid=s.clickid:ft.wpaDetail.clickid=s.clickid=Cn,r.visitorId=o,r.kfUin=s.kfuin,c.wpaId=Ft(n,"fid"),c.wpaKey=Ft(n,"key"),$.extend(ft.receptionist,r),$.extend(ft.wpaDetail,c),ft.getSigTData=s,ft.originRoleValue=s.roleValue,e&&e(),de(s)}function et(){this.version="2.0.0",this.start=function(){if(gt.chatListWrap.append($(dt.CHAT_MSG_TPL.tencentCert)),$.extend(ft.htReportOpts,{platform:"pc",app:"other",flag3:1}),ye(),ke(),ft.isInIframe)yt.receive(ft.win,ge),Ee();else{var e=function(){Re(ge),Xe(function(){!ft.isGetSkin&&Wi().getData({kfuin:ft.receptionist.kfUin,wpaId:ft.wpaDetail.wpaId,key:ft.wpaDetail.wpaKey})})};Vi.init(e)}!gt.chatBtnSend.hasClass("enabled")&&gt.chatBtnSend.addClass("enabled")}}var tt=function(){return window.parent==window?!1:!0}(),it=window,nt=it.document,at="QD.",ot=function(e){return e.toString(36)},st=function Rn(e){var Rn=1;if(e){var t=0;Rn=0;for(var i=e.length-1;i>=0;i--)t=e.charCodeAt(i),Rn=(Rn<<6&268435455)+t+(t<<14),t=266338304&Rn,Rn=0!=t?Rn^t>>21:Rn}return Rn},rt=function In(){var In;try{var e=new Uint32Array(1);it.crypto.getRandomValues(e),In=2147483647&e[0]}catch(t){In=Math.floor(2147483648*Math.random())}return In},ct=function(e){var t=it.navigator.userAgent+(nt.cookie?nt.cookie:"")+(nt.referrer?nt.referrer:"")+it.location.href,i=ot(rt()^2147483647&st(t))+"."+ot(rt())+"."+ot(+new Date);return e?at+i:i},lt=9,dt={MAX_POST_LIMIT:{LENGTH:4500,TIP_TEXT:"chat_max_post_limit_text"},VIEW_OPTS:{POST_MAX_ROW:3,TIME_INTERVAL:12e4,HISTORY_MSG:{PER_NUM:10,GET_MSG:"chat_history_msg_get_text",LOADING:"chat_history_msg_loading_text"},OFFLINE_MSG:{LOADING:"chat_offline_msg_loading_text",FAIL:"chat_offline_msg_fail_text",OVER:"chat_offline_msg_over_text"},MENU_MSG:{LOADING:"chat_menu_msg_loading_text",FAIL:"chat_menu_msg_fail_text"}},CGI_URL:{SOCKET_CHAT:"https://"+__domain.chat+".qidian.qq.com",STATUS_MANAGER:"https://bqq.gtimg.com/qidian/chatClient/release/status/js/report-1ed270614.js",QQ_FACE:"https://"+__domain.source+".com/qidian/chatClient/release/comp/img/qq/",GET_SIGT:"https://"+__domain.admin+".qidian.qq.com/webim/webImLogin/getSigT",GET_TENCENT_SCHEME:"https://"+__domain.admin+".qidian.qq.com/tp/wpaCall/getWebProtocol",UPLOAD_IMG:"https://"+__domain.admin+".qidian.qq.com/webim/pic/upload",ROUTE_CHANGE_LOADING:{QQ:"https://"+__domain.admin+".qidian.qq.com/template/blue/wpa/link.html"},GET_GRAPHIC_MSG:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/getGraphicMsg",GET_OFFLINE_MSG:"https://"+__domain.admin+".qidian.qq.com/webim/offlineMessage/getMessages",COMP_SOURCE_URL:"https://"+__domain.source+".com/qidian/chatClient/release/comp/",GET_MENU_URL:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/getNav",GET_FEEDBACK_RET:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/feedBack",ACT_RPT:"https://"+__domain.admin+".qidian.qq.com/ar/ActCap/ActRpt",GET_SERVER_TIME:"https://"+__domain.admin+".qidian.qq.com/webim/commonRequest/checkTime",GET_ADD_FRIEND_SCHEME:"https://"+__domain.admin+".qidian.qq.com/tp/wpaCall/GetAddFriendProtocol",COMMON_REQ_RPT:"https://"+__domain.admin+".qidian.qq.com/webim/commonRequest/actRpt",GET_RELATED_MESSAGE:"https://"+__domain.admin+".qidian.qq.com/webim/complete/question",ROBOT_SATISFACTION_REPORT:"https://"+__domain.admin+".qidian.qq.com/cl/robotSatisfaction/robotReport",GET_WX_MP_OPENID:"https://"+__domain.admin+".qidian.qq.com/webim/wx/getMpOpenId",CHECK_WX_MP_VISITORID:"https://"+__domain.admin+".qidian.qq.com/webim/wx/checkVisitorId",GET_WX_MP_JSSDK_SIGNATURE:"https://"+__domain.admin+".qidian.qq.com/webim/wx/getSignature",GET_WX_MP_JSSDK_SOURCE:"https://res.wx.qq.com/open/js/jweixin-1.4.0.js",GET_SKIN_CORP_INFO:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/getPCIMInfo",GET_RECEPTION_DETAIL:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/getEmployeeInfo"},SOCKET_OPTS:{OPTS:{path:"/session",reconnectionDelay:1e4,reconnectionDelayMax:2e4,reconnectionAttempts:2,timeout:2e4},C2B_TIMEOUT:6e4,SIGT_TIMEOUT:6e4,REG_TIMEOUT:6e4,SEQ_RANGE:{C2B_FOR_PHP:2147483647,C2B_FOR_PC:65535},CLIENT_PING_DELAY:2e4},IMG_UPLOAD_OPTS:{MAX_SUM:lt,MAX_SIZE:2097152,MAX_WIDTH:540,MAX_HEIGHT:960,JPG_COMPRESS_RATIO:60,ACCEPT_TYPE:["image/jpeg","image/jpg","image/bmp","image/png","image/gif"],ACCEPT_TYPE_SWFUPLOAD:"gif,jpg,jpeg,bmp,png"},MSG_DB_OPTS:{NAME:"Qidian WebIM History Message Database",CURRENT_VERSION:3},FB_OPTS:{levelDesc:["$$$chat_feedback_very_dissatisfied_text$$$","$$$chat_feedback_dissatisfied_text$$$","$$$chat_feedback_neutral_text$$$","$$$chat_feedback_satisfied_text$$$","$$$chat_feedback_very_satisfied_text$$$"],availLetterSum:60,delayTime:500},HEADER_TPL:{BTN_BACK:'<a href="javascript:;" class="btn-back"><svg><use xlink:href="#back"/></svg></a>',H5:{BTN_CALL_QQ:'<a href="javascript:;" class="btn-callqq" reqpos="0"><svg><use xlink:href="#qq"/></svg></a>'},PC:{BTN_CALL_QQ:'<a href="javascript:;" class="btn-callqq" reqpos="0"><i class="icon-qq"></i>$$$common_qq_chat_text$$$<i class="icon-arrow-right"></i></a>'}},SYS_MSG:{sessionEnd:"sysmsg_session_end_msg",disconnect:"sysmsg_disconnect_msg",changeKf:"sysmsg_change_kf_msg",reReg:"sysmsg_rereg_msg",connect:"sysmsg_connect_msg",connecting:"sysmsg_connecting_msg",connectError:"sysmsg_connect_error_msg",reconnectError:"sysmsg_reconnect_error_msg",reconnectIng:"sysmsg_reconnecting_msg",reconnectFail:"sysmsg_reconnect_fail_msg",callqq:"sysmsg_callqq_msg",callqqCorpUin:"sysmsg_callqq_corpuin_msg",sigTtimeOut:"sysmsg_get_sigt_timeout_msg",regTimeout:"sysmsg_reg_timeout_msg",regSuccess:"sysmsg_reg_success_msg",startGetSigT:"sysmsg_get_sigt_msg",sigTfail:"sysmsg_get_sigt_fail_msg",overSumLimit:"sysmsg_upload_image_max",msgExpired:"sysmsg_message_expired_msg",feedBack:"sysmsg_feeback_msg",autoChangeKF:"sysmsg_auto_change_kf_msg",b2cKfChange:"sysmsg_change_b2c_kf_msg",noVisitorId:"sysmsg_no_visitorid_error_msg",addFriendFail:"sysmsg_add_friend_fail_msg",graphicMsgFail:"sysmsg_graphic_msg_fail_msg",revoke:"sysmsg_msg_revoke_msg"},CHAT_MSG_TPL:{tencentCert:'<a href="https://qidian.qq.com/agreement/verified.html?from=webim" target="_blank" class="tencent-certification $$$common_tencent_certification$$$"></a>',time:'<div class="msg-time"><%==timeStamp%></div>',sys:'<div class="msg-sys" data-guid="<%=seq%>">\n                    <span class="text"><%==msg%></span>\n                </div>',b2c:'<div class="msg-b2c" data-guid="<%=seq%>"><p class="avatar"><img src="<%=avatar%>"/></p><div class="content"><p class="name"><%=name%></p><div class="bubble"><p class="text"><%==data%></p></div></div></div>',b2cImage:'<div class="msg-b2c msg-image" data-guid="<%=seq%>"><p class="avatar"><img src="<%=avatar%>"/></p><div class="content"><p class="name"><%=name%></p><div class="bubble"><p class="image"><img src="<%=data%>"/><i class="loading loading-s"></i></p></div></div></div>',b2cWrap:'<div class="msg-b2c <%=o.msgType%> <%=o.msgName%>" data-guid="<%=o.seq%>">\n                        <p class="avatar"><img src="<%=o.face || o.avatar%>"/></p>\n                        <div class="content">\n                            <p class="name"><%=o.name%></p>\n                            <div class="bubble">msgContent\n                              <% if(o.vote) { %>\n                              <div class="b2c-content-tails" data-id="<%=o.vote.id%>">\n                                  <% if (o.vote.active) { %>\n                                    <span class="b2c-content-tails-icon active b2c-content-tails-icon-<%= (o.vote.active.index == 0 ? \'up\' : \'down\')%>"><span class="b2c-content-tails-hand"></span></span>\n                                  <% } else {%>\n                                    <% for (var i = 0; i < (o.vote.button && o.vote.button.length); i++) {%>\n                                    <span data-key="<%=o.vote.button[i].key%>" data-index="<%=i%>" class="b2c-content-tails-icon b2c-content-tails-icon-<%= (i === 0 ? \'up\' : \'down\')%>"><span class="b2c-content-tails-hand"></span></span>\n                                    <% } %>\n                                  <% } %>\n                              </div>\n                              <% } %>\n                            </div>\n                        </div>\n                    </div>',c2b:'<div class="msg-c2b" data-guid="<%=seq%>"><div class="bubble"><i></i><p class="text"><%==data%></p></div></div>',c2bImage:'<div class="msg-c2b msg-image" data-guid="<%=seq%>"><div class="bubble"><i></i><p class="image"><img src="<%=data%>"/></p></div></div>',c2bVoice:'<div class="msg-c2b msg-voice <%=expired%>" data-guid="<%=seq%>"><div class="bubble" style="width: <%=width%>px;"><i></i><span class="duration"><%=duration%>"</span><div class="tip">转文字</div></div></div>',c2bVoiceRecording:'<div class="msg-c2b msg-voice msg-voice--recording"><div class="bubble"><i></i><span class="duration"></span><div class="tip">转文字</div></div></div>',c2bWrap:'<div class="msg-c2b <%=o.msgType%> <%=o.msgName%>" data-guid="<%=o.seq%>">\n                    <div class="bubble">msgContent</div>\n                </div>',callqq:'<div class="msg-offline">\n                        <div class="content">\n                            <div class="kf-detail">\n                                <p class="avatar"><img src="<%=avatar%>"/></p>\n                                <dl class="detail">\n                                    <dt><%=name%></dt>\n                                    <dd><%=corpName%><span class="resign"><%=resign%></span></dd>\n                                </dl>\n                            </div>\n                            <a href="javascript:;" class="btn-act" reqpos="1">$$$common_start_qq_chat_text$$$</a>\n                        </div>\n                    </div>',callqqCorpUin:'<div class="msg-offline">\n                            <div class="content">\n                                <div class="kf-detail">\n                                    <p class="avatar"><img src="<%=corpAvatar%>"/></p>\n                                    <dl class="detail">\n                                        <dt><%=corpName%></dt>\n                                    </dl>\n                                </div>\n                                <a href="javascript:;" class="btn-act" reqpos="1">$$$common_start_qq_chat_text$$$</a>\n                            </div>\n                        </div>',msgLoad:{getMsg:'<div class="load-status"><a href="javascript:;" class="btn-load-msg"><%==text%></a></div>',loading:'<div class="load-status"><p class="status-loading"><i class="loading loading-s"></i><span class="text"><%==text%></span></p></div>',overTip:'<p class="status-tip"><span class="text"><%==text%></span></p>',numTip:'<a href="javascript:;" class="btn-offlinemsg-gotop"><%==text%>条新消息<i class="icon-arrow-up"></i></a>'},menuMsgNormal:'<div class="mod-menu <% if(o.config.welcome == 1) { %>wel<% } %><% if(o.config.menu == 1) { %>nav<% } %><% if(o.config.button == 1) { %>btn<% } %>" data-guid="<%=o.guid%>" data-oldver="<% if(o.version >= o.currentVersion) {%>0<%} else {%>1<%}%>">\n                    <div class="menu-wrap"><% if(o.version >= o.currentVersion) { %>\n                        <% if(o.config.welcome == 1) { %><div class="menu-wel">\n                            <div class="tit">\n                                <dl>\n                                    <dt><img src="<%=o.eLogo%>" width="25" height="25"/></dt>\n                                    <dd><%=o.welcome.tit%></dd>\n                                </dl>\n                            </div>\n                            <p class="text"><%=o.welcome.intro%></p>\n                        </div><% } %>\n                        <% if(o.config.menu == 1) { %><div class="menu-nav">\n                            <p class="tit"><%=o.menu.tit%></p>\n                            <% for(var i = 0, l = o.menu.list.length;i<l;i++) {%><div class="nav-item">\n                                <div class="nav-hd">\n                                    <a href="javascript:;" data-action="<%= o.menu.list[i].action%>" data-origin-replytype="<%=o.menu.list[i].replyType %>" data-origin-replytext="<%= o.menu.list[i].replyText %>" data-origin-materialid="<%= o.menu.list[i].materialId %>" data-replytype="<%= o.menu.list[i].manualType || o.menu.list[i].replyType %>" data-replydata="<%=o.menu.list[i].serviceKfext || o.menu.list[i].groupId || o.menu.list[i].replyText || o.menu.list[i].imgurl || o.menu.list[i].url || o.menu.list[i].materialId%>"><span class="text"><%= o.menu.list[i].name%></span> <% if(o.menu.list[i].action == 4 && o.menu.list[i].sublist) { %><i class="icon-arrow-down"><% if(o.isMobile) { %><svg><use xlink:href="#back"/></svg><% } %></i><% } %></a>\n                                </div><% if(o.menu.list[i].action == 4 && o.menu.list[i].sublist) { %>\n                                <div class="nav-bd">\n                                    <ul><% for(var k = 0, len = o.menu.list[i].sublist.length;k<len;k++) {%>\n                                        <li><a href="javascript:;" data-action="<%= o.menu.list[i].sublist[k].action%>" data-origin-replytype="<%= o.menu.list[i].sublist[k].replyType %>" data-origin-replytext="<%= o.menu.list[i].sublist[k].replyText %>" data-origin-materialid="<%= o.menu.list[i].sublist[k].materialId %>" data-replytype="<%= o.menu.list[i].sublist[k].manualType || o.menu.list[i].sublist[k].replyType %>" data-replydata="<%= o.menu.list[i].sublist[k].serviceKfext || o.menu.list[i].sublist[k].groupId || o.menu.list[i].sublist[k].replyText || o.menu.list[i].sublist[k].imgurl || o.menu.list[i].sublist[k].url || o.menu.list[i].sublist[k].materialId%>"><%= o.menu.list[i].sublist[k].name%></a></li><% } %>\n                                    </ul>\n                                </div><% } %>\n                            </div><% } %>\n                        </div><% } %>\n                        <% if(o.config.button == 1) { %><div class="menu-action">\n                            <ul><% for(var i = 0, l = o.button.length;i<l;i++) {%>\n                                <li style="width:<%= o.buttonWidth %>%"><a href="javascript:;" data-action="<%= o.button[i].action%>" data-origin-replytype="<%= o.button[i].replyType %>" data-origin-replytext="<%= o.button[i].replyText %>" data-origin-materialid="<%= o.button[i].materialId %>" data-replytype="<%= o.button[i].manualType || o.button[i].replyType %>" data-replydata="<%= o.button[i].serviceKfext || o.button[i].groupId || o.button[i].replyText || o.button[i].imgurl || o.button[i].url || o.button[i].materialId%>"><%= o.button[i].name%></a></li><% } %>\n                            </ul>\n                        </div><% } %><% } else { %>\n                        <div class="menu-disabled">\n                            <dl>\n                                <dt></dt>\n                                <dd>$$$chat_menu_msg_history_expired_text$$$</dd>\n                            </dl>\n                        </div><% } %>\n                    </div>\n                  </div>',
menuMsgExpired:'<div class="menu-disabled">\n                            <dl>\n                                <dt></dt>\n                                <dd>$$$chat_menu_msg_history_expired_text$$$</dd>\n                            </dl>\n                        </div>',feedback:'<div class="mod-fb" data-fbkey=<%= o.fbKey %>>\n                            <div class="fb-wrap">\n                                <p class="tit">$$$chat_feedback_title_text$$$</p>\n                                <div class="fb-level">\n                                    <% for(var i = 0;i < o.levelDesc.length; i++) {%><a href="javascript:;" data-desc="<%= o.levelDesc[i] %>"><% if(o.isMobile) { %><svg><use xlink:href="#star"/></svg><% } else { %><i class="icon-star"></i><% } %></a><% } %>\n                                </div><% if(o.hasDesc) {%>\n                                <div class="fb-desc">\n                                    <p class="level-desc"></p>\n                                    <div class="post-text"><p class="text"></p></div>\n                                    <div class="post-area">\n                                        <textarea maxlength="<%= o.availLetterSum %>" placeholder="$$$chat_feedback_postarea_placeholder$$$"></textarea>\n                                        <span class="num"><%= o.availLetterSum %></span>\n                                    </div>\n                                    <a href="javascript:;" class="btn-submit">$$$chat_feedback_submit_text$$$</a>\n                                </div><% } %>\n                                <button class="fb-loading">$$$chat_feedback_submitting_text$$$</button>\n                            </div>\n                        </div>',blackTip:'<div class="mod-black-tip"><p class="text"><%= o.text %></p></div>',voiceTip:'<div class="mod-voice-tip"><i class="voice-icon <%=o.icon%>"></i><div class="voice-tip"><span><%= o.tip %></span></div></div>',translateTip:'<div class="mod-translate-tip"><i class="translate-icon <%=o.icon%>"></i><div class="translate-tip"><span><%= o.tip %></span></div></div>',receptionInfo:'<div class="mod-desc">\n                            <p class="logo"><img src="<%=o.avatar%>" width="64" height="64" alt="<%=o.name%>" title="<%=o.name%>"/></p>\n                            <p class="name" title="<%=o.name%>"><%=o.name%></p>\n                            <p class="company" title="<%=o.company%>"><%=o.company%></p>\n                            <p class="position" title="<%=o.position%>"><%=o.position%></p>\n                        </div>\n                        <div class="mod-connect">\n                            <ul>\n                                <% if(o.signature) { %><li title="<%=o.signature%>"><i class="icon-signature"></i><%=o.signature%></li><% } %>\n                                <% if(o.phone) { %><li><i class="icon-phone"></i><a href="tel:<%=o.phone%>" title="<%=o.phone%>"><%=o.phone%></a></li><% } %>\n                                <% if(o.fixedPhone) { %><li><i class="icon-tel"></i><a href="tel:<%=o.fixedPhone%>" title="<%=o.fixedPhone%>"><%=o.fixedPhone%></a></li><% } %>\n                                <% if(o.email) { %><li><i class="icon-email"></i><a href="mailto:<%=o.email%>" title="<%=o.email%>"><%=o.email%></a></li><% } %>\n                                <% if(o.companySites) { %><li><i class="icon-link"></i><a href="<%=o.companySites%>"  title="<%=o.companySites%>" target="_blank"><%=o.companySites%></a></li><% } %>\n                                <% if(o.companyAddress) { %><li title="<%=o.companyAddress%>"><i class="icon-address"></i><%=o.companyAddress%></li><% } %>\n                            </ul>\n                        </div>',privacyTips_b2c_base:'<div class="im-tips im-tips--b2c-base">\n                                    <div class="im-tips__content">你正在与猪八戒平台商户沟通，为更好地提供服务，沟通内容可能会被猪八戒平台保存和使用。</div>\n                                    <div class="im-tips__close-btn"></div>\n                               </div>'},RICH_MSG_TPL:['<% if(!o.isNeedWrap) {%><div class="mod-richmsg" data-guid="<%=o.seq%>"><% } %>\n            <div class="richmsg-type-0">\n                <div class="content">\n                    <dl>\n                        <dt class="title"><a href="javascript:;" action="<%=o.title.action%>" url="<%=o.title.url%>"><p><%=o.title.text%></p></a></dt>\n                        <dd class="thumb"><a href="javascript:;" action="<%=o.title.action%>" url="<%=o.title.url%>"><img src="<%=o.picture.cover%>"/></a></dd>\n                    </dl>\n                </div>\n                <div class="buttons"><% for(var i = 0, l = o.buttons.length;i<l;i++) {%>\n                    <a href="javascript:;" class="action" action="<%=o.buttons[i].action%>" actionData="<%=o.buttons[i].actionData%>"><%=o.buttons[i].text%></a>\n                </div><% } %>\n            </div>\n            <% if(!o.isNeedWrap) {%></div><% } %>','<div class="richmsg-type-1">\n            <div class="content">\n                <h2 class="title"><%=o.title.text%></h2>\n                <p class="thumb"><a href="javascript:;" class="action" action="<%=o.picture.action%>" actionData="<%=o.picture.actionData%>"><img src="<%=o.picture.cover || o.face%>"/></a></p>\n                <dl class="detail">\n                    <dt><a href="javascript:;" class="action" action="<%=o.detailText.mainText.action%>" actionData="<%=o.detailText.mainText.actionData%>"><%=o.detailText.mainText.text%></a></dt>\n                    <dd><a href="javascript:;" class="action" action="<%=o.detailText.subText.action%>" actionData="<%=o.detailText.subText.actionData%>"><%=o.detailText.subText.text%></a></dd>\n                </dl>\n            </div>\n        </div>',{simple:'\n                    <div class="richmsg-type-2">\n                        <div class="content simple" actionData="<%=o.data[0].url%>" action="web">\n                            <h2 class="title"><%=o.data[0].title%></h2>\n                            <h3 class="date"><%=o.data[0].date%></h3>\n                            <div class="thumb">\n                                <div class="img" style="background-image: url(<%=o.data[0].cover%>)"></div>\n                            </div>\n                            <div class="summary"><%=o.data[0].summary%></div>\n                            <div class="detail"><span>$$$chat_graphic_msg_readmore_text$$$</span><span class="arrow"></span></div>\n                        </div>\n                    </div>\n                    ',multiple:'\n                      <div class="richmsg-type-2">\n                          <ul class="content multiple">\n                              <% for (var i = 0;i < o.data.length; i++) { %>\n                                  <% if (i == 0) { %>\n                                      <li class="article main">\n                                          <div class="thumb" action="web" actionData="<%=o.data[i].url%>">\n                                              <div class="img" style="background-image: url(<%=o.data[i].cover%>)"></div>\n                                              <div class="title-wrap">\n                                                  <div class="title"><%=o.data[i].title%></div>\n                                              </div>\n                                          </div>\n                                      </li>\n                                  <% } else { %>\n                                      <li class="article sub">\n                                          <div class="thumb" action="web" actionData="<%=o.data[i].url%>">\n                                              <div class="title"><div><%=o.data[i].title%></div></div>\n                                              <div class="img" style="background-image: url(<%=o.data[i].cover%>)"></div>\n                                          </div>\n                                      </li>\n                                  <% } %>\n                              <% } %>\n                          </ul>\n                      </div>\n                      '},'<div class="richmsg-type-3">\n            <div class="content">\n            <%\n                var qlist = o.qlist || {},\n                    hasDesc = false,\n                    description = qlist.description || [],\n                    questions = qlist.questions || [];\n\n                if (qlist.type && qlist.type == 2) {\n                    hasDesc = true;\n            %>\n                <div class="desc-section <%= questions.length > 0 ? \'\' : \'desc-section--only\' %>">\n            <%\n                    for (var i = 0, len = description.length; i < len; i++) {\n                        if (description[i].url) {\n            %>\n                <a action="web" url="<%= description[i].url %>" href="<%= description[i].url %>" target="_blank"><%= description[i].text %></a>\n            <% } else { %>\n                <span><%= description[i].text %></span>\n            <% }} %> </div> <% } %>\n                <% if (questions.length > 0) { %>\n                <div class="question-title"><%= hasDesc ? \'你可能还想问：\' : \'亲，你是不是想问：\' %></div>\n                <ul class="question-list" data-type="<%= qlist.type %>">\n                    <% for (var i = 0, len = questions.length; i < len; i++) { %>\n                    <li class="question-item"><a action="msg" question="<%= questions[i].text %>" href="javascript:;"><i class="question-icon"></i><%= questions[i].text %></a></li>\n                    <% } %>\n                </ul>\n                <% } %>\n            </div>\n        </div>','<div class="richmsg-type-4">\n            <div class="content coupon" action="web" url=<%=o.data.url%>>\n                <div class="coupon-header" style="background-color: <%=o.data.bgColor%>;">\n                    <div class="coupon-info">\n                        <p class="name" title="<%=o.data.title%>"><%=o.data.title%></p>\n                        <p class="summary" title="<%=o.data.summary%>"><%=o.data.summary%></p>\n                    </div>\n                    <div class="coupon-icon" style="background-image:url(<%=o.data.cover%>)"></div>\n                </div>\n                <div class="coupon-footer">\n                    <p class="time"><%=o.data.remark%></p>\n                </div>\n            </div>\n        </div>','<div class="richmsg-type-5">\n            <div class="html-content">\n            </div>\n        </div>'],MSG_AUTO_COMPLETE_TPL:'<ul data-queryid="<%=o.queryid%>"><%for(var i=0;i<o.list.length;i++){%>\n            <li data-order="<%=o.list[i].order%>" data-docid="<%=o.list[i].reply_docid%>" title="<%=o.list[i].text%>"><span class="text"><i class="icon-q"></i><%=o.list[i].text%></span></li><%}%>\n        </ul>',SOCKET_CMD:{REG:{EMIT:"register",RECEIVE:"register ack"},C2B:{EMIT:"message c2b",RECEIVE:"message c2b ack"},B2C:{RECEIVE:"message b2c",EMIT:"message b2c ack"},KF_CHANGE:{EMIT:"change kf",RECEIVE:"change kf ack"},ROUTE:{RECEIVE:"route change",EMIT:"route change ack"},OVER:{RECEIVE:"session over"},SESSION_MSG:{RECEIVE:"s_msg",EMIT:"s_msg_ack"},CLIENT_PING:{EMIT:"p"}}},ft={win:window,receptionist:{},wpaDetail:{},getSignTData:{},kfChangeTip:0,isGetSignT:0,isRegOK:0,isMobile:0,isChangeKF:0,inRegProcess:0,isRealSendMsg:1,isInIframe:tt,defaultAvatar:dt.CGI_URL.COMP_SOURCE_URL+"img/default-avatar.png",imageLoadFail:dt.CGI_URL.COMP_SOURCE_URL+"img/image-load-fail.png",reSendC2bMsg:null,ioLinkStatus:null,regSuccessCallBack:null,imStatus:"open",pageStatus:"show",clickName:"click",chatSocket:new e,c2bDBsaveData:[],c2bSeqGroup:[],menuDetail:{active:0,currentVersion:"",eLogo:"",eName:"",defaultConfig:{active:0}},seqs:{key:"",data:[]},getSigTData:{},originRoleValue:null,clientPingTimer:null,serverClientTimeDiff:0,htReportOpts:{flag1:21873,flag2:1},registerType:"default",routePermit:{isCorpUin:0,isNeedQQ:1},lang:"zh-cn",wxConfig:{enableVoice:!1,appid:"",openid:""},externalType:1,isShowQidianSign:1,thirdAppConfig:{enable:!1,type:"",appId:"",openId:""}},ut=ft.win.navigator.userAgent.toLocaleLowerCase();ft.userAgent=ut,$.extend(ft,!0,{isGetSkin:0});var pt={chatBody:$("body"),header:$(".title-normal"),callGroup:$(".call-group"),chatList:$(".chat-list"),modList:$(".mod-list"),chatListWrap:$(".chat-list .list-wrap"),chatPost:$(".chat-post"),chatBtnSend:$(".btn-send"),btnUpload:$(".btn-upload"),btnFace:$(".btn-face"),btnVoice:$(".btn-voice"),btnKeyboard:$(".btn-keyboard"),faceList:$(".chat-face"),uploadInput:$("input[type=file]"),sidebar:$(".sidebar")},gt=$.extend(!0,{},pt,{page:$(".page"),chatPostArea:$(".post-area"),unReadMsgNum:$(".unread-msg-num"),statusBar:$(".title-minify"),sidebar:$(".sidebar")}),mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_t=function(){function e(e,t){var i=[],n=!0,a=!1,o=void 0;try{for(var s,r=e[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(c){a=!0,o=c}finally{try{!n&&r["return"]&&r["return"]()}finally{if(a)throw o}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),ht=function(e){if(e.BJ_REPORT)return e.BJ_REPORT;var t=[],i={},n={id:0,uin:0,url:"",offline_url:"",offline_auto_url:"",ext:null,level:4,ignore:[],random:1,delay:1e3,submit:null,repeat:5,offlineLog:!1,offlineLogExp:5,offlineLogAuto:!1},a={db:null,ready:function(e){var t=this;if(!window.indexedDB||!n.offlineLog)return n.offlineLog=!1,e();if(this.db)return void setTimeout(function(){e(null,t)},0);var i=1,a=window.indexedDB.open("badjs",i);return a?(a.onerror=function(t){return e(t),n.offlineLog=!1,!0},a.onsuccess=function(i){t.db=i.target.result,setTimeout(function(){e(null,t)},500)},void(a.onupgradeneeded=function(e){var t=e.target.result;t.objectStoreNames.contains("logs")||t.createObjectStore("logs",{autoIncrement:!0})})):(n.offlineLog=!1,e())},insertToDB:function(e){var t=this.getStore();t.add(e)},addLog:function(e){this.db&&this.insertToDB(e)},addLogs:function(e){if(this.db)for(var t=0;t<e.length;t++)this.addLog(e[t])},getLogs:function(e,t){if(this.db){var i=this.getStore(),n=i.openCursor(),a=[];n.onsuccess=function(i){var n=i.target.result;n?(n.value.time>=e.start&&n.value.time<=e.end&&n.value.id==e.id&&n.value.uin==e.uin&&a.push(n.value),n["continue"]()):t(null,a)},n.onerror=function(e){return t(e),!0}}},clearDB:function(e){if(this.db){var t=this.getStore();if(!e)return void t.clear();var i=Date.now()-24*(e||2)*3600*1e3,n=t.openCursor();n.onsuccess=function(e){var n=e.target.result;n&&(n.value.time<i||!n.value.time)&&(t["delete"](n.primaryKey),n["continue"]())}}},getStore:function(){var e=this.db.transaction("logs","readwrite");return e.objectStore("logs")}},o={isOBJByType:function(e,t){return Object.prototype.toString.call(e)==="[object "+(t||"Object")+"]"},isOBJ:function(e){var t="undefined"==typeof e?"undefined":mt(e);return"object"===t&&!!e},isEmpty:function(e){return null===e?!0:o.isOBJByType(e,"Number")?!1:!e},extend:function(e,t){for(var i in t)e[i]=t[i];return e},processError:function(e){try{if(e.stack){var t=e.stack.match("https?://[^\n]+");t=t?t[0]:"";var i=t.match(":(\\d+):(\\d+)");i||(i=[0,0,0]);var n=o.processStackMsg(e);return{msg:n,rowNum:i[1],colNum:i[2],target:t.replace(i[0],""),_orgMsg:e.toString()}}return e.name&&e.message&&e.description?{msg:JSON.stringify(e)}:e}catch(a){return e}},processStackMsg:function(e){var t=e.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),i=e.toString();return t.indexOf(i)<0&&(t=i+"@"+t),t},isRepeat:function(e){if(!o.isOBJ(e))return!0;var t=e.msg,a=i[t]=(parseInt(i[t],10)||0)+1;return a>n.repeat}},s=e.onerror;e.onerror=function(t,i,n,a,r){var c=t;r&&r.stack&&(c=o.processStackMsg(r)),o.isOBJByType(c,"Event")&&(c+=c.type?"--"+c.type+"--"+(c.target?c.target.tagName+"::"+c.target.src:""):""),m.push({msg:c,target:i,rowNum:n,colNum:a,_orgMsg:t}),g(),s&&s.apply(e,arguments)};var r=function(e,t){var i=[],a=[],s=[];if(o.isOBJ(e)){e.level=e.level||n.level;for(var r in e){var c=e[r];if(!o.isEmpty(c)){if(o.isOBJ(c))try{c=JSON.stringify(c)}catch(l){c="[BJ_REPORT detect value stringify error] "+l.toString()}s.push(r+":"+c),i.push(r+"="+encodeURIComponent(c)),a.push(r+"["+t+"]="+encodeURIComponent(c))}}}return[a.join("&"),s.join(","),i.join("&")]},c=[],l=function(e,t){return t=o.extend({id:n.id,uin:n.uin,time:new Date-0},t),a.db?void a.addLog(t):(a.db||c.length||a.ready(function(e,t){t&&c.length&&(t.addLogs(c),c=[])}),void c.push(t))},d=function(){var e=document.createElement("script");e.src=n.offline_auto_url||n.url.replace(/badjs$/,"offlineAuto")+"?id="+n.id+"&uin="+n.uin,window._badjsOfflineAuto=function(e){e&&ht.reportOfflineLog()},document.head.appendChild(e)},f=[],u=0,p=function(){if(clearTimeout(u),f.length){var e=n._reportUrl+f.join("&")+"&count="+f.length+"&_t="+ +new Date;if(n.submit)n.submit(e);else{var t=new Image;t.src=e}u=0,f=[]}},g=function(e){if(n._reportUrl){for(var i=Math.random()>=n.random;t.length;){var a=!1,s=t.shift();if(s.msg=(s.msg+""||"").substr(0,500),!o.isRepeat(s)){var c=r(s,f.length);if(o.isOBJByType(n.ignore,"Array"))for(var d=0,g=n.ignore.length;g>d;d++){var m=n.ignore[d];if(o.isOBJByType(m,"RegExp")&&m.test(c[1])||o.isOBJByType(m,"Function")&&m(s,c[1])){a=!0;break}}a||(n.offlineLog&&l("badjs_"+n.id+n.uin,s),i||20==s.level||(f.push(c[0]),n.onReport&&n.onReport(n.id,s)))}}e?p():u||(u=setTimeout(p,n.delay))}},m={};return m="localhost"!=window.location.host?e.BJ_REPORT={push:function(e){var i=o.isOBJ(e)?o.processError(e):{msg:e};if(n.ext&&!i.ext&&(i.ext=n.ext),i.from||(i.from=location.href),i._orgMsg){var a=i._orgMsg;delete i._orgMsg,i.level=2;var s=o.extend({},i);s.level=4,s.msg=a,t.push(i),t.push(s)}else t.push(i);return g(),m},report:function(e,t){return e&&m.push(e),t&&g(!0),m},info:function(e){return e?(o.isOBJ(e)?e.level=2:e={msg:e,level:2},m.push(e),m):m},debug:function(e){return e?(o.isOBJ(e)?e.level=1:e={msg:e,level:1},m.push(e),m):m},reportOfflineLog:function(){return window.indexedDB?void a.ready(function(e,t){if(t){var i=new Date-0-24*n.offlineLogExp*3600*1e3,a=new Date-0;t.getLogs({start:i,end:a,id:n.id,uin:n.uin},function(e,t){var o=document.createElement("iframe");o.name="badjs_offline_"+(new Date-0),o.frameborder=0,o.height=0,o.width=0,o.src="javascript:false;",o.onload=function(){var e=document.createElement("form");e.style.display="none",e.target=o.name,e.method="POST",e.action=n.offline_url||n.url.replace(/badjs$/,"offlineLog"),e.enctype.method="multipart/form-data";var s=document.createElement("input");s.style.display="none",s.type="hidden",s.name="offline_log",s.value=JSON.stringify({logs:t,userAgent:navigator.userAgent,startDate:i,endDate:a,id:n.id,uin:n.uin}),o.contentDocument.body.appendChild(e),e.appendChild(s),e.submit(),setTimeout(function(){document.body.removeChild(o)},1e4),o.onload=null},document.body.appendChild(o)})}}):void ht.info("unsupport offlineLog")},offlineLog:function(e){return e?(o.isOBJ(e)?e.level=20:e={msg:e,level:20},m.push(e),m):m},init:function(e){if(o.isOBJ(e))for(var i in e)n[i]=e[i];var s=parseInt(n.id,10);return s&&(/qq\.com$/gi.test(location.hostname)&&(n.url||(n.url="//badjs2.qq.com/badjs"),n.uin||(n.uin=parseInt((document.cookie.match(/\buin=\D+(\d+)/)||[])[1],10))),n._reportUrl=(n.url||"/badjs")+"?id="+s+"&uin="+n.uin+"&"),t.length&&g(),a._initing||(a._initing=!0,a.ready(function(e,t){t&&setTimeout(function(){t.clearDB(n.offlineLogExp),setTimeout(function(){n.offlineLogAuto&&d()},5e3)},1e3)})),m},__onerror__:e.onerror}:e.BJ_REPORT={push:function(e){return m},report:function(e,t){return m},info:function(e){return m},debug:function(e){return m},reportOfflineLog:function(){},offlineLog:function(e){return m},init:function(e){return m},__onerror__:e.onerror},"undefined"!=typeof console&&console.error&&setTimeout(function(){((location.hash||"").match(/([#&])BJ_ERROR=([^&$]+)/)||[])[2]},0),m}(window);"undefined"!=typeof module&&(module.exports=ht);var vt,qt=(function(){for(var e=["mb2345browser","ucbrowser"],t=window.navigator.userAgent.toLocaleLowerCase(),i={id:1,combo:0,url:"//badjs.qidian.qq.com/badjs",level:2},n=0;n<e.length;n++)if(-1!==t.indexOf(e[n])){$.extend(i,{ignore:[/Script error/i]});break}BJ_REPORT.init(i)}(),function(e){var t=/uc_msg|oppo_night|weibo|msfapi|axure/i,i=Object.prototype.toString;return!e||"[object String]"!==i.call(e)||t.test(e)?!1:e}),yt=function(){function e(e,t){i(e,"message",function(e){var i=qt(e.data);if(i){-1==i.indexOf(a)&&BJ_REPORT&&BJ_REPORT.report("PM NO Flag "+i);try{n=JSON.parse(i)}catch(e){throw new Error("PostMsg Parse Error "+i)}"function"==typeof t?t(n):""}},!1)}function t(e,t){var i=n?$.extend(n,e):e,s=t||o;i.hasOwnProperty(a)&&i[a]==s||(i[a]=s),i="string"!=typeof i?JSON.stringify(i):i,window.parent.postMessage(i,"*")}var n,a="QD_PM",o="CHAT";return{receive:e,send:t}}(),bt=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/=/g,"&#61;").replace(/`/g,"&#96;")},St=function(e,t,i){var n,a=/<%=(.+?)%>/g,o={}.toString;return n=e.replace(a,function(e,i){return"="===i.substring(0,1)?"[object Object]"==o.call(t,null)?t[i.substring(1)]:t:t[i]?bt("[object Object]"==o.call(t,null)?t[i]:t):""}),n=i?i(n):n},Tt=document,wt=function(){function e(e){return e in a?a[e]:!1}function t(e,t){return a[e]=t,!0}function i(e){var t=e in a;return t?delete a[e]:!1}function n(){return a={},!0}var a={};return{type:"memory",getItem:e,setItem:t,removeItem:i,clear:n}},Ct=function(e){function t(e){return o.getItem(e)}function i(e,t){try{return o.setItem(e,t),!0}catch(i){return!1}}function n(e){return o.removeItem(e)}function a(){return o.clear()}var o=wt();try{"localStorage"in e&&e.localStorage&&(e.localStorage.setItem("test","test"),e.localStorage.removeItem("test"),o=e.localStorage)}catch(s){BJ_REPORT&&BJ_REPORT.report(JSON.stringify(s))}return{type:o.type,get:t,set:i,remove:n,clear:a}}(window),kt=function(){function e(e,t){return e+""+t}function t(e){return 14==e.length?!0:!1}function i(e){return t(e)?e.substr(-1,1):e}function n(e){return t(e)?e.substr(0,13):e}return{setType:e,getType:i,getBody:n}}(),xt=function(e){for(var t=450,i=e.length,n=parseInt(i/t,10),n=i%t!==0?n+1:n,a=0;n>a;a++)BJ_REPORT.report("Seqs Sheet "+e.substr(t*a,t))},Et="MESSAGE_CACHE_",Rt=function(e){var t=ft.receptionist,i=""+Et+t.kfUin+"_"+t.visitorId,n=$t(i),a=pt.chatBody.hasClass("regsuccess")?"ack":"unconnect",o={singleSeqs:e.singleSeqs,seq:e.seq,cacheType:a};n.push(o),Ct.set(i,JSON.stringify(n))},It=function(e){var t=ft.receptionist,i=""+Et+t.kfUin+"_"+t.visitorId;Ct.set(i,JSON.stringify(e))},Ot=function(e){for(var t=ft.receptionist,i=""+Et+t.kfUin+"_"+t.visitorId,n=$t(i),a=0;a<n.length;a++)if(n[a].seq==e){n.splice(a,1);break}Ct.set(i,JSON.stringify(n))},$t=function(e){var t=[],i=e;i||(i=""+Et+ft.receptionist.kfUin+"_"+ft.receptionist.visitorId);try{t=JSON.parse(Ct.get(i))||[]}catch(n){}return t},Pt=function(e){for(var t="",i=$t(),n=0;n<i.length;n++)if(e==i[n].seq){t=i[n].cacheType;break}return t},Mt=function(){for(var e=$t(),t=[],i=0;i<e.length;i++)"unconnect"!=e[i].cacheType&&t.push(e[i]);It(t)},Lt=function(){It([])},Dt={setMsgCache:Rt,setMsgCacheList:It,removeMsgCache:Ot,getMsgCacheList:$t,hasSeqInMsgCache:Pt,clearUnconnectForCache:Mt,clearCache:Lt},At=function(){function e(e){s=ft.receptionist,t()}function t(){var e=JSON.parse(Ct.get("config")),t="kf"+s.kfUin,n=JSON.parse(Ct.get(t)),a=+new Date,o={visitorId:s.visitorId,startTime:a,total:0},r=!1;e?i():Ct.set("config",JSON.stringify({name:dt.MSG_DB_OPTS.NAME,version:dt.MSG_DB_OPTS.CURRENT_VERSION,createTime:a})),n?(n.forEach(function(e){e.visitorId==o.visitorId&&(r=!0)}),r||(n.push(o),Ct.set(t,JSON.stringify(n)),r=!0)):(Ct.set(t,JSON.stringify([o])),Ct.set(ft.seqs.key,JSON.stringify([]))),!Ct.get(ft.seqs.key)&&Ct.set(ft.seqs.key,JSON.stringify([]))}function i(){var e,t,i,a=Ct.get("config");if(~a.indexOf("verison")&&(BJ_REPORT.report("Wrong Word verison"),a=a.replace(/verison/g,"version"),Ct.set("config",a)),e=JSON.parse(a),t=e.version,"1.0.0"==t&&($.extend(e,{version:1,updateAct:{name:"reName",time:+new Date}}),Ct.set("config",JSON.stringify(e))),i=dt.MSG_DB_OPTS.CURRENT_VERSION-t,i>0){for(var o=0;i>o;o++)n(o+t+1);$.extend(e,{version:dt.MSG_DB_OPTS.CURRENT_VERSION,updateAct:{name:"update",time:+new Date}}),Ct.set("config",JSON.stringify(e))}}function n(e){var t="kf"+s.kfUin,i=JSON.parse(Ct.get(t));switch(e){case 2:for(var n=0;n<i.length;n++){var a=i[n].visitorId,o=i[n].total;if(a==s.visitorId&&o>0)for(var r=0;o>r;r++){var c=t+"vId"+a+"index"+r,l=JSON.parse(Ct.get(c));$.extend(l,{type:1}),Ct.set(c,JSON.stringify(l))}}break;case 3:$.isArray(i)||(i=[{visitorId:s.visitorId,total:0}],BJ_REPORT.report("Msgdb Update Error "+JSON.stringify(i)));for(var n=0;n<i.length;n++){var a=i[n].visitorId,o=i[n].total;if(a==s.visitorId&&o>0)for(var d=t+"vId"+a+"seqs",f=[],r=0;o>r;r++)f.push(r),Ct.set(d,JSON.stringify(f))}break;default:BJ_REPORT.report("VERSION INDEX ERROR: "+e)}}function a(e,t,i){var n,a=ft.receptionist,o=a.kfUin,s=a.visitorId,r=t["b2c"==e?"sortseq":"date"]+""+t.type,c="kf"+o+"vId"+s+"index"+r,d=ft.c2bDBsaveData,f=ft.seqs.data,u={};if(f&&$.isArray(f)||(ft.seqs.data=f=[],Ct.set(ft.seqs.key,JSON.stringify(f))),"b2c"==e){if(u={data:t.data,type:t.type,seq:t.seq,time:t.date,date:t.date,img_type:t.img_type,vote:t.vote},!i.singleSeqs)throw new Error("not sortSeqs");n=i.singleSeqs,3!=t.type&&$.extend(u,{dir:e,avatar:t.avatar,name:t.name}),5==t.type&&$.extend(u,{tpl:t.tpl,msgType:t.msgType,simple:t.simple,method:""}),"insert"==i.act?f.splice(i.index,0,i.singleSeqs):f.push(i.singleSeqs)}else if("c2b"==e){for(var p=0,g=d.length;g>p;p++){var m=d[p];if(m.seq==t.seq){$.extend(u,m,t),u.time=u.date,u.dir=e,d.splice(p,1),ft.c2bDBsaveData=d;break}}if(2==u.type){var _=u.data;u.data=u.imgSrc.replace(/\/0$/g,"/720"),u.imgSrc=_}pt.chatBody.hasClass("regsuccess")&&f.push(t.singleSeqs),n=t.singleSeqs,Dt.setMsgCache(u)}"undefined"!=typeof u.data.tpl&&delete u.data.tpl,r++,ft.seqs.data=f,(pt.chatBody.hasClass("regsuccess")||"c2b"!=e)&&l(o,s,"set"),Ct.set(c,JSON.stringify(u)),Ct.set(ft.seqs.key,JSON.stringify(f)),BJ_REPORT.report("Msg Dir "+e+" Seqs "+("b2c"==e?kt.setType(t.sortseq-ft.serverClientTimeDiff,t.type):n))}function o(e){var t=ft.c2bSeqGroup||[],i=e.date||e.time,n={seq:e.seq,data:e.data,type:e.type};2==e.type?$.extend(n,{imgSrc:e.imgSrc}):"",ft.c2bDBsaveData.push(n),t.push({date:i,seq:e.seq,type:e.type}),ft.c2bSeqGroup=t,c(i+""+e.type)&&Nt.saveMsg("c2b",{avatar:e.avatar,wordMsgSeq:e.wordMsgSeq,seq:e.seq,type:e.type,date:i,singleSeqs:i+""+e.type,vote:e.vote})}var s={};return{initialize:e,saveMsg:a,saveMsgToDB:o}},Nt=At(),Gt=[14,1,2,3,4,5,6,7,8,9,10,11,12,13,0,15,16,96,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,89,113,114,115,60,61,46,63,64,116,66,67,53,54,55,56,57,117,59,75,74,69,49,76,77,78,79,118,119,120,121,122,123,124,42,85,43,41,86,125,126,127,128,129,130,131,132,133,134,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,135,17,40,44,45,58,47,48,50,51,52,68,70,71,72,73,80,81,82,83,84,87,88,90,91,92,93,94,95,62,65,172,182,179,173,174,212,175,178,177,180,181,176,183,171,188,192,184,185,190,187,193,194,197,198,199,200,201,202,203,204,205,206,207,208,210,211],Bt=["微笑","撇嘴","色","发呆","得意","流泪","害羞","闭嘴","睡","大哭","尴尬","发怒","调皮","呲牙","惊讶","难过","酷","冷汗","抓狂","吐","偷笑","可爱","白眼","傲慢","饥饿","困","惊恐","流汗","憨笑","大兵","奋斗","咒骂","疑问","嘘...","晕","折磨","衰","骷髅","敲打","再见","擦汗","抠鼻","鼓掌","糗大了","坏笑","左哼哼","右哼哼","哈欠","鄙视","委屈","快哭了","阴险","亲亲","吓","可怜","菜刀","西瓜","啤酒","篮球","乒乓","咖啡","饭","猪头","玫瑰","凋谢","示爱","爱心","心碎","蛋糕","闪电","炸弹","刀","足球","瓢虫","便便","月亮","太阳","礼物","拥抱","强","弱","握手","胜利","抱拳","勾引","拳头","差劲","爱你","NO","OK","爱情","飞吻","跳跳","发抖","怄火","转圈","磕头","回头","跳绳","挥手","激动","街舞","献吻","左太极","右太极","双喜","鞭炮","灯笼","发财","K歌","购物","邮件","帅","喝彩","祈祷","爆筋","棒棒糖","喝奶","下面","香蕉","飞机","开车","高铁左车头","车厢","高铁右车头","多云","下雨","钞票","熊猫","灯泡","风车","闹钟","大伞","彩球","钻戒","沙发","纸巾","药","手枪","青蛙"],Ut=["qqface_Smile","qqface_Grimac","qqface_Drool","qqface_Scowl","qqface_Chill","qqface_Sob","qqface_Shy","qqface_Silent","qqface_Sleep","qqface_Cry","qqface_Awkward","qqface_Angry","qqface_Tongue","qqface_Grin","qqface_Surprise","qqface_Frown","qqface_CoolGuy","qqface_Helpless","qqface_Scream","qqface_Puke","qqface_Chuckle","qqface_Joyful","qqface_Slight","qqface_Smug","qqface_Hungry","qqface_Drowsy","qqface_Panic","qqface_Sweat","qqface_Laugh","qqface_Commando","qqface_Determined","qqface_Scold","qqface_Confused","qqface_Shhh","qqface_Dizzy","qqface_Torturing","qqface_Toasted","qqface_Skull","qqface_Hammer","qqface_Bye","qqface_Speechless","qqface_NosePick","qqface_Clap","qqface_Embarrased","qqface_Trick","qqface_Hum!L","qqface_Hum!R","qqface_Yawn","qqface_Pooh-pooh","qqface_Shrunken","qqface_TearingUp","qqface_Sly","qqface_Kiss","qqface_What!","qqface_Whimper","qqface_Cleaver","qqface_Watermelon","qqface_Beer","qqface_Basketball","qqface_Pingpong","qqface_Coffee","qqface_Rice","qqface_Pig","qqface_Rose","qqface_Wilt","qqface_Lips","qqface_Heart","qqface_BrokenHeart","qqface_Cake","qqface_Lightning","qqface_Bomb","qqface_Knife","qqface_Football","qqface_Beetle","qqface_Poop","qqface_Moon","qqface_Sun","qqface_Gift","qqface_Hug","qqface_Thumbsup","qqface_Thumbsdown","qqface_Shake","qqface_Victory","qqface_Salute","qqface_Beckon","qqface_Fist","qqface_Bad","qqface_LoveYou","qqface_NO","qqface_OK","qqface_Love","qqface_Blow_a_kiss","qqface_Waddle","qqface_Tremble","qqface_Aaagh!","qqface_Twirl","qqface_Kowtow","qqface_Turn_round","qqface_Rope_Skipping","qqface_Wave_hand","qqface_Excited","qqface_Street_Dance","qqface_Give_a_kiss","qqface_Tai_Chi_L","qqface_Tai_Chi_R","qqface_Bliss","qqface_Firecracker","qqface_Lantern","qqface_Fortune","qqface_Karaoke","qqface_Shopping","qqface_Email","qqface_Handsome","qqface_Hurray","qqface_Pray","qqface_Furious","qqface_Lollipop","qqface_Drink_milk","qqface_Noodles","qqface_Banana","qqface_Plane","qqface_Driving","qqface_Highspeed_Rail_L","qqface_Carriage","qqface_Highspeed_Rail_R","qqface_Cloudy","qqface_Rainy","qqface_Cash","qqface_Panda","qqface_Light_bulb","qqface_Windmill","qqface_Alarm_Clock","qqface_Umbrella","qqface_Balloon","qqface_Ring","qqface_Sofa","qqface_Toilet_Paper","qqface_Medicine","qqface_Pistol","qqface_Frog"],Ht={index:Gt,humen:Bt,locale:Ut},Ft=function(e,t){var i,n,e=e?e:window.location.href;if(t){i=new RegExp("[?&]"+t+"=([^&#]*)","i");try{n=i.exec(e)[1]}catch(a){n=null}}else n=e.substring(e.indexOf("?")+1);return n},Jt={qqface_Smile:"Smile",qqface_Grimac:"Grimac",qqface_Drool:"Drool",qqface_Scowl:"Scowl",qqface_Chill:"Chill",qqface_Sob:"Sob",qqface_Shy:"Shy",qqface_Silent:"Silent",qqface_Sleep:"Sleep",qqface_Cry:"Cry",qqface_Awkward:"Awkward",qqface_Angry:"Angry",qqface_Tongue:"Tongue",qqface_Grin:"Grin",qqface_Surprise:"Surprise",qqface_Frown:"Frown",qqface_CoolGuy:"CoolGuy",qqface_Helpless:"Helpless",qqface_Scream:"Scream",qqface_Puke:"Puke",qqface_Chuckle:"Chuckle",qqface_Joyful:"Joyful",qqface_Slight:"Slight",qqface_Smug:"Smug",qqface_Hungry:"Hungry",qqface_Drowsy:"Drowsy",qqface_Panic:"Panic",qqface_Sweat:"Sweat",qqface_Laugh:"Laugh",qqface_Commando:"Commando",qqface_Determined:"Determined",qqface_Scold:"Scold",qqface_Confused:"Confused",qqface_Shhh:"Shhh",qqface_Dizzy:"Dizzy",qqface_Torturing:"Torturing",qqface_Toasted:"Toasted",qqface_Skull:"Skull",qqface_Hammer:"Hammer",qqface_Bye:"Bye",qqface_Speechless:"Speechless",qqface_NosePick:"NosePick",qqface_Clap:"Clap",qqface_Embarrased:"Embarrased",qqface_Trick:"Trick","qqface_Hum!L":"Hum!L","qqface_Hum!R":"Hum!R",qqface_Yawn:"Yawn","qqface_Pooh-pooh":"Pooh-pooh",qqface_Shrunken:"Shrunken",qqface_TearingUp:"TearingUp",
qqface_Sly:"Sly",qqface_Kiss:"Kiss","qqface_What!":"What!",qqface_Whimper:"Whimper",qqface_Cleaver:"Cleaver",qqface_Watermelon:"Watermelon",qqface_Beer:"Beer",qqface_Basketball:"Basketball",qqface_Pingpong:"Pingpong",qqface_Coffee:"Coffee",qqface_Rice:"Rice",qqface_Pig:"Pig",qqface_Rose:"Rose",qqface_Wilt:"Wilt",qqface_Lips:"Lips",qqface_Heart:"Heart",qqface_BrokenHeart:"BrokenHeart",qqface_Cake:"Cake",qqface_Lightning:"Lightning",qqface_Bomb:"Bomb",qqface_Knife:"Knife",qqface_Football:"Football",qqface_Beetle:"Beetle",qqface_Poop:"Poop",qqface_Moon:"Moon",qqface_Sun:"Sun",qqface_Gift:"Gift",qqface_Hug:"Hug",qqface_Thumbsup:"Thumbsup",qqface_Thumbsdown:"Thumbsdown",qqface_Shake:"Shake",qqface_Victory:"Victory",qqface_Salute:"Salute",qqface_Beckon:"Beckon",qqface_Fist:"Fist",qqface_Bad:"Bad",qqface_LoveYou:"LoveYou",qqface_NO:"NO",qqface_OK:"OK",qqface_Love:"Love",qqface_Blow_a_kiss:"Blow a kiss",qqface_Waddle:"Waddle",qqface_Tremble:"Tremble","qqface_Aaagh!":"Aaagh!",qqface_Twirl:"Twirl",qqface_Kowtow:"Kowtow",qqface_Turn_round:"Turn round",qqface_Rope_Skipping:"Rope Skipping",qqface_Wave_hand:"Wave hand",qqface_Excited:"Excited",qqface_Street_Dance:"Street Dance",qqface_Give_a_kiss:"Give a kiss",qqface_Tai_Chi_L:"Tai Chi L",qqface_Tai_Chi_R:"Tai Chi R",qqface_Bliss:"Bliss",qqface_Firecracker:"Firecracker",qqface_Lantern:"Lantern",qqface_Fortune:"Fortune",qqface_Karaoke:"Karaoke",qqface_Shopping:"Shopping",qqface_Email:"Email",qqface_Handsome:"Handsome",qqface_Hurray:"Hurray",qqface_Pray:"Pray",qqface_Furious:"Furious",qqface_Lollipop:"Lollipop",qqface_Drink_milk:"Drink milk",qqface_Noodles:"Noodles",qqface_Banana:"Banana",qqface_Plane:"Plane",qqface_Driving:"Driving",qqface_Highspeed_Rail_L:"Highspeed Rail L",qqface_Carriage:"Carriage",qqface_Highspeed_Rail_R:"Highspeed Rail R",qqface_Cloudy:"Cloudy",qqface_Rainy:"Rainy",qqface_Cash:"Cash",qqface_Panda:"Panda",qqface_Light_bulb:"Light bulb",qqface_Windmill:"Windmill",qqface_Alarm_Clock:"Alarm Clock",qqface_Umbrella:"Umbrella",qqface_Balloon:"Balloon",qqface_Ring:"Ring",qqface_Sofa:"Sofa",qqface_Toilet_Paper:"Toilet Paper",qqface_Medicine:"Medicine",qqface_Pistol:"Pistol",qqface_Frog:"Frog",common_page_title:"Online consultation",common_sendbtn_text:"Send",common_voicebtn_hold_text:"Hold to Talk",common_voicebtn_release_text:"Release to send",common_voicebtn_cancel_text:"Release to cancel",common_insert_photo_text:"Insert photo",common_insert_emoji_text:"Insert emoji",common_postarea_pc_placeholder:'Press "Enter" to send message, "Ctrl + Enter" change to new line',common_postarea_mobile_placeholder:"Please enter",common_chatting_text:"Chatting",common_leave_message_text:"Message",common_chatting_with_text:"Chatting with $1",common_qq_chat_text:"QQ Chat",common_start_qq_chat_text:"Start QQchat",common_new_message_text:"New message",common_add_qq_friend_text:"Add QQ friends",common_confirm_text:"Confirm",common_cancel_text:"Cancel",common_tencent_certification:"certification-en",sysmsg_get_sigt_msg:"Receiving authenticated message",sysmsg_get_sigt_timeout_msg:'Timeout, please <a class="btn-refresh" href="javascript:;" onclick="location.reload();">refresh</a> to try again',sysmsg_get_sigt_fail_msg:'Access fails, please <a class="btn-refresh" href="javascript:;" onclick="location.reload();">refresh</a> to try again',sysmsg_load_corpinfo_msg:"Loading business information",sysmsg_load_corpinfo_fail_msg:"Failed to load business information",sysmsg_session_end_msg:"Consultation is ended",sysmsg_disconnect_msg:'Network error, please <a class="btn-refresh" href="javascript:;" onclick="location.reload();">refresh</a> to try again',sysmsg_connect_msg:"Successful connection to server, please wait to enter",sysmsg_connecting_msg:"System connecting, please wait",sysmsg_connect_error_msg:"Connection fails, automatically reconnects",sysmsg_reconnect_error_msg:"Connection fails, automatically reconnects",sysmsg_reconnect_fail_msg:'Network error, please <a class="btn-refresh" href="javascript:;" onclick="location.reload();">refresh</a> to try again',sysmsg_reconnecting_msg:"Reconnecting, please wait",sysmsg_reg_timeout_msg:'Timeout, please <a class="btn-refresh" href="javascript:;" onclick="location.reload();">refresh</a> to try again',sysmsg_reg_success_msg:"Successful connection",sysmsg_rereg_msg:'Network error, please <a class="btn-refresh" href="javascript:;" onclick="location.reload();">refresh</a> to try again',sysmsg_message_expired_msg:"This message is expired",sysmsg_feeback_msg:"Thank you for your advice",sysmsg_callqq_msg:'Agent is offline at the moment, you can press "QQchat" continue your consultation',sysmsg_callqq_corpuin_msg:'Agent is offline at the moment, you can press "QQchat" continue your consultation',sysmsg_upload_image_max_msg:"Photo number exceeds $1 limit",sysmsg_upload_image_wifi_warning_msg:"Attention: sending photos under non-wifi networks may consume much cellular data",sysmsg_add_friend_fail_msg:"Add friends fails, please click name tag or copy QQ no. to add manually",sysmsg_graphic_msg_fail_msg:"Temporarily out of service, please try later",sysmsg_no_visitorid_error_msg:'Unable to get visitor id，please <a class="btn-refresh" href="javascript:;" onclick="location.reload();">refresh</a> to try again',sysmsg_change_kf_msg:'Need to switch customer agent?<br/><a href="javascript:;" class="btn-newkf">Confirm to switch</a>',sysmsg_auto_change_kf_msg:"Last agent is offline，you are automatically being switched to a new one",sysmsg_change_b2c_kf_msg:"Conversation has been switched to $1",sysmsg_msg_revoke_msg:" has recalled a message",chat_max_post_limit_text:"Content exceeds text limit",chat_history_msg_get_text:"Click to load historical messages",chat_history_msg_loading_text:"Loading historical messages",chat_offline_msg_loading_text:"Loading new messages",chat_offline_msg_fail_text:"Fail to receive new messages, please click to retry",chat_offline_msg_over_text:"New message",chat_menu_msg_loading_text:"Loading navigation",chat_menu_msg_fail_text:"Fail to receive navigation, click to retry",chat_menu_msg_history_expired_text:"Historical messages has expired",chat_graphic_msg_readmore_text:"Read more",chat_feedback_title_text:"Please rate for the service",chat_feedback_submit_text:"Submit",chat_feedback_postarea_placeholder:"Your advice is mostly welcomed :)",chat_feedback_submitting_text:"Submitting",chat_feedback_success_msg:"Submitted successfully",chat_feedback_fail_msg:"Submission Failed",chat_feedback_error_msg:"Network error, please try again",chat_feedback_very_dissatisfied_text:"Very Dissatisfied",chat_feedback_dissatisfied_text:"Dissatisfied",chat_feedback_neutral_text:"Neutral",chat_feedback_satisfied_text:"Satisfied",chat_feedback_very_satisfied_text:"Very Satisfied",chat_add_friend_fetching_protocol_msg:"Fetching protocol",chat_add_friend_copy_success_msg:"Successful copy",chat_add_friend_fail_text:"Fail",chat_add_friend_fail_get_number_fail_text:"Failed to get numerical data",chat_add_friend_fail_no_text_selected_text:"No text selected, please copy it manually",chat_add_friend_fail_browser_not_support_text:"Browser does not support, please copy it manually"},jt={qqface_Smile:"微笑",qqface_Grimac:"撇嘴",qqface_Drool:"色",qqface_Scowl:"发呆",qqface_Chill:"得意",qqface_Sob:"流泪",qqface_Shy:"害羞",qqface_Silent:"闭嘴",qqface_Sleep:"睡",qqface_Cry:"大哭",qqface_Awkward:"尴尬",qqface_Angry:"发怒",qqface_Tongue:"调皮",qqface_Grin:"呲牙",qqface_Surprise:"惊讶",qqface_Frown:"难过",qqface_CoolGuy:"酷",qqface_Helpless:"冷汗",qqface_Scream:"抓狂",qqface_Puke:"吐",qqface_Chuckle:"偷笑",qqface_Joyful:"可爱",qqface_Slight:"白眼",qqface_Smug:"傲慢",qqface_Hungry:"饥饿",qqface_Drowsy:"困",qqface_Panic:"惊恐",qqface_Sweat:"流汗",qqface_Laugh:"憨笑",qqface_Commando:"大兵",qqface_Determined:"奋斗",qqface_Scold:"咒骂",qqface_Confused:"疑问",qqface_Shhh:"嘘...",qqface_Dizzy:"晕",qqface_Torturing:"折磨",qqface_Toasted:"衰",qqface_Skull:"骷髅",qqface_Hammer:"敲打",qqface_Bye:"再见",qqface_Speechless:"擦汗",qqface_NosePick:"抠鼻",qqface_Clap:"鼓掌",qqface_Embarrased:"糗大了",qqface_Trick:"坏笑","qqface_Hum!L":"左哼哼","qqface_Hum!R":"右哼哼",qqface_Yawn:"哈欠","qqface_Pooh-pooh":"鄙视",qqface_Shrunken:"委屈",qqface_TearingUp:"快哭了",qqface_Sly:"阴险",qqface_Kiss:"亲亲","qqface_What!":"吓",qqface_Whimper:"可怜",qqface_Cleaver:"菜刀",qqface_Watermelon:"西瓜",qqface_Beer:"啤酒",qqface_Basketball:"篮球",qqface_Pingpong:"乒乓",qqface_Coffee:"咖啡",qqface_Rice:"饭",qqface_Pig:"猪头",qqface_Rose:"玫瑰",qqface_Wilt:"凋谢",qqface_Lips:"示爱",qqface_Heart:"爱心",qqface_BrokenHeart:"心碎",qqface_Cake:"蛋糕",qqface_Lightning:"闪电",qqface_Bomb:"炸弹",qqface_Knife:"刀",qqface_Football:"足球",qqface_Beetle:"瓢虫",qqface_Poop:"便便",qqface_Moon:"月亮",qqface_Sun:"太阳",qqface_Gift:"礼物",qqface_Hug:"拥抱",qqface_Thumbsup:"强",qqface_Thumbsdown:"弱",qqface_Shake:"握手",qqface_Victory:"胜利",qqface_Salute:"抱拳",qqface_Beckon:"勾引",qqface_Fist:"拳头",qqface_Bad:"差劲",qqface_LoveYou:"爱你",qqface_NO:"NO",qqface_OK:"OK",qqface_Love:"爱情",qqface_Blow_a_kiss:"飞吻",qqface_Waddle:"跳跳",qqface_Tremble:"发抖","qqface_Aaagh!":"怄火",qqface_Twirl:"转圈",qqface_Kowtow:"磕头",qqface_Turn_round:"回头",qqface_Rope_Skipping:"跳绳",qqface_Wave_hand:"挥手",qqface_Excited:"激动",qqface_Street_Dance:"街舞",qqface_Give_a_kiss:"献吻",qqface_Tai_Chi_L:"左太极",qqface_Tai_Chi_R:"右太极",qqface_Bliss:"双喜",qqface_Firecracker:"鞭炮",qqface_Lantern:"灯笼",qqface_Fortune:"发财",qqface_Karaoke:"K歌",qqface_Shopping:"购物",qqface_Email:"邮件",qqface_Handsome:"帅",qqface_Hurray:"喝彩",qqface_Pray:"祈祷",qqface_Furious:"爆筋",qqface_Lollipop:"棒棒糖",qqface_Drink_milk:"喝奶",qqface_Noodles:"下面",qqface_Banana:"香蕉",qqface_Plane:"飞机",qqface_Driving:"开车",qqface_Highspeed_Rail_L:"高铁左车头",qqface_Carriage:"车厢",qqface_Highspeed_Rail_R:"高铁右车头",qqface_Cloudy:"多云",qqface_Rainy:"下雨",qqface_Cash:"钞票",qqface_Panda:"熊猫",qqface_Light_bulb:"灯泡",qqface_Windmill:"风车",qqface_Alarm_Clock:"闹钟",qqface_Umbrella:"大伞",qqface_Balloon:"彩球",qqface_Ring:"钻戒",qqface_Sofa:"沙发",qqface_Toilet_Paper:"纸巾",qqface_Medicine:"药",qqface_Pistol:"手枪",qqface_Frog:"青蛙",common_page_title:"在线咨询",common_sendbtn_text:"发送",common_voicebtn_hold_text:"按住 说话",common_voicebtn_release_text:"松开 结束",common_voicebtn_cancel_text:"松开手指，取消发送",common_insert_photo_text:"上传图片",common_insert_emoji_text:"输入表情",common_postarea_pc_placeholder:"请输入，按Enter直接发送消息，Ctrl+Enter换行",common_postarea_mobile_placeholder:"请点击输入",common_chatting_text:"交谈中",common_leave_message_text:"留言了",common_chatting_with_text:"与$1交谈中",common_qq_chat_text:"去QQ交谈",common_start_qq_chat_text:"发起QQ会话",common_new_message_text:"你有【新消息】",common_add_qq_friend_text:"添加QQ联系人",common_confirm_text:"确定",common_cancel_text:"取消",common_tencent_certification:"",sysmsg_get_sigt_msg:"正在获取鉴权信息",sysmsg_get_sigt_timeout_msg:'接入超时，请<a class="btn-refresh" href="javascript:;" onclick="location.reload();">刷新页面</a>重试',sysmsg_get_sigt_fail_msg:'接入失败，请<a class="btn-refresh" href="javascript:;" onclick="location.reload();">刷新页面</a>重试',sysmsg_load_corpinfo_msg:"正在加载企业信息",sysmsg_load_corpinfo_fail_msg:"企业信息拉取失败",sysmsg_session_end_msg:"本次咨询已结束，发送消息可开始新的咨询",sysmsg_disconnect_msg:'当前会话网络已中断，请<a class="btn-refresh" href="javascript:;" onclick="location.reload();">刷新页面</a>或再发条消息试试',sysmsg_connect_msg:"与服务器连接成功，请等待接入",sysmsg_connecting_msg:"正在与服务器建立连接",sysmsg_connect_error_msg:"服务连接失败，即将自动为您重新建立连接",sysmsg_reconnect_error_msg:"服务连接失败，即将自动为您重新建立连接",sysmsg_reconnect_fail_msg:'当前网络有点问题，请<a class="btn-refresh" href="javascript:;" onclick="location.reload();">刷新页面</a>或再发条消息试试',sysmsg_reconnecting_msg:"正在重新与服务器建立连接",sysmsg_reg_timeout_msg:'建立会话超时，请<a class="btn-refresh" href="javascript:;" onclick="location.reload();">刷新页面</a>再试试',sysmsg_reg_success_msg:"接入成功",sysmsg_rereg_msg:'网络有点问题无法接入客户，请<a class="btn-refresh" href="javascript:;" onclick="location.reload();">刷新页面</a>再试试',sysmsg_message_expired_msg:"此消息已过期",sysmsg_feeback_msg:"感谢您的意见和建议，我们将继续努力",sysmsg_callqq_msg:"客服暂时不在线，您可直接发起QQ会话进行咨询",sysmsg_callqq_corpuin_msg:"客服暂时不在线，您可直接发起QQ会话进行咨询",sysmsg_upload_image_max_msg:"图片数目超过最大$1张限制",sysmsg_upload_image_wifi_warning_msg:"温馨提示：非wifi网络下发送图片可能会耗费较多流量",sysmsg_add_friend_fail_msg:'添加好友失败，请点击名片重试或<a href="javascript:;" class="btn-paste">复制QQ号</a>手动添加',sysmsg_graphic_msg_fail_msg:"服务暂不可用，请稍后重试",sysmsg_no_visitorid_error_msg:'无法获取访客ID，请<a class="btn-refresh" href="javascript:;" onclick="location.reload();">刷新页面</a>重试',sysmsg_change_kf_msg:'需要切换客服人员吗?<br/><a href="javascript:;" class="btn-newkf">确认切换客服</a>',sysmsg_auto_change_kf_msg:"原客服不在线，已为您自动更换在线的客服",sysmsg_change_b2c_kf_msg:"会话已转接到$1，欢迎继续咨询",sysmsg_msg_revoke_msg:"撤回了一条消息",chat_max_post_limit_text:"发送消息过长，请分条发送。",chat_history_msg_get_text:"点击加载更多历史消息",chat_history_msg_loading_text:"正在加载历史消息",chat_offline_msg_loading_text:"正在加载新消息",chat_offline_msg_fail_text:"新消息加载失败，点击重试",chat_offline_msg_over_text:"以下为未读消息",chat_menu_msg_loading_text:"正在加载菜单导航",chat_menu_msg_fail_text:"菜单导航加载失败，点击重试",chat_menu_msg_history_expired_text:"历史数据已失效",chat_graphic_msg_readmore_text:"阅读原文",chat_feedback_title_text:"请为本次服务打分",chat_feedback_submit_text:"提交",chat_feedback_postarea_placeholder:"感谢您的评分，可留下其他意见或建议",chat_feedback_submitting_text:"正在提交评价",chat_feedback_success_msg:"提交成功",chat_feedback_fail_msg:"提交失败",chat_feedback_error_msg:"网络错误，请重试",chat_feedback_very_dissatisfied_text:"非常不满意",chat_feedback_dissatisfied_text:"不满意",chat_feedback_neutral_text:"一般",chat_feedback_satisfied_text:"满意",chat_feedback_very_satisfied_text:"非常满意",chat_add_friend_fetching_protocol_msg:"正在获取添加协议",chat_add_friend_copy_success_msg:"复制成功",chat_add_friend_fail_text:"失败",chat_add_friend_fail_get_number_fail_text:"获取号码数据失败",chat_add_friend_fail_no_text_selected_text:"没有选中文字，请手工复制",chat_add_friend_fail_browser_not_support_text:"浏览器不支持，请手工复制"},Wt=function(e){var t,i,n=$.extend(!0,{},ft.getSigTData),a=ft.isInIframe,o="mqq"===ft.inWebViewType?!0:!1;ft.isMobile?a?(e=e.replace(/\+/gi,"%2B"),window.parent.postMessage({act:"LAUNCH",type:"PHONE",sign:e,protocol:dt.CGI_URL.ROUTE_CHANGE_LOADING.QQ+"?fromWebIm=1&"+$.param(n)+"&protocol="+e},"*")):o?top.location.href=e:top.location.href=dt.CGI_URL.ROUTE_CHANGE_LOADING.QQ+"?"+Ft(window.location.href)+"&protocol="+e:"https"===window.location.protocol&&-1===ft.userAgent.indexOf("msie")?window.location.href=e:(t=document.createElement("iframe"),i=document.body,t.style.display="none",i.insertBefore(t,i.firstChild),t.src=e)},Kt=function(){function e(){ft.clientPingTimer||(ft.clientPingTimer=setInterval(function(){ft.chatSocket.emitMsg(dt.SOCKET_CMD.CLIENT_PING.EMIT,{})},n))}function t(){ft.clientPingTimer&&(clearInterval(ft.clientPingTimer),ft.clientPingTimer=null)}function i(){t(),e()}var n=dt.SOCKET_OPTS.CLIENT_PING_DELAY;return{add:e,remove:t,update:i}}(),Vt=3,Qt={voteGuidTemp:{},voteSeqMap:{},render:function(e,t){var i=e.sortseq||e.time,n=e.data,a=$.tmpl.joinTpl(dt.CHAT_MSG_TPL.b2cWrap,"msgContent",dt.RICH_MSG_TPL[Vt]);$.extend(n,{name:e.name,avatar:e.avatar,msgName:"msg-qlist",tpl:a,seq:i}),n=Qt.processData(n);var o=$($.tmpl(n.tpl,n).replace(/&lt;br\/?&gt;/g,"<br/>"));return e.sortSeq=i,Qt.bindEvent(o,e),o},bindEvent:function(e,t){var i=e.find(".question-list").data("type"),a=e.find(".b2c-content-tails"),o=t.sortSeq+""+t.type,s=ft.receptionist,r="kf"+s.kfUin+"vId"+s.visitorId+"index"+o,c=t.sortSeq;a.delegate(".b2c-content-tails-icon","click",function(e){if(e.preventDefault(),!(Qt.voteGuidTemp[c]||$(this).hasClass("active")||$(this).hasClass("flash"))){var t=$(this).parents(".b2c-content-tails"),i=t.attr("data-id"),a=$(this).attr("data-key"),o=$(this).attr("data-index"),s=n(dt.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP);Qt.voteSeqMap[s]=c,Qt.voteGuidTemp[c]={index:o,key:a,localStorageKey:r};var l={data:"",seq:s,type:1,wordMsgSeq:n(dt.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC),date:+new Date+ft.serverClientTimeDiff,vote:{id:i,click:[{key:a}]}};ft.chatSocket.emitMsg(dt.SOCKET_CMD.C2B.EMIT,l)}}),e.delegate("a","click",function(e){e.preventDefault();var t=$(e.currentTarget),a=t.attr("action"),o=t.attr("url"),s=t.attr("question");switch(a){case"web":_(o);break;case"msg":var r={data:s,seq:n(dt.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),type:1,wordMsgSeq:n(dt.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC),date:+new Date+ft.serverClientTimeDiff,qlist:{kfUin:ft.receptionist.kfUin,type:i}};2==ft.registerType&&$.extend(r,{queueKey:ft.queueKey}),Ai.normal.render("c2b",r);break;default:BJ_REPORT.report("QlistMsg Action Error: "+a)}})},handleC2bReceiveSeq:function(e,t){if(Qt.voteSeqMap[t]&&Qt.voteGuidTemp[Qt.voteSeqMap[t]]){var i=Qt.voteSeqMap[t];if(0===e){var n=$('[data-guid="'+i+'"]'),a=Qt.voteGuidTemp[Qt.voteSeqMap[t]],o=a.index,s=a.key,r=a.localStorageKey,c=n.find(".b2c-content-tails-icon").eq(o);c.addClass("flash"),setTimeout(function(){c.removeClass("flash").addClass("active").siblings().remove()},300);var l=JSON.parse(Ct.get(r));l&&(l.data.vote.active={index:o,key:s},Ct.set(r,JSON.stringify(l)))}delete Qt.voteGuidTemp[Qt.voteSeqMap[t]],delete Qt.voteSeqMap[t]}},processData:function(e){function t(e){return e.replace(/\r\n/g,"<br/>").replace(/[\n\r]/g,"<br/>")}var i=e.vote||{},n=e.qlist||{},a=i.description||n.description||[],o=i.questions||n.questions||[];return n.type=n.type||i.type||"2",a.length>0&&$.each(a,function(e,i){i.text=t(i.text)}),o.length>0&&$.each(o,function(e,i){i.text=t(i.text)}),n.description=a,n.questions=o,e.qlist=n,e}},zt=2592e5,Yt=!1,Xt="init",Zt={render:function(e,t){var i=void 0;if(t.isFromHistory)$.extend(e,{duration:e.data.duration,width:Zt.computeVoiceLength(e.data.duration)}),e.data.recordTime&&e.data.recordTime+zt<+new Date&&$.extend(e,{expired:"msg-voice--expired"}),i=$(St(dt.CHAT_MSG_TPL.c2bVoice,e)),"ack"===t.cacheStatus&&i.find(".duration").text(""),Zt.bindEvent(i,e);else{var n=e.seq;i=pt.chatListWrap.find('[data-guid="'+n+'"]')}return i},computeVoiceLength:function(e){var t=90,i=5;return e=parseInt(e),t+10*Math.ceil((e-i)/5)},handleAck:function(e,t){var i=e.seq||"",n=e.data||{},a=pt.chatListWrap.find('[data-guid="'+i+'"]');if(a&&a.length&&a.hasClass("msg-voice")){var o=Math.max(n.duration,0);if(a.removeClass("msg-voice--recording"),"success"===t?(a.find(".bubble").css("width",Zt.computeVoiceLength(o)+"px"),a.find(".duration").text(o+'"')):a.find(".duration").text(""),"success"===t){var s=ft.receptionist.kfUin,r=ft.receptionist.visitorId,c=n.date,l=7,d="kf"+s+"vId"+r+"index"+c+l;if(Ct.get(d))try{var f=Ct.get(d);f=JSON.parse(f),f.data.duration=o,Ct.set(d,JSON.stringify(f))}catch(u){BJ_REPORT.report("update voice msg duration error")}}Zt.bindEvent(a,e)}},bindEvent:function(e,t){var i=e.find(".bubble");i.on("tap",function(i){return i.target&&"i"===i.target.nodeName.toLowerCase()||i.target&&$(i.target).hasClass("tip")?void 0:e.hasClass("msg-voice--expired")?void p({text:"语音已过期"},1500):void Zt.tapBubbleThrottle(function(){var i=void 0;e.hasClass("msg-voice--playing")?(i=e.data("localid"),i&&Zt.stopVoice(e,i)):(i=e.attr("data-localid"),i?Zt.playVoice(e,i):Zt.downloadVoice(t.data.mediaId).then(function(t){Zt.playVoice(e,t.localId)},function(t){p({text:t.errMsg},1500),v(e)}))},500)()}),i.on("longTap",function(i){e.find(".bubble--translate").length||(e.addClass("msg-voice--tapping"),e.find(".tip").off("tap").on("tap",function(){var i=t.data||{};if(i.isTranslate)i.content?e.append('<div class="bubble--translate">'+t.data.content+'<div class="translate-tip">转换完成</div></div>'):q("fail",!0);else if(i.mediaId){var n=e.attr("data-localid"),a=$('<div class="bubble--translate"><i class="loading loading-s"></i></div>');e.append(a),n?Zt.translateVoice(n).then(function(e){a.html(e.translateResult+'<div class="translate-tip">转换完成</div>')},function(){a.remove(),q("fail",!0)}):Zt.downloadVoice(i.mediaId).then(function(t){e.attr("data-localid",t.localId),Zt.translateVoice(t.localId).then(function(e){a.html(e.translateResult+'<div class="translate-tip">转换完成</div>')},function(){a.remove(),q("fail",!0)})},function(){a.remove(),q("fail",!0)})}else q("fail",!0);e.removeClass("msg-voice--tapping").addClass("msg-voice--translating")}))}),i.on("contextmenu",function(e){e.preventDefault()}),Yt||(pt.chatBody.on("tap",function(){pt.chatListWrap.find(".msg-voice").removeClass("msg-voice--tapping")}),Yt=!0)},tapBubbleThrottle:function(e){function t(){var t=+new Date;t>=a+i?(e(),a=t):(n&&(clearTimeout(n),n=null),n=setTimeout(function(){e()},i))}var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=null,a=0;return t},playVoice:function(e,t){wx&&wx.onVoicePlayEnd({complete:function(i){i.localId==t&&v(e)}}),wx&&wx.playVoice({localId:t,success:function(){Xt="play",pt.chatList.find(".msg-voice").removeClass("msg-voice--playing"),e.addClass("msg-voice--playing").attr("data-localid",t)},fail:function(t){p({text:t.errMsg},1500),v(e)}})},stopVoice:function(e,t){"play"===Xt?wx&&wx.stopVoice({localId:t,success:function(){v(e)},fail:function(t){t&&"stopVoice:not playing"===t.errMsg?v(e):p({text:t.errMsg},1500)}}):v(e)},downloadVoice:function(e){var t=$.Deferred();return Xt="download",wx&&wx.downloadVoice({serverId:e,isShowProgressTips:0,success:function(e){t.resolve(e)},fail:function(e){t.reject(e)}}),t.promise()},translateVoice:function(e){var t=$.Deferred();return wx&&wx.translateVoice({localId:e,isShowProgressTips:0,success:function(e){e.translateResult?t.resolve(e):t.reject(e)},fail:function(e){t.reject(e)}}),t.promise()}},ei=function(e){var t=[],i=+new Date,n="log_"+i,a=t[n]=new Image;return a.onload=a.onerror=function(){t[n]=null},e+=(e.indexOf("?")>-1?"&":"?")+i,a.src=e,arguments},ti=function(e){var t="https://fereport.qidian.qq.com/report/webim?",i=t+$.param($.extend({},e,{visitorid:ft.receptionist.visitorId,kfuin:ft.receptionist.kfUin,tid:1000001,count:1}));ei(i)},ii=function(){function e(e,t,i){var n={},a=0,o=0;$.ajax({url:dt.CGI_URL.GET_MENU_URL+"?kfuin="+ft.receptionist.kfUin,data:e,type:"POST",timeout:3e3,dataType:"json",error:function(t,n,a){i.trigger("fail",{textStatus:n,errorThrown:a,queryData:e})},beforeSend:function(){o=+new Date},complete:function(){ti({type:5,requestConsumTime:+new Date-o,clickid:ft.getSigTData.clickid,addon:JSON.stringify({menuKey:e.navKey})})},success:function(e){0!=e.r?i.trigger("fail",e):($.extend(n,{config:e.data.navSet.config,eLogo:e.data.eLogo||dt.CGI_URL.COMP_SOURCE_URL+"img/default-logo.png",eName:e.data.eName,version:e.data.version},e.data.navSet.content),$.extend(c,{currentVersion:parseInt(n.version),eLogo:n.eLogo,eName:n.eName}),"undefined"!=typeof n["default"].action&&(a=parseInt(n["default"].manualType),$.extend(c.defaultConfig,{active:parseInt(n["default"].action),roleValue:a,roleData:0===a||4===a?parseInt(n["default"].serviceKfext):parseInt(n["default"].groupId)}),ft.isRealSendMsg=c.defaultConfig.active,0==ft.isRealSendMsg&&(ft.c2bSeqGroup=[],pt.chatListWrap.find(".msg-c2b i").removeClass("loading loading-s"),Dt.clearCache()),c.defaultConfig.active&&($.extend(ft.getSigTData,{roleValue:c.defaultConfig.roleValue,roleData:c.defaultConfig.roleData}),ft.ioLinkStatus="over")),$.extend(ft.menuDetail,c),l.msg(n,i),Dt.getMsgCacheList().length&&S("c2b",{type:-1}))}})}function i(e){var t=dt.CGI_URL.COMMON_REQ_RPT+"?kfuin="+s.kfUin,e=$.extend({},{data:e},{kfuin:s.kfUin,visitorid:s.visitorId,action:e.action||(e.replyType?parseInt(e.replyType)+1:1)});$.ajax({url:t,data:e,type:"POST",timeout:1e3,dataType:"json",error:function(e,t,i){BJ_REPORT.report("Menu ActRpt Error")},success:function(e){0!=e.r&&BJ_REPORT.report("Menu ActRpt Error")}})}function o(e){var t,n=e,a={};n.delegate("a","click",function(e){e.preventDefault(),t=$(e.currentTarget);var o=t.parent().parent(),r=o.children().eq(0),l=o.children().eq(1),d=r.find("i"),f=n.data("openIndex")||0,u=o.index(),p=+new Date+ft.serverClientTimeDiff,g=t.closest(".menu-action").length>0?3:1;switch(g=3!=g&&t.closest(".nav-bd").length>0?2:g,a={action:parseInt(t.data("action")),type:t.data("replytype"),data:t.data("replydata")},f&&u!=f&&t.closest(".nav-hd").length&&(ft.isMobile?n.find(".nav-item").eq(f-1).children().eq(1).css("height",0).prev().find("i").removeClass("up").addClass("down"):n.find(".nav-item").eq(f-1).children().eq(1).slideUp("fast").end().find("i").removeClass("icon-arrow-up").addClass("icon-arrow-down")),a.action){case 1:Ai.normal.render("b2c",{avatar:c.eLogo,name:c.eName,data:a.data,date:p,type:3===a.type?5:a.type,isNavGet:3===a.type?!0:!1,sortseq:p},"autoReply",!0,{act:"append",singleSeqs:p+""+(3===a.type?5:a.type)},!1,!0);break;case 2:_(a.data);break;case 3:ft.inRegProcess||($.extend(ft.getSigTData,{kfuin:s.kfUin,roleValue:a.type,roleData:a.data,NavClick:{menuname:t.text(),menutp:g}}),delete ft.wpaDetail.extUin,$("body").removeClass("regsuccess").addClass("reconnect"),de(ft.getSigTData,null,null,!0));break;case 4:ft.isMobile?"0px"==l.css("height")?(n.data("openIndex",u),d.addClass("up"),l.css("height",46*l.find("li").length+"px")):(n.removeData("openIndex"),d.removeClass("up"),l.css("height","0px")):(l.css("display")&&"none"!=l.css("display")?(d.removeClass("icon-arrow-up").addClass("icon-arrow-down"),n.removeData("openIndex")):(d.removeClass("icon-arrow-down").addClass("icon-arrow-up"),n.data("openIndex",u)),l.slideToggle("fast"));break;default:BJ_REPORT.report("Menu Action Type Error"+a.action)}var m={menuname:t.text(),menutp:g},h=t.attr("data-origin-replytype");"1"===h?(m.replyType=h,m.replyText=t.data("origin-replytext")):"2"===h&&(m.replyType=h,m.materialId=t.data("origin-materialid")),a.action&&i(m)}),n.on("expired",function(){$(this).attr("data-oldver",1).addClass("menu-expired").children().append(f(dt.CHAT_MSG_TPL.menuMsgExpired))})}var s=ft.receptionist,r=ft.wpaDetail,c=ft.menuDetail,l=(ft.inRegProcess,ft.chatSocket,{start:function(t,i){var n={visitorId:s.visitorId,wpaId:r.wpaId,kfuin:s.kfUin,navKey:t.menuKey},o={loading:$.i18n(dt.VIEW_OPTS.MENU_MSG.LOADING),fail:$.i18n(dt.VIEW_OPTS.MENU_MSG.FAIL)},c=e;t.isNewNav&&(a({type:"msgExpired",act:"new"}),this.expired()),this.load(null,n,o,c)},load:function(e,i,n,a){var o=$(St(dt.CHAT_MSG_TPL.msgLoad.loading,n.loading)),s=$('[data-guid="'+e+'"]').prev();o.data("queryData",i),e?o.insertBefore(s):pt.chatListWrap.find(".tencent-certification").before(o),s=o,o.on("fail",function(e,r){o.html(St(dt.CHAT_MSG_TPL.msgLoad.getMsg,n.fail)).find(".btn-load-msg").one(ft.clickName,function(){o.trigger("loading"),a&&a(i,s,o)}),t(),BJ_REPORT.report("Menu GetData Error"),BJ_REPORT.report(JSON.stringify(r))}).on("loading",function(){o.html(St(dt.CHAT_MSG_TPL.msgLoad.loading,n.loading))}).on("success",function(){o.remove()}).on("over",function(){o.html(St(dt.CHAT_MSG_TPL.msgLoad.overTip,n.over))}),a&&a(i,s,o)},expired:function(){pt.chatListWrap.find('.mod-menu[data-oldver="0"]').each(function(){$(this).trigger("expired")})},msg:function(e,i){var a=0;e.button&&(a=(100/e.button.length).toFixed(2),$.extend(e,{buttonWidth:a})),Nt.saveMsg("b2c",{data:e,type:3,date:ft.receptionist.time,sortseq:ft.receptionist.time},{act:"append",singleSeqs:ft.receptionist.time+"3"}),$.extend(e,{isMobile:ft.isMobile,currentVersion:c.currentVersion,guid:n(dt.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP)}),C(ft.receptionist.time),pt.chatListWrap.find(".tencent-certification").before($.tmpl(dt.CHAT_MSG_TPL.menuMsgNormal,e,f)),i.trigger("success"),t(),o($('[data-guid="'+e.guid+'"]'))}});return{render:l,bindEvents:o,actRpt:i}},ni=new RegExp("((?:(http|https|Http|Https|rtsp|Rtsp):\\/\\/(?:(?:[a-zA-Z0-9\\$\\-\\_\\.\\+\\!\\*\\'\\(\\)\\,\\;\\?\\&\\=]|(?:\\%[a-fA-F0-9]{2})){1,64}(?:\\:(?:[a-zA-Z0-9\\$\\-\\_\\.\\+\\!\\*\\'\\(\\)\\,\\;\\?\\&\\=]|(?:\\%[a-fA-F0-9]{2})){1,25})?\\@)?)?((?:(?:[a-zA-Z0-9][a-zA-Z0-9\\-]{0,64}\\.)+(?:(?:aero|arpa|asia|a[cdefgilmnoqrstuwxz])|(?:biz|b[abdefghijmnorstvwyz])|(?:cat|com|coop|club|c[acdfghiklmnoruvxyz])|d[ejkmoz]|(?:edu|e[cegrstu])|fun|f[ijkmor]|group|(?:gov|g[abdefghilmnpqrstuwy])|h[kmnrtu]|(?:info|int|ink|i[delmnoqrst])|(?:jobs|j[emop])|kim|k[eghimnrwyz]|ltd|link|l[abcikrstuvy]|(?:mil|mobi|museum|m[acdghklmnopqrstuvwxyz])|(?:name|net|n[acefgilopruz])|(?:org|online|om)|(?:pro|p[aefghklmnrstwy])|qa|red|ren|r[eouw]|store|site|shop|s[abcdeghijklmnortuvyz]|(?:tel|travel|top|tech|t[cdfghjklmnoprtvwz])|u[agkmsyz]|vip|v[aceginu]|xin|xyz|wang|work|w[fs]|y[etu]|z[amw]))|(?:(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9])\\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9]|0)\\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9]|0)\\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[0-9])))(?:\\:\\d{1,5})?)(\\/(?:(?:[a-zA-Z0-9\\;\\/\\?\\:\\@\\&\\=\\#\\~\\-\\.\\+\\!\\*\\'\\(\\)\\,\\_])|(?:\\%[a-fA-F0-9]{2}))*)?(?:\\b|$)","gi"),ai=function(e,t,i){var n=t||"http(s)?",a=i||"http://",o=new RegExp("^("+n+"):\\/\\/","gi");return e.match(o)?e:a+e},oi={get:function(e){var t="kf"+e.kfUin+"vId"+e.visitorId+"red",i=JSON.parse(Ct.get(t)),n="wId"+e.wpaId,a={};return i&&i.forEach(function(e){e[n]&&(a=e[n])}),a},set:function(e,t,i){var n,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:!0,o="kf"+e.kfUin+"vId"+e.visitorId+"red",t="wId"+t,s=JSON.parse(Ct.get(o)),r=!1,c={name:e.name,number:1},l={},d=c.number;s?(s.forEach(function(i){for(n in i)n==t&&(r=!0,d=i[n].number+1,i[n].number=d,i[n].name=e.name)}),r||(l[t]=c,s.push(l)),a&&Ct.set(o,JSON.stringify(s))):(l[t]=c,Ct.set(o,JSON.stringify([l]))),!ft.isMobile&&oi.render("update",d),i&&i(d)},reset:function(e){var t,i="kf"+e.kfUin+"vId"+e.visitorId+"red",n=JSON.parse(Ct.get(i)),a=[];n&&(n.forEach(function(e){for(t in e){var i={};i[t]={number:0},a.push(i)}}),Ct.set(i,JSON.stringify(a)))},render:function(e,t,i){var n={page:$(".page"),unReadMsgNum:$(".unread-msg-num")},a=n.unReadMsgNum.parent().find(".name"),o=n.unReadMsgNum.parent().find(".status");0!=t&&("update"==e?(n.unReadMsgNum.hasClass("hidden")&&n.unReadMsgNum.removeClass("hidden"),n.unReadMsgNum.text(t>9?"9+":t)):"reset"==e&&n.unReadMsgNum.addClass("hidden").text(""),i&&(n.page.removeClass("page-inframe").addClass("page-minify"),a.text(i.name),o.text(i.status)))}},si=function(e){"undefined"!=typeof e.c_info&&$.extend(ft.receptionist,{corpName:e.c_info.name||"",corpAvatar:e.c_info.face||ft.defaultAvatar}),$.extend(ft.receptionist,{extUin:e.u_info.uin,name:e.u_info.name,avatar:e.u_info.face||ft.defaultAvatar,resign:e.u_info.position,qq:e.u_info.qq,isRobot:e.u_info.isCommonRobot,time:e.date});var t=ft.externalType=e.externalType||2,i="undefined"==typeof e.u_info.type?"default":e.u_info.type;2!=t||"default"!==i||ft.isMobile||ft.isInIframe||x()},ri=function(e){this.options={command:"copy",events:{}};return $.extend(!0,this.options,e),"undefined"==typeof e.data?void this.fail(0):void this.execCopy()};ri.prototype.isSupport=function(){var e=!!document.queryCommandSupported;return e=e&&!!document.queryCommandSupported(this.options.command)},ri.prototype.createElement=function(){var e=+new Date,t="clipboard-target-"+e;return $("body").append('<span class="'+t+'" style="position:absolute;z-index:-1;font-size:0;"></span>'),$("."+t)},ri.prototype.destoryElement=function(e){e&&e.remove()},ri.prototype.fail=function(e,t){this.options.events.fail&&this.options.events.fail(e,t)},ri.prototype.selectText=function(e){var t,i=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),i.removeAllRanges(),i.addRange(n),t=i.toString()},ri.prototype.execCopy=function(){var e,t,i=this.isSupport();if(i){if(e=this.createElement(),e.html(this.options.data),t=this.selectText(e.get(0)),0==t.length)return void(this.options.events.fail&&this.options.events.fail(1));try{document.execCommand(this.options.command),this.options.events.success&&this.options.events.success()}catch(n){this.options.events.fail&&this.options.events.fail(3,n)}this.destoryElement(e)}else this.options.events.fail&&this.options.events.fail(2)};var ci={waitRetDelayTime:15e3,waitRetQueue:{},waitRetManage:{add:function(e){var t="kfAccount"+e.kfAccount;ci.waitRetQueue[t]=setTimeout(function(){ci.renderRet({ret:"fail",kfAccount:e.qqNumForPaste}),ci.waitRetManage.destory(e)},ci.waitRetDelayTime)},remove:function(e){var t="kfAccount"+e.kfAccount;ci.waitRetQueue.hasOwnProperty(t)&&clearTimeout(ci.waitRetQueue[t]),ci.waitRetManage.destory(e)},destory:function(e){var t="kfAccount"+e.kfAccount;ci.waitRetQueue.hasOwnProperty(t)&&delete ci.waitRetQueue[t]}},getData:function(e,t){var i=$(t.target).parents(".content").find("dd a").html();p({text:$.i18n("chat_add_friend_fetching_protocol_msg")},500),
$.ajax({url:dt.CGI_URL.GET_ADD_FRIEND_SCHEME,data:{kfext:ft.receptionist.extUin,kfuin:ft.receptionist.kfUin,visitorId:ft.receptionist.visitorId,ftype:ft.isMobile,kfaccount:e,clickid:ct()},type:"GET",timeout:2e3,dataType:"jsonp",jsonp:"cb",error:function(){ci.renderRet({ret:"fail",kfAccount:i}),BJ_REPORT&&BJ_REPORT.report("GET ADD FRIEND SCHEME ERROR")},success:function(e){var t,n=e.r;0==n&&"undefined"!=typeof e.data.sign?(t=e.data.sign,Wt(t)):(ci.renderRet({ret:"fail",extUin:i}),BJ_REPORT&&BJ_REPORT.report("GET ADD FRIEND SCHEME RES ERROR: "+JSON.stringify(e)))}})},renderRet:function(e){var t=+new Date,i=e.kfAccount;"undefined"!=typeof e.originData&&ft.chatSocket.emitMsg(dt.SOCKET_CMD.SESSION_MSG.EMIT,{csrf:e.originData.csrf,seq:e.originData.seq,type:e.originData.type,time:e.originData.time}),"fail"==e.ret?(a({type:"addFriendFail",act:"new",seq:t}),$('[data-guid="'+t+'"]').find(".btn-paste").on("click",function(){new ri({data:i,events:{success:function(){p({text:$.i18n("chat_add_friend_copy_success_msg")},1e3)},fail:function(e,t){var i;switch(e){case 0:i=$.i18n("chat_add_friend_fail_text")+": "+$.i18n("chat_add_friend_fail_get_number_fail_text");break;case 1:i=$.i18n("chat_add_friend_fail_text")+": "+$.i18n("chat_add_friend_fail_no_text_selected_text");break;case 2:i=$.i18n("chat_add_friend_fail_text")+": "+$.i18n("chat_add_friend_fail_browser_not_support_text");break;default:i=$.i18n("chat_add_friend_fail_text")+": "+t}p({text:i},1e3)}}})})):ci.waitRetManage.remove({kfAccount:i})}},li={sendAck:function(e){ft.chatSocket.emitMsg(dt.SOCKET_CMD.SESSION_MSG.EMIT,{csrf:e.csrf,seq:e.seq,type:e.type,time:e.time})},render:function(e,t,i){var a,o=e.sortseq||e.time,s=e.data,r=i.msgName||e.data.msgName,l=i.isNeedStore?"msg":"welcome",d="undefined"!=typeof i.isFromHistory?i.isFromHistory:!1,f=i.isNeedStore?!1:!0,u=d?{act:"prepend",singleSeqs:o+"4"}:{act:"append",singleSeqs:o+"4"},p=kt.setType(o,4);if(i.isNeedAck&&li.sendAck(e),a=i.isNeedWrap?$.tmpl.joinTpl(dt.CHAT_MSG_TPL[t+"Wrap"],"msgContent",dt.RICH_MSG_TPL[s.type]):dt.RICH_MSG_TPL[s.type],$.extend(s,{msgName:r,msgType:"msg-rich",isNeedWrap:i.isNeedWrap,tpl:a,seq:o}),i.isNeedStore&&(f=c(p),u=h(p)),f){if(Ai.normal.render(t,{data:s,seq:n(dt.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),type:4,wordMsgSeq:n(dt.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC),date:o,sortseq:o},l,!0,u,!1),"addfriend"==r){var g=$('[data-guid="'+o+'"]').find("h2.title");g.text($.i18n("common_add_qq_friend_text")),!ft.isMobile&&g.prepend('<i class="icon-qq"></i>')}li.bindEvent(o,s)}},bindEvent:function(e,t){$('[data-guid="'+e+'"]').delegate("a","click",function(e){var i=$(e.currentTarget),a=i.attr("action"),o=i.attr("url"),s=i.attr("actionData"),r=n(dt.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP);switch(e.preventDefault(),a){case"web":_(o);break;case"msg":$.extend(t,{tpl:$.tmpl.joinTpl(dt.CHAT_MSG_TPL[s+"Wrap"],"msgContent",dt.RICH_MSG_TPL[t.type]),seq:r}),0==t.type&&$.extend(t,{isNeedWrap:!0}),Ai.normal.render(s,{data:t,seq:r,type:4,wordMsgSeq:n(dt.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC),date:+new Date+ft.serverClientTimeDiff},"msg",!0),0==t.type&&li.bindEvent(r,t);break;case"addFriend":ci.getData(s,e);break;default:BJ_REPORT.report("RichMsg Action Error"+a)}})}},di=2,fi={render:function(e,t){var i;return e.isNavGet?(fi.download(e),null):(t.isFromHistory||(e=fi._processData(e)),i=$($.tmpl(e.tpl,e,f)),i&&fi._bindEvent(i,e),i)},download:function(e){return $.ajax({url:dt.CGI_URL.GET_GRAPHIC_MSG,data:{materialId:e.data,kfuin:ft.receptionist.kfUin},type:"POST",timeout:3e3,dataType:"json",error:function(t,i,o){a({type:"graphicMsgFail",seq:n(e.sortseq),act:"new"})},success:function(t){if(0!=t.r)return null;var i=kt.setType(e.sortseq,e.type),n=h(i);$.extend(e,{data:t.data,method:"",seq:i,isNavGet:!1}),Ai.normal.render("b2c",e,"msg",null,n,!1,!1)}}),e},_processData:function(e){var t=[],i={},n=!0;return e.data=JSON.parse(e.data),e.data&&e.data.item&&(e.data.item=e.data.item.filter(function(e){return!e[0]&&!e.more})),n=e.data.item&&1==e.data.item.length,e.data.item&&e.data.item.forEach(function(a,o){a.title&&(i.title=a.title),a.picture&&a.picture["@attributes"].cover&&(i.cover=a.picture["@attributes"].cover),n?(a.summary&&(i.summary=a.summary[1],i.date=a.summary[0]),i.url=e.data["@attributes"].url):i.url=a["@attributes"].url,t.push(i),i={}}),$.extend(e,{data:t,msgType:"msg-graphic",simple:n}),e.tpl=$.tmpl.joinTpl(dt.CHAT_MSG_TPL.b2cWrap,"msgContent",dt.RICH_MSG_TPL[di][n?"simple":"multiple"]),e},_bindEvent:function(e,t){e.delegate(t.simple?".content.simple":".thumb",ft.isMobile?"tap":"click",function(e){var t=$(e.currentTarget),i=t.attr("action"),n=t.attr("actionData");switch(e.preventDefault(),i){case"web":_(n);break;default:BJ_REPORT.report(" Action Error"+i)}})},_getImgSize:function(e,t){var i=new Image;i.src=e,i.complete?t(i.width,i.height):i.onload=function(){t(i.width,i.height)}}},ui={key:"message",sendc2b:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.dom;a&&a.on(ft.clickName,function(a){a.preventDefault();var o={type:1,data:e.content,date:+new Date+ft.serverClientTimeDiff,seq:n(dt.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),wordMsgSeq:n(dt.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC)};Ai.normal.render("c2b",o),setTimeout(function(){i.isScrollBottom&&t()},200)})}},pi=!1,gi=["startRecord","stopRecord","onVoiceRecordEnd","playVoice","pauseVoice","stopVoice","onVoicePlayEnd","uploadVoice","downloadVoice","translateVoice"],mi={key:"launch",miniprogram:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},this),i=e.dom,n=window.wx;n&&n.miniProgram?this.bindEvents(i,e):O(function(){t.bindEvents(i,e)})},bindEvents:function(e,t){e&&e.on(ft.clickName,function(e){e.preventDefault(),t.url&&(t.url=decodeURIComponent(t.url)),wx.miniProgram[t["interface"]]&&wx.miniProgram[t["interface"]](t)})}},_i=/qdweb:\/\//,hi=3,vi={};vi[ui.key]=ui,vi[mi.key]=mi;var qi={inject:function(e,t){for(var i=this,n=e.find("a"),a=0,o=n.length;o>a;a++){var s=n.eq(a),r=s.attr("href");_i.test(r)&&!function(){var e=r.replace(_i,""),n=[],a=[],o={dom:s},c=e.split("?");if(n=c[0].split("/"),c.length>1&&(a=c[1].split("&"),a.forEach(function(e){var t=e.split("=");t.length>1?o[t[0]]=t[1]:o[t[0]]=!0})),n.length>=hi){var l=n,d=_t(l,3),f=d[0],u=d[1],p=d[2];i.invoke({namespace:f,action:u,method:p,params:o,options:t})}}()}},invoke:function(e){var t=e.namespace,i=e.action,n=e.method,a=e.params,o=e.options;"webim"===t&&vi[i]&&vi[i][n]&&vi[i][n]&&vi[i][n](a,o)}},yi=5,bi={render:function(e){var t=e.sortseq||e.time,i=e.data,n=$.tmpl.joinTpl(dt.CHAT_MSG_TPL.b2cWrap,"msgContent",dt.RICH_MSG_TPL[yi]);$.extend(i,{name:e.name,avatar:e.avatar,msgName:"msg-html",tpl:n,seq:t});var a=$($.tmpl(i.tpl,i)),o=i.content;return o=o.replace(/<meta.*?>/gi,""),o=o.replace(/<title>.*?<\/title>/gi,""),o=o.replace(/<style.*?>.*?<\/style>/gi,""),a.find(".html-content").html(o||""),qi.inject(a,{isScrollBottom:!0}),a}},Si={init:function(e){e=e||{};var t=e.type;switch(t){case"robotSatisfaction":this.initRobotSatisfaction(e)}},initRobotSatisfaction:function(e){var t=e.msgData,i=e.$el;if(5!==t.type||!t.data||2!==t.data.type){var n=t.date||t.time,a=t&&t.vote&&t.vote.expiredIntervalTime;t.vote&&Date.now()+ft.serverClientTimeDiff-n<a&&this.renderRobotSatisfaction(i,t)}},renderRobotSatisfaction:function(e,t){var i=t.vote||{},n=$('<div class="b2c-content-tails" data-id="'+i.id+'"></div>'),a="";if(i.active)a='<span class="b2c-content-tails-icon active b2c-content-tails-icon-'+i.active+'"><span class="b2c-content-tails-hand"></span></span>';else for(var o=i.button||[],s=0;s<o.length;s++){var r=o[s].key;~["up","down"].indexOf(r)&&(a+='<span data-key="'+r+'" class="b2c-content-tails-icon b2c-content-tails-icon-'+r+'"><span class="b2c-content-tails-hand"></span></span>')}n.append(a),e.find(".bubble").append(n),this.bindEventRobotSatisfaction(e,t)},bindEventRobotSatisfaction:function(e,t){var i=this,n=e.find(".b2c-content-tails"),a=t.sortseq+""+t.type,o=ft.receptionist,s="kf"+o.kfUin+"vId"+o.visitorId+"index"+a,r=!1;n.on("click",".b2c-content-tails-icon",function(n){if(n.preventDefault(),!(r||$(this).hasClass("active")||$(this).hasClass("flash"))){r=!0;var a=$(this).attr("data-key"),c="up"===a?"1":"0",l=t&&t.vote&&t.vote.robotId,d=new FormData;d.append("kfuin",o.kfUin),d.append("visitid",o.visitorId),d.append("robotid",l),d.append("seq",t.seq),d.append("type",c),$.ajax({url:dt.CGI_URL.ROBOT_SATISFACTION_REPORT+"?kfuin="+o.kfUin,data:d,type:"POST",processData:!1,contentType:!1,error:function(){r=!1},success:function(t){r=!1,0==t.r?i.robotSatisfactionCb({$el:e,localStorageKey:s,key:a}):BJ_REPORT.report("RobotSatisfaction report fail: "+t.message+s)}})}})},robotSatisfactionCb:function(e){var t=e.$el,i=e.key,n=e.localStorageKey,a=t.find('.b2c-content-tails-icon[data-key="'+i+'"]');a.addClass("flash"),setTimeout(function(){a.removeClass("flash").addClass("active").siblings().remove()},300);var o=JSON.parse(Ct.get(n));o&&(o.vote.active=i,Ct.set(n,JSON.stringify(o)))}},Ti=4,wi={render:function(e,t){var i,n=e.sortseq||e.time,a=$.tmpl.joinTpl(dt.CHAT_MSG_TPL.b2cWrap,"msgContent",dt.RICH_MSG_TPL[Ti]);return $.extend(e,{msgType:"msg-coupon",tpl:a,seq:n}),e&&e.data&&(e.data.url=decodeURIComponent(e.data.url)),i=$($.tmpl(e.tpl,e)),wi._bindEvent(i),i},_bindEvent:function(e){e.delegate(".content.coupon","click",function(e){var t=$(e.currentTarget),i=t.attr("action"),n=t.attr("url")||"https://oawpa.qidian.qq.com/coupon/deliver?corpUin=2852199351&ticket=Q2JLdU51QzNNaG10SUFaRGI3RXBxZz09&appid=200860315&platform=4";switch(i){case"web":wi._createIframe(n);break;default:BJ_REPORT.report("QlistMsg Action Error: "+i)}})},_createIframe:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://qidian.qq.com/",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:373,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:600,n=t,a=i,o=$("<iframe width='"+n+"' height='"+a+"' id='coupon-iframe' name='coupon-iframe' style='position:absolute;z-index:12;'  frameborder='no' marginheight='0' marginwidth='0' allowTransparency='true'>                        </iframe>"),s=$("<div id='iframe-close' style='position:absolute;z-index:13;color:#FFF;'>                                <span style='display:inline-block;width:14px;border-top:0.5px solid #FFF;transform:rotate(45deg);vertical-align:middle;'></span>                                <span style='display:inline-block;width:14px;border-top:0.5px solid #FFF;transform:rotate(-45deg);position:relative;right:18px;vertical-align:middle;'></span>                            </div>"),r=$("<div id='coupon-iframeBg' style='background-color: White;display:block;z-index:11;position:absolute;left:0px;top:0px;filter:Alpha(Opacity=0);/* IE */-moz-opacity:0;/* Moz + FF */opacity: 0; '/>");o.prependTo("body"),s.prependTo("body"),r.prependTo("body");var c=document.documentElement.scrollTop||document.body.scrollTop,l=document.documentElement.scrollLeft||document.body.scrollLeft,d=document.documentElement.clientHeight,f=document.documentElement.clientWidth,u=o.height(),p=o.width(),g=Number(c)+(Number(d)-Number(u))/2,m=Number(l)+(Number(f)-Number(p))/2;o.css("left",m),o.css("top",g),s.css("left",m+355),s.css("top",g+10),o.css("background","#FFF"),o.css("border","solid 1px #dadee6").css("overflow","hidden"),o.css("border-radius","4px"),s.on("click",function(){$("#coupon-iframe").remove(),o.remove(),r.remove(),s.remove(),o=null,r=null,s=null}),ft.isMobile||s.hover(function(){s.css("cursor","pointer")}),o.attr("src",e);var _=Math.max($("body").width(),f),h=Math.max($("body").height(),d);r.css({width:_,height:h})}},Ci='\n<div class="qlist-content">\n    <div class="qlist-title"><%= o.title %></div>\n    <div class="qlist-list">listContent</div>\n</div>\n ',ki=/<a.*?>.*?<\/a>/g,xi={renderMsg:function(e){var t=this.parseMsg(e&&e.data&&e.data.content),i=$.extend(t,{name:e.name,avatar:e.avatar,msgName:"msg-robot-qlist",seq:e.sortseq||e.time}),n=$.tmpl.joinTpl($.tmpl(Ci,i),"listContent",t.list.join("")),a=$.tmpl.joinTpl(dt.CHAT_MSG_TPL.b2cWrap,"msgContent",n),o=$($.tmpl(a,i));return this.bindEvents(o),o},parseMsg:function(e){for(var t={title:"",list:[]},i=0,n=null;n=ki.exec(e);)0===i&&(i=n.index),t.list.push(n[0]);return i&&(t.title=e.slice(0,i)),t},bindEvents:function(e){qi.inject(e,{isScrollBottom:!0})}},Ei=5,Ri={render:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.sortseq||e.time,n=e.data,a=n.content||"",o=n.msgType||1,s=$.tmpl.joinTpl(dt.CHAT_MSG_TPL.b2cWrap,"msgContent",dt.RICH_MSG_TPL[Ei]);if(1===o){$.extend(n,{name:e.name,avatar:e.avatar,msgName:"msg-free",tpl:s,seq:i});var r=$($.tmpl(n.tpl,n));return a=Ri.htmlEncode(a),a=Ri.replaceWrap(a),a=Ri.replaceUrl(a),r.find(".html-content").html(a||""),t.isGoBot&&Ri.checkImgLoad(r),Ri.viewLargeImg(r),qi.inject(r,{isScrollBottom:!0}),r}return 2===o||3===o?xi.renderMsg(e):void 0},checkImgLoad:function(e){var i,n,a=e.find(".html-content img"),o=a.length,s=0;for(i=0;o>i;i++)n=a.eq(i),n.load(function(){s++,s===o&&t()})},viewLargeImg:function(e){var t,i,n,a=e.find(".html-content img"),o=a.length;for(i=0;o>i;i++)t=a.eq(i),n=t.attr("src"),ft.isMobile?t.off("tap").on("tap",function(){k(function(e){e.append('<img class="big-image" src="'+n+'"/>'),e.on("touchend",function(t){e.remove()})})}):t.off("click").on("click",function(){ft.isInIframe?yt.send({act:"OPEN_IMG",data:{url:n}}):k(function(e){e.append('<div class="img-wrap"><img class="" src=""/><a href="javascript:;" class="btn-close"></a></div>'),D(e,n),e.on("click","a.btn-close",function(t){t.preventDefault(),e.remove()})})})},replaceUrl:function(e){var t=void 0,i=[],n=[];return t=Ri.keepImgTag(e),e=t.content,i=t.imgList,t=Ri.keepLinkTag(e),e=t.content,n=t.linkList,e=e.replace(ni,function(e){return'<a href="'+ai(e)+'" target="_blank" class="text-link">'+e+"</a>"}),e=Ri.resetImgTag(i,e),e=Ri.resetLinkTag(n,e)},replaceWrap:function(e){return e.replace(/\r\n/g,"<br/>").replace(/\n/g,"<br/>")},htmlEncode:function(e){var t=void 0,i=[],n=[];return t=Ri.keepImgTag(e),e=t.content,i=t.imgList,t=Ri.keepLinkTag(e),e=t.content,n=t.linkList,e=e.replace(/[<>'"&]/g,function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39"}}),e=Ri.resetImgTag(i,e),e=Ri.resetLinkTag(n,e),e=e.replace(/&amp;nbsp;/g,"&nbsp;")},keepImgTag:function(e){var t=/<img[^>]*src=['"]([^'"]+)['"][^>]*>/gi,i=e.match(t)||[],n=0;return e=e.replace(t,function(){return n++,"$$$img"+n+"$$$"}),{content:e,imgList:i}},resetImgTag:function(e,t){for(var i=0,n=e.length;n>i;i++)t=t.replace("$$$img"+(i+1)+"$$$",e[i]);return t},keepLinkTag:function(e){var t=/<a.*?>.*?<\/a>/gi,i=e.match(t)||[],n=0;return e=e.replace(t,function(){return n++,"$$$link"+n+"$$$"}),{content:e,linkList:i}},resetLinkTag:function(e,t){for(var i=0,n=e.length;n>i;i++)t=t.replace("$$$link"+(i+1)+"$$$",e[i]);return t}},Ii='\n <div class="msg-b2c msg-robotnav">\n    <div class="nav-content">\n        <div class="nav-title"><%= o.tit %></div>\n        <div class="nav-list">\n            <%for(var i = 0, len = o.list.length; i < len; i++){%>\n            <div class="nav-item"><a class="nav-link" href="qdweb://webim/message/sendc2b?content=<%= o.list[i].name %>"><%= o.list[i].name %></a></div>\n            <%}%>\n        </div>\n    </div>\n </div>\n ',Oi={renderMsg:function(e){var t=$($.tmpl(Ii,e.data.robotNav));return this.bindEvents(t),t},bindEvents:function(e){qi.inject(e,{isScrollBottom:!0})}},$i=function(e){var t={title:document.title,message:"common_new_message_text",dynamicTitle:!1,interval:200};this.opts=$.extend({},t,e),this.opts.dynamicTitle&&delete this.opts.title};$i.prototype={changeTitle:function(){document.title=this.opts.title===document.title?$.i18n(this.opts.message):this.opts.title},addTimer:function(){var e=this;return"undefined"==typeof this.timer&&(this.timer=setInterval(function(){e.changeTitle()},this.opts.interval)),this},clearTimer:function(){return this.timer&&(clearInterval(this.timer),delete this.timer,document.title=this.opts.title),this},setTitle:function(){return this.opts.dynamicTitle&&"undefined"==typeof this.opts.title&&(this.opts.title=document.title),this},twinkling:function(){this.setTitle().addTimer()}};var Pi=function(e,t){var i=null;return function(){i||(i=setTimeout(function(){e(),i=null},t))}},Mi={observationTargets:[],unreadBtnClassName:"unread-msg-btn",bindEvent:function(){var e=this;$("body").on(ft.clickName,"."+e.unreadBtnClassName,function(){var t=e.observationTargets[0];t&&(pt.chatListWrap.scrollTop(t.offsetTop),e.handleObservationTargets())}),pt.chatListWrap.on("scroll",Pi(function(){e.handleObservationTargets()},150))},handleObservationTargets:function(){if(this.observationTargets.length){var e=pt.chatListWrap.scrollTop(),t=[];this.observationTargets.forEach(function(i){e>i.offsetTop&&t.push(i)}),t.length!==this.observationTargets.length&&(this.observationTargets=t,this.renderUnreadTip())}},renderUnreadTip:function(){var e=pt.chatList,t=this.observationTargets.length;if(e.find("."+this.unreadBtnClassName).remove(),t){var i=$(St(dt.CHAT_MSG_TPL.msgLoad.numTip,t)).addClass(this.unreadBtnClassName);e.append(i)}},main:function(e,t){!e||!e.offsetHeight||e.offsetTop+e.offsetHeight>e.parentNode.scrollTop||(this.observationTargets.push(e),this.renderUnreadTip(),this.handleObservationTargets(),BJ_REPORT.report("Unread B2C Msg"+JSON.stringify(t)))}};Mi.bindEvent();var Li=A(),Di=function(e,t){if("0"==ft.isRealSendMsg){var i={};(1===e||2===e)&&(i.replyType=e,1===e?i.replyText=t:i.fileId=t,i.action=5,ii().actRpt(i))}},Ai={getMsgCacheList:j(),normal:W(),image:K(),renderUploadImgRet:G},Ni=function(){function e(e){$.extend(r,e),i()}function i(){var e=r.data;e.fbKey;u.emitMsg(dt.SOCKET_CMD.SESSION_MSG.EMIT,{csrf:r.csrf,seq:r.seq,type:r.type,time:r.time}),$.extend(e,{hasDesc:2==e.style?!0:!1,isMobile:ft.isMobile},dt.FB_OPTS),pt.chatListWrap.find(".tencent-certification").before($.tmpl(dt.CHAT_MSG_TPL.feedback,e,f)),t(),n(e)}function n(e){var t,i,n,r=e.hasDesc,c=e.fbKey,l={avail:dt.FB_OPTS.availLetterSum,used:0,remain:dt.FB_OPTS.availLetterSum},f={},u=0,g=0,m=dt.FB_OPTS.delayTime,_=$('[data-fbkey="'+c+'"]'),h=_.find(".fb-level a"),v=_.find(".fb-desc"),q=_.find(".post-text").children().eq(0),y=_.find(".fb-loading");_.data("extUin",e.extUin),Object.defineProperty(f,"seq",{value:e.seq}),Object.defineProperty(f,"level",{set:function(e){var t=e+1;_.data("level",t).find(".level-desc").text(h.eq(e).data("desc")),!r&&_.trigger("loading")},get:function(){return _.data("level")}}),Object.defineProperty(f,"desc",{set:function(e){g=1,_.data("desc",e).trigger("loading")},get:function(){return _.data("desc")}}),!d&&h.hover(function(){for(var e=0;e<=$(this).index();e++)h.eq(e).addClass("on")},function(){for(var e=0;e<=$(this).index();e++)h.eq(e).removeClass("on")}),h.on(ft.clickName,function(){if(!$(this).parent().hasClass("disabled")){u=$(this).index(),f.level=u,h.removeClass("active");for(var e=0;u>=e;e++)h.eq(e).addClass("active");r&&0!=v.length&&"none"==v.css("display")&&(i=_.find(".num").eq(0),n=_.find(".btn-submit").eq(0),t=v.find("textarea").eq(0),v[d?"show":"slideDown"]("fast"),t.on("input keyup",function(e){var t=$(this).val();l.used=$(this).val().length,l.remain=l.avail-l.used,i.text(l.remain),l.remain<=0&&(i.text(0),$(this).val(t.substring(0,l.avail)),e.preventDefault())}),n.on(ft.clickName,function(){var e=$.trim(t.val());g||(f.desc=e,q.text(e))}))}}),_.on("loading",function(){y.fadeIn("fast"),o(f,_)}).on("success",function(t,i){p({text:$.i18n("chat_feedback_success_msg")},m,function(){y.fadeOut("fast"),h.parent().addClass("disabled"),r&&(n.hide().prev().hide(),q.text().length>0&&q.parent().show());var t=e.reply,o="";for(var c in t)i==c&&(o=t[c]);o=s(bt(o)),a({msgType:"feedBack",act:"new",replyContent:o})})}).on("fail",function(e,t){g=0,p({text:$.i18n("chat_feedback_fail_msg")+"："+t},m,function(){y.fadeOut("fast")}),BJ_REPORT.report("FeedBackRet GetData Error")})}function o(e,t){var e=$.extend({},{fbLevel:e.level,fbDesc:e.desc,seq:e.seq,fbKey:t.data("fbkey"),visitorId:c.visitorId,kfuin:c.kfUin,extUin:t.data("extUin"),wpaId:l.wpaId,session_time:c.time,sessionId:r.sessionId});$.ajax({url:dt.CGI_URL.GET_FEEDBACK_RET+"?kfuin="+e.kfuin,data:e,type:"POST",timeout:3e3,dataType:"json",error:function(i,n,a){t.trigger("fail",$.i18n("chat_feedback_error_msg")),BJ_REPORT.report(JSON.stringify({textStatus:n,errorThrown:a,queryData:e}))},success:function(i){0!=i.r?(t.trigger("fail",i.message),BJ_REPORT.report(JSON.stringify(i))):t.trigger("success",e.fbLevel)}})}function s(e){return e.replace(ni,function(e){return'<a href="'+ai(e)+'" target="_blank" class="text-link">'+e+"</a>"})}var r={},c=ft.receptionist,l=ft.wpaDetail,d=ft.isMobile,u=ft.chatSocket;return{initialize:e}},Gi={sendAck:function(e){ft.chatSocket.emitMsg(dt.SOCKET_CMD.SESSION_MSG.EMIT,{csrf:e.csrf,seq:e.seq,type:e.type,time:e.time})},render:function(e){a({msgType:"serverResp",act:"new",data:e.data}),this.sendAck(e)}},Bi=ft.chatSocket,Ui=function(e){var t={timer:"",delay:1e4,consuming:0};return t.timer=setInterval(function(){!e.isGet&&t.consuming<e.timeout?(t.consuming+=t.delay,BJ_REPORT.report(e.text+t.consuming),t.consuming==e.timeout&&e.callback(t.consuming)):clearInterval(t.timer)},t.delay),t.timer},Hi=function(){function e(e,t){var n,a={visitorId:d.visitorId,isMobile:ft.isMobile,wpaKey:f.wpaKey,reception:f.reception,signT:e.sigT,kfuin:d.kfUin,qqUin:r(),wpaId:f.wpaId,key:f.key,invitationType:f.invitationType,extUin:f.extUin,roleValue:e.roleValue,roleData:e.roleData,wpaShowItemId:e.wpaShowItemId,qidian_track_id:e.qidian_track_id,qidian_src_desc:e.qidian_src_desc,qidian_ex1:e.qidian_ex1,qidian_ex2:e.qidian_ex2,qidian_ex3:e.qidian_ex3,qidian_ex4:e.qidian_ex4,qidian_ex5:e.qidian_ex5,guestId:e.guestId,callImType:e.callImType,isChangeKF:ft.isChangeKF,NavClick:e.NavClick,date:+new Date+ft.serverClientTimeDiff,qidian_lang:e.qidian_lang};ft.inRegProcess;u.currentVersion&&$.extend(a,{navVersion:u.currentVersion});for(n in a)("undefined"==typeof a[n]||null===a[n])&&delete a[n];$.extend(a,{clickid:f.clickid}),ft.thirdAppConfig.enable&&$.extend(a,{thirdAppInfo:$.extend({},ft.thirdAppConfig)}),i(a)}function t(e,t){var i=3*(dt.SOCKET_OPTS.OPTS.ReconnectionAttempts+1)-1;e=t>=i?"reconnectFail":e,a({type:e,seq:ft.inRegProcess,act:"update"}),pt.chatBody.hasClass("regsuccess")&&"reconnectFail"==e&&pt.chatListWrap.find("loading").remove()}function i(e){var i,o={query:"kfuin="+d.kfUin+"&visitorId="+e.visitorId},s=0;h=e.clickid,i=g.create(dt.CGI_URL.SOCKET_CHAT,$.extend(dt.SOCKET_OPTS.OPTS,o)),i.emitMsg(dt.SOCKET_CMD.REG.EMIT,e,function(){l=Ui({isGet:m,timeout:dt.SOCKET_OPTS.REG_TIMEOUT,text:"Register Ack Timeout ",callback:function(e){a({type:"regTimeout",empty:!0}),BJ_REPORT.report(this.text)}}),_=+new Date},this).receiveMsg(dt.SOCKET_CMD.REG.RECEIVE,n,this,null,!0),i.ioLink.once("connect_error",function(e){BJ_REPORT.report("Connect Error sid "+i.ioLink.id),s++,t("connectError",s)}),i.ioLink.once("reconnecting",function(e){BJ_REPORT.report("Reconnecting sid "+i.ioLink.id),s++,t("reconnectIng",s)}),i.ioLink.once("reconnect_error",function(e){BJ_REPORT.report("Reconnect Error sid "+i.ioLink.id),s++,t("reconnectError",s)}),i.ioLink.once("reconnect_failed",function(e){BJ_REPORT.report("Reconnect Fail sid "+i.ioLink.id),s++,ft.ioLinkStatus="over",t("reconnectFail",s)}),i.ioLink.once("connect",function(e){s=0,ft.ioLinkStatus="normal",t("connect")}),i.ioLink.once("disconnect",function(e){Kt.remove(),"sessionOver"!=ft.ioLinkStatus&&(ft.ioLinkStatus="over")})}function n(e){m=1,l&&clearInterval(l),ti({type:4,requestConsumTime:+new Date-_,clickid:h}),ft.pageLoadStartTime&&ti({type:7,requestConsumTime:+new Date-ft.pageLoadStartTime,clickid:h}),"success"==e.result?o(e):s(e)}function o(e){var t;ft.ioLinkStatus="normal",ft.isRegOK=1,ft.seqs.key="kf"+d.kfUin+"vId"+d.visitorId+"seqs",BJ_REPORT.info(ft.seqs.key),Nt.initialize(),delete ft.wpaDetail.extUin,si(e.body),t=Ct.get(ft.seqs.key),xt(t),ft.seqs.data=JSON.parse(t),ie(),pt.chatBody.hasClass("regsuccess")||ft.regSuccessCallBack&&ft.regSuccessCallBack(),e.body.update&&a({type:"autoChangeKF",act:"new"}),a({type:"regSuccess",act:"update",seq:ft.inRegProcess}),1==e.body.u_info.type?Y(e):(ae(e),Y(e),se()),ft.inRegProcess=0,ft.isChangeKF="undefined"!=typeof e.body.isChangeKF?e.body.isChangeKF:0,ft.isChangeKF&&(pt.chatListWrap.find(".btn-newkf").addClass("disabled"),a({type:"changeKf",seq:ft.inRegProcess,act:"new"}),$(".msg-sys .btn-newkf").on(ft.clickName,function(t){ne(e,t)})),Kt.add()}function s(e){var t=e.errmsg||dt.SYS_MSG.reReg;BJ_REPORT.report("Register Fail "+JSON.stringify(e)),a({msgType:"serverResp",seq:p,act:"update",data:t,empty:!0}),ft.inRegProcess=0}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;"sessionOver"!=ft.ioLinkStatus||ft.isChangeKF||(delete ft.wpaDetail.extUin,delete ft.menuDetail.currentVersion,delete ft.wpaDetail.invitationType),ft.isGetSignT=0,m=0,ft.isInIframe?yt.send({act:"SMS_SM_FORCE_CONNECT"}):window.__STATUS_MANAGER.forceConnect(),BJ_REPORT.info("ReConnect"),pt.chatBody.removeClass("regsuccess").addClass("reconnect"),de(ft.getSigTData,null,null,e)}var l,d=ft.receptionist,f=ft.wpaDetail,u=ft.menuDetail,p=(ft.kfChangeTip,ft.localClickId,ft.inRegProcess),g=ft.chatSocket,m=0,_=0,h=0;return{prepareRegData:e,reConnect:c}},Fi=function(){function e(){try{var e,t=Date.now();if(sessionStorage.setItem(t,t),e=sessionStorage.getItem(t),sessionStorage.removeItem(t),t!=e)throw new Error;return!0}catch(i){}return!1}function t(t,i){e()?sessionStorage.setItem(t,i):s(t)||o(t,i,null,"/",0)}function i(t){return e()?sessionStorage.getItem(t):s(t)}return{get:i,set:t}}(),Ji=$.extend(!0,{},dt,{CHAT_MSG_TPL:{corpInfo:'<div class="mod-desc">\n                    <p class="logo"><img src="<%=o.eLogo%>" width="100" alt="<%=o.eName%>" title="<%=o.eName%>" height="100"/></p>\n                    <p class="name" title="<%=o.eName%>"><%=o.eName%></p>\n                    <div class="desc"><div class="desc__content"><%=o.eDesc%></div><div class="desc__arrow"></div></div>\n                </div>\n                <div class="mod-connect">\n                    <ul>\n                        <% if(o.eAddressDetail) { %><li title="<%=o.eAddressDetail%>"><i class="icon-address"></i><%=o.eAddressDetail%></li><% } %>\n                        <% if(o.eEmail) { %><li><i class="icon-email"></i><a href="mailto:<%=o.eEmail%>" title="<%=o.eEmail%>"><%=o.eEmail%></a></li><% } %>\n                        <% if(o.eHome) { %><li><i class="icon-link"></i><a href="<%=o.eLink%>"  title="<%=o.eHome%>" target="_blank"><%=o.eHome%></a></li><% } %>\n                        <% if(o.ePhone) { %><li><i class="icon-tel"></i><a href="tel:<%=o.ePhone%>" title="<%=o.ePhone%>"><%=o.ePhone%></a></li><% } %>\n                    </ul>\n                </div>'},FLASH_TIP:{NO_FLASH:"请安装flash，发送图片消息需要使用flash",LOW_VERSION:"请升级您的flash版本，现版本太低无法发送图片消息"}}),ji=85,Wi=function(){function e(e){var i=0;$.support.cors=!0,$.ajax({url:Ji.CGI_URL.GET_SKIN_CORP_INFO+"?kfuin="+e.kfuin,data:e,type:"POST",timeout:2e3,dataType:"json",error:function(i,n,a){t.fail({textStatus:n,errorThrown:a,queryData:e})},beforeSend:function(){i=+new Date},complete:function(){ti({type:6,requestConsumTime:+new Date-i,clickid:ft.getSigTData.clickid,addon:JSON.stringify({key:e.key})})},success:function(e){ft.isGetSkin=1,t[e.code?"fail":"success"](e)}})}var t={skinColor:function(e){var t=["blue","default","orange","red","green"],i="skin-default",n="skin-"+t[e];n!=i&&gt.page.removeClass(i).addClass(n)},success:function(e){var t=e.corpInfo.eHome;if("undefined"!=typeof e.corpInfo.eLogo&&0!=e.corpInfo.eLogo&&e.corpInfo.eLogo||(e.corpInfo.eLogo=Ji.CGI_URL.COMP_SOURCE_URL+"img/default-logo.png"),t&&$.extend(e.corpInfo,{eLink:ai(t)}),this.skinColor(e.theme),ue(Ji.CHAT_MSG_TPL.corpInfo,e.corpInfo),e.showInfo&&(e.showInfo.isShowQidianSign&&($(".sidebar").append($.tmpl('<div class="tencent-cert">'+Ji.CHAT_MSG_TPL.tencentCert+"</div>",{},f)),$(".page").addClass("page-certification"),ft.isShowQidianSign=e.showInfo.isShowQidianSign),e.showInfo.isShowTopNotice))if(window.localStorage){var i=window.localStorage.getItem("QIDIAN_WEBIM_CLOSE_TOP_NOTICE");1!=i&&($(".chat-list").append($.tmpl(Ji.CHAT_MSG_TPL.privacyTips_b2c_base,{},f)),$(".im-tips__close-btn").click(function(){window.localStorage.setItem("QIDIAN_WEBIM_CLOSE_TOP_NOTICE",1),$(".im-tips--b2c-base").remove()}))}else $(".chat-list").append($.tmpl(Ji.CHAT_MSG_TPL.privacyTips_b2c_base,{},f)),$(".im-tips__close-btn").click(function(){$(".im-tips--b2c-base").remove()})},fail:function(e){$(".sidebar").find("i").remove().end().find(".text").html($.i18n("sysmsg_load_corpinfo_fail_msg")),BJ_REPORT.report("CorpSkin GetData Error"),BJ_REPORT.report(JSON.stringify(e))}};return{getData:e,skinColor:t.skinColor}},Ki=function On(e){function t(){var t=e.reportUrl||o,i=encodeURIComponent("flag1="+d+"&flag2="+f+"&flag3="+u+"&"+m.join("&"));t+="?appid="+s+"&platform="+r+"&app="+c+"&uin="+l+"&speedparams="+i}var i,n,a,o="//report.huatuo.qq.com/report.cgi",s=20300,r=e.platform||"pc",c=e.app||"other",l=e.uin||null,d=e.flag1,f=e.flag2,u=e.flag3,p=window.performance||window.webkitPerformance||window.msPerformance,g=["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"],m=[],_=null!=e.points&&"[object Object]"==toString.apply(e.points)?e.points:null;if(null!=_){for(var h in _)m.push(h+"="+_[h]);if(0!=m.length)return void t()}if(p&&(i=p.timing)){n=i[g[0]];for(var v=1,q=g.length;q>v;v++)"undefined"!=typeof i[g[v]]&&i[g[v]]>0&&(a=i[g[v]]-n,a>0)?m[v]=v+"="+a:m[v]=v+"=0";t()}e.points&&On(e)},Vi={isInit:!1,init:function(e){var t=this;d().done(function(){t.render(),t.isInit=!0,e&&e()}).fail(function(e){})},render:function(){document.title=$.i18n("common_page_title"),gt.header.find("span.name").text($.i18n("common_page_title")),gt.chatBtnSend.text($.i18n("common_sendbtn_text")),gt.chatBtnSend.attr("title",$.i18n("common_sendbtn_text")),gt.btnUpload.attr("title",$.i18n("common_insert_photo_text")),gt.btnFace.attr("title",$.i18n("common_insert_emoji_text")),gt.chatPost.find(".post-area").attr("placeholder",$.i18n("common_postarea_pc_placeholder")),gt.chatListWrap.find(".initial-loading").html(['<i class="loading loading-b"></i>','<div class="msg-sys">','   <div class="text">'+$.i18n("sysmsg_get_sigt_msg")+"</div>","</div>"].join("")),setTimeout(function(){gt.chatListWrap.removeClass("chat-initial"),gt.chatListWrap.find(".initial-loading").hide()},200),gt.sidebar.find(".corp-loading .text").text($.i18n("sysmsg_load_corpinfo_msg"))}},Qi=pe();!function(e,t,i){var n,a,o,s,r,c,l,d,f,u,p,g,m,_,h,v,q,y,b,S,T,w,C,k,x,E,R,I,O,$;w={paneClass:"nano-pane",sliderClass:"nano-slider",contentClass:"nano-content",enabledClass:"has-scrollbar",flashedClass:"flashed",activeClass:"active",iOSNativeScrolling:!1,preventPageScrolling:!1,disableResize:!1,alwaysVisible:!1,flashDelay:1500,sliderMinHeight:20,sliderMaxHeight:null,documentContext:null,windowContext:null},q="scrollbar",v="scroll",d="mousedown",f="mouseenter",u="mousemove",g="mousewheel",p="mouseup",h="resize",s="drag",r="enter",b="up",_="panedown",a="DOMMouseScroll",o="down",S="wheel",c="keydown",l="keyup",y="touchmove",n=null,E=t.requestAnimationFrame,T=t.cancelAnimationFrame,I=i.createElement("div").style,$=function(){var e,t,i,n,a,o;for(n=["t","webkitT","MozT","msT","OT"],e=a=0,o=n.length;o>a;e=++a)if(i=n[e],t=n[e]+"ransform",t in I)return n[e].substr(0,n[e].length-1);return!1}(),O=function(e){return $===!1?!1:""===$?e:$+e.charAt(0).toUpperCase()+e.substr(1)},R=O("transform"),k=R!==!1,C=function(){var e,t,n;return e=i.createElement("div"),t=e.style,t.position="absolute",t.width="100px",t.height="100px",t.overflow=v,t.top="-9999px",i.body.appendChild(e),n=e.offsetWidth-e.clientWidth,i.body.removeChild(e),
n},x=function(){var e,i,n;return i=t.navigator.userAgent,(e=/(?=.+Mac OS X)(?=.+Firefox)/.test(i))?(n=/Firefox\/\d{2}\./.exec(i),n&&(n=n[0].replace(/\D+/g,"")),e&&+n>23):!1},m=function(){function c(a,o){this.el=a,this.options=o,n||(n=C()),this.$el=e(this.el),this.doc=e(this.options.documentContext||i),this.win=e(this.options.windowContext||t),this.body=this.doc.find("body"),this.$content=this.$el.children("."+this.options.contentClass),this.$content.attr("tabindex",this.options.tabIndex||0),this.content=this.$content[0],this.previousPosition=0,this.options.iOSNativeScrolling&&null!=this.el.style.WebkitOverflowScrolling?this.nativeScrolling():this.generate(),this.createEvents(),this.addEvents(),this.reset()}return c.prototype.preventScrolling=function(e,t){if(this.isActive)if(e.type===a)(t===o&&e.originalEvent.detail>0||t===b&&e.originalEvent.detail<0)&&e.preventDefault();else if(e.type===g){if(!e.originalEvent||!e.originalEvent.wheelDelta)return;(t===o&&e.originalEvent.wheelDelta<0||t===b&&e.originalEvent.wheelDelta>0)&&e.preventDefault()}},c.prototype.nativeScrolling=function(){this.$content.css({WebkitOverflowScrolling:"touch"}),this.iOSNativeScrolling=!0,this.isActive=!0},c.prototype.updateScrollValues=function(){var e,t;e=this.content,this.maxScrollTop=e.scrollHeight-e.clientHeight,this.prevScrollTop=this.contentScrollTop||0,this.contentScrollTop=e.scrollTop,t=this.contentScrollTop>this.previousPosition?"down":this.contentScrollTop<this.previousPosition?"up":"same",this.previousPosition=this.contentScrollTop,"same"!==t&&this.$el.trigger("update",{position:this.contentScrollTop,maximum:this.maxScrollTop,direction:t}),this.iOSNativeScrolling||(this.maxSliderTop=this.paneHeight-this.sliderHeight,this.sliderTop=0===this.maxScrollTop?0:this.contentScrollTop*this.maxSliderTop/this.maxScrollTop)},c.prototype.setOnScrollStyles=function(){var e;k?(e={},e[R]="translate(0, "+this.sliderTop+"px)"):e={top:this.sliderTop},E?(T&&this.scrollRAF&&T(this.scrollRAF),this.scrollRAF=E(function(t){return function(){return t.scrollRAF=null,t.slider.css(e)}}(this))):this.slider.css(e)},c.prototype.createEvents=function(){this.events={down:function(e){return function(t){return e.isBeingDragged=!0,e.offsetY=t.pageY-e.slider.offset().top,e.slider.is(t.target)||(e.offsetY=0),e.pane.addClass(e.options.activeClass),e.doc.bind(u,e.events[s]).bind(p,e.events[b]),e.body.bind(f,e.events[r]),!1}}(this),drag:function(e){return function(t){return e.sliderY=t.pageY-e.$el.offset().top-e.paneTop-(e.offsetY||.5*e.sliderHeight),e.scroll(),e.contentScrollTop>=e.maxScrollTop&&e.prevScrollTop!==e.maxScrollTop?e.$el.trigger("scrollend"):0===e.contentScrollTop&&0!==e.prevScrollTop&&e.$el.trigger("scrolltop"),!1}}(this),up:function(e){return function(t){return e.isBeingDragged=!1,e.pane.removeClass(e.options.activeClass),e.doc.unbind(u,e.events[s]).unbind(p,e.events[b]),e.body.unbind(f,e.events[r]),!1}}(this),resize:function(e){return function(t){e.reset()}}(this),panedown:function(e){return function(t){return e.sliderY=(t.offsetY||t.originalEvent.layerY)-.5*e.sliderHeight,e.scroll(),e.events.down(t),!1}}(this),scroll:function(e){return function(t){e.updateScrollValues(),e.isBeingDragged||(e.iOSNativeScrolling||(e.sliderY=e.sliderTop,e.setOnScrollStyles()),null!=t&&(e.contentScrollTop>=e.maxScrollTop?(e.options.preventPageScrolling&&e.preventScrolling(t,o),e.prevScrollTop!==e.maxScrollTop&&e.$el.trigger("scrollend")):0===e.contentScrollTop&&(e.options.preventPageScrolling&&e.preventScrolling(t,b),0!==e.prevScrollTop&&e.$el.trigger("scrolltop"))))}}(this),wheel:function(e){return function(t){var i;if(null!=t)return i=t.delta||t.wheelDelta||t.originalEvent&&t.originalEvent.wheelDelta||-t.detail||t.originalEvent&&-t.originalEvent.detail,i&&(e.sliderY+=-i/3),e.scroll(),!1}}(this),enter:function(e){return function(t){var i;if(e.isBeingDragged)return 1!==(t.buttons||t.which)?(i=e.events)[b].apply(i,arguments):void 0}}(this)}},c.prototype.addEvents=function(){var e;this.removeEvents(),e=this.events,this.options.disableResize||this.win.bind(h,e[h]),this.iOSNativeScrolling||(this.slider.bind(d,e[o]),this.pane.bind(d,e[_]).bind(""+g+" "+a,e[S])),this.$content.bind(""+v+" "+g+" "+a+" "+y,e[v])},c.prototype.removeEvents=function(){var e;e=this.events,this.win.unbind(h,e[h]),this.iOSNativeScrolling||(this.slider.unbind(),this.pane.unbind()),this.$content.unbind(""+v+" "+g+" "+a+" "+y,e[v])},c.prototype.generate=function(){var e,i,a,o,s,r,c;return o=this.options,r=o.paneClass,c=o.sliderClass,e=o.contentClass,(s=this.$el.children("."+r)).length||s.children("."+c).length||this.$el.append('<div class="'+r+'"><div class="'+c+'" /></div>'),this.pane=this.$el.children("."+r),this.slider=this.pane.find("."+c),0===n&&x()?(a=t.getComputedStyle(this.content,null).getPropertyValue("padding-right").replace(/[^0-9.]+/g,""),i={right:-14,paddingRight:+a+14}):n&&(i={right:-n},this.$el.addClass(o.enabledClass)),null!=i&&this.$content.css(i),this},c.prototype.restore=function(){this.stopped=!1,this.iOSNativeScrolling||this.pane.show(),this.addEvents()},c.prototype.reset=function(){var e,t,i,a,o,s,r,c,l,d,f,u;return this.iOSNativeScrolling?void(this.contentHeight=this.content.scrollHeight):(this.$el.find("."+this.options.paneClass).length||this.generate().stop(),this.stopped&&this.restore(),e=this.content,a=e.style,o=a.overflowY,t=e.scrollHeight+n,d=parseInt(this.$el.css("max-height"),10),d>0&&(this.$el.height(""),this.$el.height(e.scrollHeight>d?d:e.scrollHeight)),r=this.pane.outerHeight(!1),l=parseInt(this.pane.css("top"),10),s=parseInt(this.pane.css("bottom"),10),c=r+l+s,u=Math.round(c/t*r),u<this.options.sliderMinHeight?u=this.options.sliderMinHeight:null!=this.options.sliderMaxHeight&&u>this.options.sliderMaxHeight&&(u=this.options.sliderMaxHeight),o===v&&a.overflowX!==v&&(u+=n),this.maxSliderTop=c-u,this.contentHeight=t,this.paneHeight=r,this.paneOuterHeight=c,this.sliderHeight=u,this.paneTop=l,this.slider.height(u),this.events.scroll(),this.pane.show(),this.isActive=!0,e.scrollHeight===e.clientHeight||this.pane.outerHeight(!0)>=e.scrollHeight&&o!==v?(this.pane.hide(),this.isActive=!1):this.el.clientHeight===e.scrollHeight&&o===v?this.slider.hide():this.slider.show(),this.pane.css({opacity:this.options.alwaysVisible?1:"",visibility:this.options.alwaysVisible?"visible":""}),i=this.$content.css("position"),("static"===i||"relative"===i)&&(f=parseInt(this.$content.css("right"),10),f&&this.$content.css({right:"",marginRight:f})),this)},c.prototype.scroll=function(){return this.isActive?(this.sliderY=Math.max(0,this.sliderY),this.sliderY=Math.min(this.maxSliderTop,this.sliderY),this.$content.scrollTop(this.maxScrollTop*this.sliderY/this.maxSliderTop),this.iOSNativeScrolling||(this.updateScrollValues(),this.setOnScrollStyles()),this):void 0},c.prototype.scrollBottom=function(e){return this.isActive?(this.$content.scrollTop(this.contentHeight-this.$content.height()-e).trigger(g),this.stop().restore(),this):void 0},c.prototype.scrollTop=function(e){return this.isActive?(this.$content.scrollTop(+e).trigger(g),this.stop().restore(),this):void 0},c.prototype.scrollTo=function(e){return this.isActive?(this.scrollTop(this.$el.find(e).get(0).offsetTop),this):void 0},c.prototype.stop=function(){return T&&this.scrollRAF&&(T(this.scrollRAF),this.scrollRAF=null),this.stopped=!0,this.removeEvents(),this.iOSNativeScrolling||this.pane.hide(),this},c.prototype.destroy=function(){return this.stopped||this.stop(),!this.iOSNativeScrolling&&this.pane.length&&this.pane.remove(),this.$content.removeAttr("tabindex"),this.$el.hasClass(this.options.enabledClass)&&(this.$el.removeClass(this.options.enabledClass),this.$content.css({right:""})),this},c.prototype.flash=function(){return!this.iOSNativeScrolling&&this.isActive?(this.reset(),this.pane.addClass(this.options.flashedClass),setTimeout(function(e){return function(){e.pane.removeClass(e.options.flashedClass)}}(this),this.options.flashDelay),this):void 0},c}(),e.fn.nanoScroller=function(t){return this.each(function(){var i,n;if((n=this.nanoscroller)||(i=e.extend({},w,t),this.nanoscroller=n=new m(this,i)),t&&"object"===("undefined"==typeof t?"undefined":mt(t))){if(e.extend(n.options,t),null!=t.scrollBottom)return n.scrollBottom(t.scrollBottom);if(null!=t.scrollTop)return n.scrollTop(t.scrollTop);if(t.scrollTo)return n.scrollTo(t.scrollTo);if("bottom"===t.scroll)return n.scrollBottom(0);if("top"===t.scroll)return n.scrollTop(0);if(t.scroll&&t.scroll instanceof e)return n.scrollTo(t.scroll);if(t.stop)return n.stop();if(t.destroy)return n.destroy();if(t.flash)return n.flash()}return n.reset()})},e.fn.nanoScroller.Constructor=m}(jQuery,window,document);var zi={get:he,set:ve},Yi=function(){function e(){var e,i=gt.faceList.find("ul"),n={sum:140,listWidth:ft.win.innerWidth-20,rowSum:7};if(0==i.children().length){for(var a=0;a<n.sum;a++)e=$('<li title="'+$.i18n(Ht.locale[a])+'" data-index="['+$.i18n(Ht.locale[a])+']"></li>'),i.append(e);$(".nano").nanoScroller(),t()}}function t(){gt.faceList.on("click","li",function(e){var t=$(e.currentTarget),i=t.data("index"),n=i.length,a=gt.chatPostArea.val(),o=a.length,s=zi.get(gt.chatPostArea[0]);gt.faceList.trigger("hide"),a=o?a.substring(0,s)+i+a.substr(s,o):i,gt.chatPostArea.val(a),s+=n,zi.set(gt.chatPostArea[0],s)})}return{render:e}}(),Xi=Se(),Zi=function(e){for(var t,i=new DataView(e),n=2,a=i.byteLength;a>n;){if(t=i.getUint8(n+1),225==t){var o,s=n+10;if(18761==i.getUint16(s))o=!1;else{if(19789!=i.getUint16(s))return!1;o=!0}if(42!=i.getUint16(s+2,!o))return!1;var r=i.getUint32(s+4,!o);if(8>r)return!1;var c,l,d=s+r,f=i.getUint16(d,!o);for(l=0;f>l;l++)if(c=d+12*l+2,274==i.getUint16(c,!o))return parseInt(i.getUint16(c+8,!o),10);return!1}n+=2+i.getUint16(n+2)}return null},en=function(e){var t="other";return/(ipad|iphone|ipod).*? (ipad)?qq\/([\d.]+)|\bv1_and_sqi?_([\d.]+)(.*? qq\/([\d.]+))?/i.test(e)?t="mqq":/micromessenger/i.test(e)&&(t="wechat"),t};!function(e){var t,i=e.Uint8Array,n=e.HTMLCanvasElement,a=n&&n.prototype,o=/\s*;\s*base64\s*(?:;|$)/i,s="toDataURL",r=function(e){for(var n,a,o,s=e.length,r=new i(s/4*3|0),c=0,l=0,d=[0,0],f=0,u=0;s--;)a=e.charCodeAt(c++),n=t[a-43],255!==n&&n!==o&&(d[1]=d[0],d[0]=a,u=u<<6|n,f++,4===f&&(r[l++]=u>>>16,61!==d[1]&&(r[l++]=u>>>8),61!==d[0]&&(r[l++]=u),f=0));return r};i&&(t=new i([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),!n||a.toBlob&&a.toBlobHD||(a.toBlob||(a.toBlob=function(e,t){if(t||(t="image/png"),this.mozGetAsFile)return void e(this.mozGetAsFile("canvas",t));if(this.msToBlob&&/^\s*image\/png\s*(?:$|;)/i.test(t))return void e(this.msToBlob());var n,a=Array.prototype.slice.call(arguments,1),c=this[s].apply(this,a),l=c.indexOf(","),d=c.substring(l+1),f=o.test(c.substring(0,l));Blob.fake?(n=new Blob,f?n.encoding="base64":n.encoding="URI",n.data=d,n.size=d.length):i&&(n=f?new Blob([r(d)],{type:t}):new Blob([decodeURIComponent(d)],{type:t})),e(n)}),!a.toBlobHD&&a.toDataURLHD?a.toBlobHD=function(){s="toDataURLHD";var e=this.toBlob();return s="toDataURL",e}:a.toBlobHD=a.toBlob)}(window);var tn=ft.mobileSysType,nn=en(ft.userAgent),an=ft.userAgent;we.prototype.initialize=function(){var e=this,t=this.options.$trigger,i=this.options.$inputTrigger,n=this.options.triggerEvent||"click",a=this.options.isNeedWifiTip,o=this.options.initializeCallBack;"iOS"==tn&&"mqq"==nn&&/uiwebview/.test(an)?(t.addClass("btn-upload--mqq"),i.off("change").on("change",function(t){e.checkImgFilesLen(this.files),i.prop("value","")})):t&&t.off(n).on(n,function(){e[a?"wifiTip":"bindUploadEvent"](),"function"==typeof o?o():""})},we.prototype.wifiTip=function(){var e;Te()?this.bindUploadEvent():(e=window.sessionStorage.getItem("wifiTip"),e?this.bindUploadEvent():be($.i18n("sysmsg_upload_image_wifi_warning_msg"),function(){window.sessionStorage.setItem("wifiTip","1"),this.bindUploadEvent()},this))},we.prototype.bindUploadEvent=function(){var e=this,t=this.options.$inputTrigger;t.trigger("click"),t.off("change").on("change",function(i){e.checkImgFilesLen(this.files),t.prop("value","")})},we.prototype.checkImgFilesLen=function(e){var t=e.length;return t>dt.IMG_UPLOAD_OPTS.MAX_SUM?void p({text:$.i18n("sysmsg_upload_image_max_msg",dt.IMG_UPLOAD_OPTS.MAX_SUM)},1e3):void this.checkImgTypeLocal(e)},we.prototype.checkImgTypeLocal=function(e){for(var t,i={},a=0,o=e.length;o>a;a++){var s=e[a];t=window.URL.createObjectURL(s),i=$.extend(!0,{},{seq:n(dt.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),type:s.type,size:s.size,blobUrl:t,content:s}),-1!=$.inArray(s.type,dt.IMG_UPLOAD_OPTS.ACCEPT_TYPE)?(this.options.events.preview(i),this.compressImgFiles(i)):this.options.events.preview(i,"notSupport")}},we.prototype.compressImgFiles=function(e){var t=e.type;switch(t){case"image/jpeg":this.compressQuality(e);break;case"image/jpg":this.compressQuality(e);break;case"image/png":this["pc"===this.options.platform?"compressQuality":"compressSize"](e);break;default:this.options.events.replacePlaceholder(e)}},we.prototype.compressQuality=function(e){function t(t){var n,a=new Image,o=document.createElement("canvas"),s=o.getContext("2d");a.src=e.blobUrl,a.onload=function(){if(n={width:a.naturalWidth,height:a.naturalHeight},o.width=n.width,o.height=n.height,t&&1!=t)switch(t){case 2:s.translate(n.width,0),s.scale(-1,1);break;case 3:s.rotate(Math.PI),s.translate(-n.width,-n.height);break;case 4:s.translate(0,n.height),s.scale(1,-1);break;case 5:o.width=n.height,o.height=n.width,s.rotate(Math.PI/2),s.scale(1,-1);break;case 6:o.width=n.height,o.height=n.width,s.rotate(90*Math.PI/180),s.translate(0,-n.height);break;case 7:o.width=n.height,o.height=n.width,s.rotate(Math.PI/2),s.translate(n.width,-n.height),s.scale(-1,1);break;case 8:o.width=n.height,o.height=n.width,s.rotate(3*Math.PI/2),s.translate(-n.width,0)}s.drawImage(a,0,0);o.toBlob(function(t){e.content=t,e.size=t.size,i.options.events.replacePlaceholder(e)},e.type,dt.IMG_UPLOAD_OPTS.JPG_COMPRESS_RATIO/100)}}var i=this,n=new FileReader;n.onload=function(e){var i=Zi(e.target.result);t(i)},n.readAsArrayBuffer(e.content)},we.prototype.compressSize=function(e){var t,i,n,a=this,o=new Image,s=document.createElement("canvas"),r=s.getContext("2d");o.src=e.blobUrl,o.onload=function(){if(t={width:o.naturalWidth,height:o.naturalHeight},!(t.width>dt.IMG_UPLOAD_OPTS.MAX_WIDTH||t.height>dt.IMG_UPLOAD_OPTS.MAX_HEIGHT))return void a.options.events.replacePlaceholder(e);i=Math.floor(t.width*(dt.IMG_UPLOAD_OPTS.MAX_HEIGHT/t.height)),n=Math.floor(t.height*(dt.IMG_UPLOAD_OPTS.MAX_WIDTH/t.width)),i>dt.IMG_UPLOAD_OPTS.MAX_WIDTH?i=dt.IMG_UPLOAD_OPTS.MAX_WIDTH:n>dt.IMG_UPLOAD_OPTS.MAX_HEIGHT&&(n=dt.IMG_UPLOAD_OPTS.MAX_HEIGHT),s.width=i,s.height=n,r.drawImage(o,0,0,t.width,t.height,0,0,i,n);s.toBlob(function(t){e.content=t,e.size=t.size,a.options.events.replacePlaceholder(e)},e.type)}};var on=function(e){var t,i={},n=!0;i.len=function(e){var t=e.length;0==t?n=!1:t>=dt.MAX_POST_LIMIT.LENGTH&&(p({text:$.i18n(dt.MAX_POST_LIMIT.TIP_TEXT)},1e3),n=!1)};for(t in i)i[t](e);return n},sn=function(){var e,t=0,i=0;try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),e&&(t=1,i=e.GetVariable("$version").match(/\d+/g))}catch(n){BJ_REPORT&&BJ_REPORT.report("getIEFlashVersion fail")}return{hasFlash:t,flashVersion:parseFloat(i[0]+"."+i[1],10)}};!function(e){function t(){r(),l(),"PC"===T.platform&&d(),"H5"===T.platform&&c(),O="H5"===T.platform?T.$container.parent():null}function i(e){var t=new RegExp("["+m+_+h+"]","g");return 0===e.length?e:(e.match(t)||[]).join("")}function n(e){var t=e.length,i=!0;return i=0!==!t,i=i&&t>=v,(null!==e.match(b)&&e.match(b).length>=q&&e.length>q||null!==e.match(S)&&e.match(S).length>y&&e.length>y)&&(i=!1),i}function a(t){if(0!==t.length&&ft.receptionist.kfUin){var i={keywords:t,wpaId:ft.wpaDetail&&ft.wpaDetail.wpaId,visitorId:ft.receptionist&&ft.receptionist.visitorId};E=t,x=e.ajax({url:T.cgi+"?kfuin="+ft.receptionist.kfUin,data:i,type:"POST",timeout:1e3,dataType:"json",error:function(e,t,i){},success:function(e){var t=e&&e.code;e.list=e.list||[],0===t&&o(e)}})}}function o(t){T.$container.html(e.tmpl(T.tpl,t)),k=R=t.list.length,C=!!t.queryid,"H5"===T.platform&&g(t.list)}function s(){x&&x.abort(),I&&clearTimeout(I),o(w)}function r(){var t=T.$el,r=void 0;t.on("input propertychange",function(){var c=i(e.trim(t.val()));c!==r&&(s(),r=c,I=setTimeout(function(){n(r)?a(r):o(w)},T.delay))})}function c(){T.$submitTrigger.on("tap",function(){s()})}function l(){T.$container.delegate("li","click",function(t){var i=e(t.currentTarget),n=p(i);o(w),T.events.click&&T.events.click(t,n)})}function d(){T.$container.delegate("li","mouseover",function(t){var i=e(t.currentTarget),n=i.index(),a=p(i);T.events.mouseover&&T.events.mouseover(t,a),T.$container.find("li").eq(k).removeClass("hover"),i.addClass("hover"),k=n}),T.$container.delegate("li","mouseout",function(t){var i=e(t.currentTarget);i.removeClass("hover"),T.events.enter&&T.events.enter(t)}),f()}function f(){var e=T.$el;e.on("keydown",function(e){var t=e.keyCode;(38===t||40===t||13===t)&&(e.preventDefault(),u(e,t))})}function u(e,t){var i=T.$container.find("li");if(0!==i.length){switch(t){case 38:k=(0>k?R:k)-1;break;case 40:k=(k===R?-1:k)+1;break;case 13:return s(),void(T.events.enter&&T.events.enter(e))}if(i.removeClass("hover"),k>=0&&k<=i.length-1){var n=i.eq(k),a=p(n);n.addClass("hover"),T.events.mouseover&&T.events.mouseover(e,a),T.$inputArea.val(n.text())}else T.$inputArea.val(E),T.events.mouseover&&T.events.mouseover(e,null)}}function p(e){var t=T.$container.find("ul").data("queryid"),i=e.data("docid"),n=e.data("order"),a=e.text();return{queryid:t,reply_docid:i,order:n,msg:a}}function g(e){var t=T.$container.height(),i=O.height();T.$container[t>i&&e.length>0?"addClass":"removeClass"]("scrollable")}var m="一-龥",_="A-Za-z",h="0-9",v=2,q=10,y=20,b=new RegExp("["+m+"]","g"),S=new RegExp("["+_+h+"]","g"),T={platform:"PC",delay:200},w={queryid:null,list:[]},C=!1,k=0,x=void 0,E=void 0,R=void 0,I=void 0,O=void 0;e.fn.msgAutoComplete=function(i){i&&e.extend(T,i),T.$el=this,t(this,T)}}($);var rn=150,cn=1e3,ln=100,dn=5e4,fn=2592e5,un=0,pn=0,gn={},mn=0,_n=0,hn=null,vn="init",qn=null,yn=null,bn=!1,Sn=null,Tn=null,wn={},Cn=ct();Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var i,n;if(null==this)throw new TypeError(" this is null or not defined");var a=Object(this),o=a.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(i=t),n=0;o>n;){var s;n in a&&(s=a[n],e.call(i,s,n,a)),n++}});var kn=function(){function e(){var e,t="kf"+n.kfUin,a=JSON.parse(Ct.get(t)),o=ft.seqs.data.length;a&&a.forEach(function(t){t.visitorId==n.visitorId&&t.total>o&&(e=t.total-o,i(e))})}function i(e){var i,a,o=n.kfUin,s=n.visitorId,r=[];ft.seqs.data=JSON.parse(Ct.get(ft.seqs.key)),r=ft.seqs.data.slice(0-e);for(var c=0;c<r.length;c++)i="kf"+o+"vId"+s+"index"+r[c],a=JSON.parse(Ct.get(i)),Ai.getMsgCacheList.renderSingle(a,"down"),t()}var n=ft.receptionist;ft.ioLinkStatus,ft.chatSocket;return{start:e}}(),xn=A();xn.isPageVisibilitySupport&&xn.visibilitychange(function(e,t,i){var n,a=ft.receptionist,o=ft.ioLinkStatus,s=ft.chatSocket;if(0==t&&"visible"==i){if(ft.isInIframe){var r,c,l,d="kf"+a.kfUin+"vId"+a.visitorId+"red",f=JSON.parse(Ct.get(d));f&&f.forEach(function(e){for(r in e)l=e[r],c=r.replace("wId",""),l.number>0&&(ft.isMobile?yt.send({visitorid:a.visitorId,kfuin:a.kfUin,wpaId:c,act:"UNREAD",data:{number:l.number}}):oi.render("update",l.number))})}n="show",ft.isRegOK&&kn.start(n),s.ioLink&&s.ioLink.disconnected&&o&&"sessionOver"!=o&&-1==o.indexOf("over")&&(ft.ioLinkStatus="over")}else n="hide";ft.pageStatus=n}),function(e){var t=function(e,i,n){var a=/[^\w\-\.:]/.test(e)?new Function(t.arg+",tmpl","var _e=tmpl.encode"+t.helper+",_s='"+e.replace(t.regexp,t.func)+"';return _s;"):t.cache[e]=t.cache[e]||e;return i?n?n(a(i,t)):a(i,t):function(e){return n?n(a(e,t)):a(e,t)}};t.cache={},t.load=function(e){return document.getElementById(e).innerHTML},t.regexp=/([\s'\\])(?!(?:[^<]|\<(?!%))*%\>)|(?:\<%(=|#)([\s\S]+?)%\>)|(\<%)|(%\>)/g,t.func=function(e,t,i,n,a,o){return t?{"\n":"\\n","\r":"\\r","	":"\\t"," ":" "}[t]||"\\"+t:i?"="===i?"'+_e("+n+")+'":"'+("+n+"==null?'':"+n+")+'":a?"';":o?"_s+='":void 0},t.encReg=/[<>&"'\x00]/g,t.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"},t.encode=function(e){return(null==e?"":""+e).replace(t.encReg,function(e){return t.encMap[e]||""})},t.joinTpl=function(e,t,i){return e.replace(t,i)},t.arg="o",t.helper=",print=function(s,e){_s+=e?(s==null?'':s):_e(s);},include=function(s,d){_s+=tmpl(s,d);}",e.tmpl=t}($);var En=(function(){var e,t=window.performance||window.webkitPerformance||window.msPerformance;t&&$(window).load(function(){e=t.timing,ft.pageLoadStartTime=e.navigationStart,setTimeout(function(){ti({type:1,requestConsumTime:e.loadEventEnd-e.navigationStart,addon:JSON.stringify({domLoad:e.domContentLoadedEventEnd-e.navigationStart})})},20)})}(),new et);En.start()}();